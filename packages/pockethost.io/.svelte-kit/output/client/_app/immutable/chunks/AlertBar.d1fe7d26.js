import{j as F}from"./singletons.cf10a44f.js";import{d as h,l as z}from"./index.1926c527.js";import{s as A,f as p,a as q,g as I,h as C,c as U,d as m,j as y,i as L,x as k,l as B,m as G,n as M,r as H,u as J,v as K,w as Q,z as D}from"./scheduler.f7157b54.js";import{S as X,i as Y,g as Z,t as P,c as N,a as R}from"./index.0c0c8d6a.js";const V=F("goto"),se=F("after_navigate"),w=(a,e)=>{const{parseError:t}=h(),{dbg:n,error:i,warn:c}=z();if(i(`Form error: ${a}`,{error:a}),e){const s=t(a)[0];e(s)}else throw a},S=async(a,e,t,n=!0)=>{const{authViaEmail:i}=h();t==null||t("");try{await i(a,e),n&&await V("/dashboard")}catch(c){if(!(c instanceof Error))throw new Error(`Expected Error type here, but got ${typeof c}:${c}`);w(c,t)}},T=async(a,e,t)=>{const{createUser:n}=h();t==null||t("");try{await n(a,e)}catch(i){w(i,t)}},re=async(a,e)=>{const{confirmVerification:t}=h();e==null||e("");try{await t(a),window.location.href="/dashboard"}catch(n){w(n,e)}return!1},le=async(a,e)=>{const{requestPasswordReset:t}=h();e==null||e("");try{return await t(a)}catch(n){w(n,e)}return!1},fe=async(a,e,t)=>{const{requestPasswordResetConfirm:n}=h();t==null||t("");try{await n(a,e),await V("/dashboard")}catch(i){w(i,t)}return!1},E=async(a,e)=>{const{user:t,createInstance:n}=h(),{id:i}=t()||{};try{if(!a)throw new Error("Instance name is required");if(!i)throw new Error("Must be logged in to create an instance");const c=await n({subdomain:a});await V(`/app/instances/${c.instance.id}`)}catch(c){w(c,e)}},de=async(a,e,t,n=i=>{})=>{const{dbg:i,error:c,warn:s}=z(),{user:_,parseError:d}=h();try{await S(a,e,void 0,!1).then(()=>{i(`Account ${a} already exists. Logged in.`)}).catch(o=>(s("Login failed, attempting account creation."),T(a,e).then(()=>(i("Account created, proceeding to log in."),S(a,e,void 0,!1).then(()=>{i("Logged in after account creation")}).catch(r=>{throw c("Panic, auth system down"),new Error("Login system is currently down. Please contact us so we can fix this.")}))).catch(r=>{s("User input error");const b=d(r);throw new Error(`Account creation: ${b[0]}`)}))),i("User before instance creation is ",_()),await E(t).then(()=>{i(`Creation of ${t} succeeded`)}).catch(o=>{var b,u,v;if(s(`Creation of ${t} failed`),((v=(u=(b=o.data)==null?void 0:b.data)==null?void 0:u.subdomain)==null?void 0:v.code)==="validation_not_unique")throw new Error("Instance name already taken.");const r=d(o);throw new Error(`Instance creation: ${r[0]}`)})}catch(o){o("Caught widget error",{error:o}),w(o,n)}},ue=async(a=e=>{})=>{const{resendVerificationEmail:e}=h();try{await e()}catch(t){w(t,a)}},x=()=>{const{logOut:a}=h();a()},he=()=>{x(),window.location.href="/"};var O=(a=>(a.Primary="primary",a.Secondary="secondary",a.Success="success",a.Danger="danger",a.Warning="warning",a.Info="info",a.Light="light",a.Dark="dark",a))(O||{});function j(a){let e;return{c(){e=p("i"),this.h()},l(t){e=I(t,"I",{class:!0}),C(e).forEach(m),this.h()},h(){y(e,"class",a[2])},m(t,n){L(t,e,n)},p(t,n){n&4&&y(e,"class",t[2])},d(t){t&&m(e)}}}function W(a){let e,t;return{c(){e=p("p"),t=B(a[0]),this.h()},l(n){e=I(n,"P",{class:!0});var i=C(e);t=G(i,a[0]),i.forEach(m),this.h()},h(){y(e,"class","fw-bold mb-0")},m(n,i){L(n,e,i),k(e,t)},p(n,i){i&1&&M(t,n[0])},d(n){n&&m(e)}}}function $(a){let e;const t=a[5].default,n=H(t,a,a[4],null);return{c(){n&&n.c()},l(i){n&&n.l(i)},m(i,c){n&&n.m(i,c),e=!0},p(i,c){n&&n.p&&(!e||c&16)&&J(n,t,i,i[4],e?Q(t,i[4],c,null):K(i[4]),null)},i(i){e||(R(n,i),e=!0)},o(i){P(n,i),e=!1},d(i){n&&n.d(i)}}}function ee(a){let e;return{c(){e=B(a[1])},l(t){e=G(t,a[1])},m(t,n){L(t,e,n)},p(t,n){n&2&&M(e,t[1])},i:D,o:D,d(t){t&&m(e)}}}function te(a){let e,t,n,i,c,s,_,d,o=a[2]&&j(a),r=a[0]&&W(a);const b=[ee,$],u=[];function v(l,f){return l[1]?0:1}return c=v(a),s=u[c]=b[c](a),{c(){e=p("div"),o&&o.c(),t=q(),n=p("div"),r&&r.c(),i=q(),s.c(),this.h()},l(l){e=I(l,"DIV",{class:!0,role:!0});var f=C(e);o&&o.l(f),t=U(f),n=I(f,"DIV",{class:!0});var g=C(n);r&&r.l(g),i=U(g),s.l(g),g.forEach(m),f.forEach(m),this.h()},h(){y(n,"class","w-100"),y(e,"class",_="alert alert-"+a[3]+" d-flex gap-3 align-items-center"),y(e,"role","alert")},m(l,f){L(l,e,f),o&&o.m(e,null),k(e,t),k(e,n),r&&r.m(n,null),k(n,i),u[c].m(n,null),d=!0},p(l,[f]){l[2]?o?o.p(l,f):(o=j(l),o.c(),o.m(e,t)):o&&(o.d(1),o=null),l[0]?r?r.p(l,f):(r=W(l),r.c(),r.m(n,i)):r&&(r.d(1),r=null);let g=c;c=v(l),c===g?u[c].p(l,f):(Z(),P(u[g],1,1,()=>{u[g]=null}),N(),s=u[c],s?s.p(l,f):(s=u[c]=b[c](l),s.c()),R(s,1),s.m(n,null)),(!d||f&8&&_!==(_="alert alert-"+l[3]+" d-flex gap-3 align-items-center"))&&y(e,"class",_)},i(l){d||(R(s),d=!0)},o(l){P(s),d=!1},d(l){l&&m(e),o&&o.d(),r&&r.d(),u[c].d()}}}function ae(a,e,t){let{$$slots:n={},$$scope:i}=e,{title:c=""}=e,{text:s=""}=e,{icon:_=""}=e,{alertType:d=O.Warning}=e;return a.$$set=o=>{"title"in o&&t(0,c=o.title),"text"in o&&t(1,s=o.text),"icon"in o&&t(2,_=o.icon),"alertType"in o&&t(3,d=o.alertType),"$$scope"in o&&t(4,i=o.$$scope)},[c,s,_,d,i,n]}class _e extends X{constructor(e){super(),Y(this,e,ae,te,A,{title:0,text:1,icon:2,alertType:3})}}export{O as A,se as a,_e as b,ue as c,de as d,E as e,S as f,re as g,he as h,le as i,fe as j,T as k,w as l};
