const DEV=!1,dev=!1;function forEach$1(A,_){return Array.isArray(A)?forEachOfArray$1(A,_):forOwnOfNonArray$1(A,_),A}function forEachOfArray$1(A,_){for(let $=0,D=A.length;$<D&&_(A[$],$)!==!1;++$);}function keys$1(A){let _=keysOfNonArray$1(A);return Array.isArray(A)&&(_=_.filter($=>$!=="length")),_}function keysOfNonArray$1(A){return A?Object.getOwnPropertyNames(A):[]}function forOwnOfNonArray$1(A,_){return forEachOfArray$1(keysOfNonArray$1(A),$=>_(A[$],$)),A}function doReduce$1(A,_,$,D,N){return A(_,(q,M)=>{N?(D=q,N=!1):D=$(D,q,M)}),D}function reduce$1(A,_,$){return doReduce$1(forEach$1,A,_,$,arguments.length<3)}function values$1(A){return keys$1(A).map(_=>A[_])}let random=A=>crypto.getRandomValues(new Uint8Array(A)),customRandom=(A,_,$)=>{let D=(2<<Math.log(A.length-1)/Math.LN2)-1,N=-~(1.6*D*_/A.length);return(q=_)=>{let M="";for(;;){let L=$(N),x=N;for(;x--;)if(M+=A[L[x]&D]||"",M.length===q)return M}}},customAlphabet=(A,_=21)=>customRandom(A,_,random),nanoid$1=(A=21)=>crypto.getRandomValues(new Uint8Array(A)).reduce((_,$)=>($&=63,$<36?_+=$.toString(36):$<62?_+=($-26).toString(36).toUpperCase():$>62?_+="-":_+="_",_),"");var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(A){return A&&A.__esModule&&Object.prototype.hasOwnProperty.call(A,"default")?A.default:A}var ansiStyles$1={exports:{}},colorName,hasRequiredColorName;function requireColorName(){return hasRequiredColorName||(hasRequiredColorName=1,colorName={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}),colorName}var conversions,hasRequiredConversions;function requireConversions(){if(hasRequiredConversions)return conversions;hasRequiredConversions=1;const A=requireColorName(),_={};for(const N of Object.keys(A))_[A[N]]=N;const $={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};conversions=$;for(const N of Object.keys($)){if(!("channels"in $[N]))throw new Error("missing channels property: "+N);if(!("labels"in $[N]))throw new Error("missing channel labels property: "+N);if($[N].labels.length!==$[N].channels)throw new Error("channel and label counts mismatch: "+N);const{channels:q,labels:M}=$[N];delete $[N].channels,delete $[N].labels,Object.defineProperty($[N],"channels",{value:q}),Object.defineProperty($[N],"labels",{value:M})}$.rgb.hsl=function(N){const q=N[0]/255,M=N[1]/255,L=N[2]/255,x=Math.min(q,M,L),F=Math.max(q,M,L),U=F-x;let V,Q;F===x?V=0:q===F?V=(M-L)/U:M===F?V=2+(L-q)/U:L===F&&(V=4+(q-M)/U),V=Math.min(V*60,360),V<0&&(V+=360);const Y=(x+F)/2;return F===x?Q=0:Y<=.5?Q=U/(F+x):Q=U/(2-F-x),[V,Q*100,Y*100]},$.rgb.hsv=function(N){let q,M,L,x,F;const U=N[0]/255,V=N[1]/255,Q=N[2]/255,Y=Math.max(U,V,Q),X=Y-Math.min(U,V,Q),ee=function(te){return(Y-te)/6/X+1/2};return X===0?(x=0,F=0):(F=X/Y,q=ee(U),M=ee(V),L=ee(Q),U===Y?x=L-M:V===Y?x=1/3+q-L:Q===Y&&(x=2/3+M-q),x<0?x+=1:x>1&&(x-=1)),[x*360,F*100,Y*100]},$.rgb.hwb=function(N){const q=N[0],M=N[1];let L=N[2];const x=$.rgb.hsl(N)[0],F=1/255*Math.min(q,Math.min(M,L));return L=1-1/255*Math.max(q,Math.max(M,L)),[x,F*100,L*100]},$.rgb.cmyk=function(N){const q=N[0]/255,M=N[1]/255,L=N[2]/255,x=Math.min(1-q,1-M,1-L),F=(1-q-x)/(1-x)||0,U=(1-M-x)/(1-x)||0,V=(1-L-x)/(1-x)||0;return[F*100,U*100,V*100,x*100]};function D(N,q){return(N[0]-q[0])**2+(N[1]-q[1])**2+(N[2]-q[2])**2}return $.rgb.keyword=function(N){const q=_[N];if(q)return q;let M=1/0,L;for(const x of Object.keys(A)){const F=A[x],U=D(N,F);U<M&&(M=U,L=x)}return L},$.keyword.rgb=function(N){return A[N]},$.rgb.xyz=function(N){let q=N[0]/255,M=N[1]/255,L=N[2]/255;q=q>.04045?((q+.055)/1.055)**2.4:q/12.92,M=M>.04045?((M+.055)/1.055)**2.4:M/12.92,L=L>.04045?((L+.055)/1.055)**2.4:L/12.92;const x=q*.4124+M*.3576+L*.1805,F=q*.2126+M*.7152+L*.0722,U=q*.0193+M*.1192+L*.9505;return[x*100,F*100,U*100]},$.rgb.lab=function(N){const q=$.rgb.xyz(N);let M=q[0],L=q[1],x=q[2];M/=95.047,L/=100,x/=108.883,M=M>.008856?M**(1/3):7.787*M+16/116,L=L>.008856?L**(1/3):7.787*L+16/116,x=x>.008856?x**(1/3):7.787*x+16/116;const F=116*L-16,U=500*(M-L),V=200*(L-x);return[F,U,V]},$.hsl.rgb=function(N){const q=N[0]/360,M=N[1]/100,L=N[2]/100;let x,F,U;if(M===0)return U=L*255,[U,U,U];L<.5?x=L*(1+M):x=L+M-L*M;const V=2*L-x,Q=[0,0,0];for(let Y=0;Y<3;Y++)F=q+1/3*-(Y-1),F<0&&F++,F>1&&F--,6*F<1?U=V+(x-V)*6*F:2*F<1?U=x:3*F<2?U=V+(x-V)*(2/3-F)*6:U=V,Q[Y]=U*255;return Q},$.hsl.hsv=function(N){const q=N[0];let M=N[1]/100,L=N[2]/100,x=M;const F=Math.max(L,.01);L*=2,M*=L<=1?L:2-L,x*=F<=1?F:2-F;const U=(L+M)/2,V=L===0?2*x/(F+x):2*M/(L+M);return[q,V*100,U*100]},$.hsv.rgb=function(N){const q=N[0]/60,M=N[1]/100;let L=N[2]/100;const x=Math.floor(q)%6,F=q-Math.floor(q),U=255*L*(1-M),V=255*L*(1-M*F),Q=255*L*(1-M*(1-F));switch(L*=255,x){case 0:return[L,Q,U];case 1:return[V,L,U];case 2:return[U,L,Q];case 3:return[U,V,L];case 4:return[Q,U,L];case 5:return[L,U,V]}},$.hsv.hsl=function(N){const q=N[0],M=N[1]/100,L=N[2]/100,x=Math.max(L,.01);let F,U;U=(2-M)*L;const V=(2-M)*x;return F=M*x,F/=V<=1?V:2-V,F=F||0,U/=2,[q,F*100,U*100]},$.hwb.rgb=function(N){const q=N[0]/360;let M=N[1]/100,L=N[2]/100;const x=M+L;let F;x>1&&(M/=x,L/=x);const U=Math.floor(6*q),V=1-L;F=6*q-U,U&1&&(F=1-F);const Q=M+F*(V-M);let Y,X,ee;switch(U){default:case 6:case 0:Y=V,X=Q,ee=M;break;case 1:Y=Q,X=V,ee=M;break;case 2:Y=M,X=V,ee=Q;break;case 3:Y=M,X=Q,ee=V;break;case 4:Y=Q,X=M,ee=V;break;case 5:Y=V,X=M,ee=Q;break}return[Y*255,X*255,ee*255]},$.cmyk.rgb=function(N){const q=N[0]/100,M=N[1]/100,L=N[2]/100,x=N[3]/100,F=1-Math.min(1,q*(1-x)+x),U=1-Math.min(1,M*(1-x)+x),V=1-Math.min(1,L*(1-x)+x);return[F*255,U*255,V*255]},$.xyz.rgb=function(N){const q=N[0]/100,M=N[1]/100,L=N[2]/100;let x,F,U;return x=q*3.2406+M*-1.5372+L*-.4986,F=q*-.9689+M*1.8758+L*.0415,U=q*.0557+M*-.204+L*1.057,x=x>.0031308?1.055*x**(1/2.4)-.055:x*12.92,F=F>.0031308?1.055*F**(1/2.4)-.055:F*12.92,U=U>.0031308?1.055*U**(1/2.4)-.055:U*12.92,x=Math.min(Math.max(0,x),1),F=Math.min(Math.max(0,F),1),U=Math.min(Math.max(0,U),1),[x*255,F*255,U*255]},$.xyz.lab=function(N){let q=N[0],M=N[1],L=N[2];q/=95.047,M/=100,L/=108.883,q=q>.008856?q**(1/3):7.787*q+16/116,M=M>.008856?M**(1/3):7.787*M+16/116,L=L>.008856?L**(1/3):7.787*L+16/116;const x=116*M-16,F=500*(q-M),U=200*(M-L);return[x,F,U]},$.lab.xyz=function(N){const q=N[0],M=N[1],L=N[2];let x,F,U;F=(q+16)/116,x=M/500+F,U=F-L/200;const V=F**3,Q=x**3,Y=U**3;return F=V>.008856?V:(F-16/116)/7.787,x=Q>.008856?Q:(x-16/116)/7.787,U=Y>.008856?Y:(U-16/116)/7.787,x*=95.047,F*=100,U*=108.883,[x,F,U]},$.lab.lch=function(N){const q=N[0],M=N[1],L=N[2];let x;x=Math.atan2(L,M)*360/2/Math.PI,x<0&&(x+=360);const U=Math.sqrt(M*M+L*L);return[q,U,x]},$.lch.lab=function(N){const q=N[0],M=N[1],x=N[2]/360*2*Math.PI,F=M*Math.cos(x),U=M*Math.sin(x);return[q,F,U]},$.rgb.ansi16=function(N,q=null){const[M,L,x]=N;let F=q===null?$.rgb.hsv(N)[2]:q;if(F=Math.round(F/50),F===0)return 30;let U=30+(Math.round(x/255)<<2|Math.round(L/255)<<1|Math.round(M/255));return F===2&&(U+=60),U},$.hsv.ansi16=function(N){return $.rgb.ansi16($.hsv.rgb(N),N[2])},$.rgb.ansi256=function(N){const q=N[0],M=N[1],L=N[2];return q===M&&M===L?q<8?16:q>248?231:Math.round((q-8)/247*24)+232:16+36*Math.round(q/255*5)+6*Math.round(M/255*5)+Math.round(L/255*5)},$.ansi16.rgb=function(N){let q=N%10;if(q===0||q===7)return N>50&&(q+=3.5),q=q/10.5*255,[q,q,q];const M=(~~(N>50)+1)*.5,L=(q&1)*M*255,x=(q>>1&1)*M*255,F=(q>>2&1)*M*255;return[L,x,F]},$.ansi256.rgb=function(N){if(N>=232){const F=(N-232)*10+8;return[F,F,F]}N-=16;let q;const M=Math.floor(N/36)/5*255,L=Math.floor((q=N%36)/6)/5*255,x=q%6/5*255;return[M,L,x]},$.rgb.hex=function(N){const M=(((Math.round(N[0])&255)<<16)+((Math.round(N[1])&255)<<8)+(Math.round(N[2])&255)).toString(16).toUpperCase();return"000000".substring(M.length)+M},$.hex.rgb=function(N){const q=N.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!q)return[0,0,0];let M=q[0];q[0].length===3&&(M=M.split("").map(V=>V+V).join(""));const L=parseInt(M,16),x=L>>16&255,F=L>>8&255,U=L&255;return[x,F,U]},$.rgb.hcg=function(N){const q=N[0]/255,M=N[1]/255,L=N[2]/255,x=Math.max(Math.max(q,M),L),F=Math.min(Math.min(q,M),L),U=x-F;let V,Q;return U<1?V=F/(1-U):V=0,U<=0?Q=0:x===q?Q=(M-L)/U%6:x===M?Q=2+(L-q)/U:Q=4+(q-M)/U,Q/=6,Q%=1,[Q*360,U*100,V*100]},$.hsl.hcg=function(N){const q=N[1]/100,M=N[2]/100,L=M<.5?2*q*M:2*q*(1-M);let x=0;return L<1&&(x=(M-.5*L)/(1-L)),[N[0],L*100,x*100]},$.hsv.hcg=function(N){const q=N[1]/100,M=N[2]/100,L=q*M;let x=0;return L<1&&(x=(M-L)/(1-L)),[N[0],L*100,x*100]},$.hcg.rgb=function(N){const q=N[0]/360,M=N[1]/100,L=N[2]/100;if(M===0)return[L*255,L*255,L*255];const x=[0,0,0],F=q%1*6,U=F%1,V=1-U;let Q=0;switch(Math.floor(F)){case 0:x[0]=1,x[1]=U,x[2]=0;break;case 1:x[0]=V,x[1]=1,x[2]=0;break;case 2:x[0]=0,x[1]=1,x[2]=U;break;case 3:x[0]=0,x[1]=V,x[2]=1;break;case 4:x[0]=U,x[1]=0,x[2]=1;break;default:x[0]=1,x[1]=0,x[2]=V}return Q=(1-M)*L,[(M*x[0]+Q)*255,(M*x[1]+Q)*255,(M*x[2]+Q)*255]},$.hcg.hsv=function(N){const q=N[1]/100,M=N[2]/100,L=q+M*(1-q);let x=0;return L>0&&(x=q/L),[N[0],x*100,L*100]},$.hcg.hsl=function(N){const q=N[1]/100,L=N[2]/100*(1-q)+.5*q;let x=0;return L>0&&L<.5?x=q/(2*L):L>=.5&&L<1&&(x=q/(2*(1-L))),[N[0],x*100,L*100]},$.hcg.hwb=function(N){const q=N[1]/100,M=N[2]/100,L=q+M*(1-q);return[N[0],(L-q)*100,(1-L)*100]},$.hwb.hcg=function(N){const q=N[1]/100,L=1-N[2]/100,x=L-q;let F=0;return x<1&&(F=(L-x)/(1-x)),[N[0],x*100,F*100]},$.apple.rgb=function(N){return[N[0]/65535*255,N[1]/65535*255,N[2]/65535*255]},$.rgb.apple=function(N){return[N[0]/255*65535,N[1]/255*65535,N[2]/255*65535]},$.gray.rgb=function(N){return[N[0]/100*255,N[0]/100*255,N[0]/100*255]},$.gray.hsl=function(N){return[0,0,N[0]]},$.gray.hsv=$.gray.hsl,$.gray.hwb=function(N){return[0,100,N[0]]},$.gray.cmyk=function(N){return[0,0,0,N[0]]},$.gray.lab=function(N){return[N[0],0,0]},$.gray.hex=function(N){const q=Math.round(N[0]/100*255)&255,L=((q<<16)+(q<<8)+q).toString(16).toUpperCase();return"000000".substring(L.length)+L},$.rgb.gray=function(N){return[(N[0]+N[1]+N[2])/3/255*100]},conversions}var route,hasRequiredRoute;function requireRoute(){if(hasRequiredRoute)return route;hasRequiredRoute=1;const A=requireConversions();function _(){const q={},M=Object.keys(A);for(let L=M.length,x=0;x<L;x++)q[M[x]]={distance:-1,parent:null};return q}function $(q){const M=_(),L=[q];for(M[q].distance=0;L.length;){const x=L.pop(),F=Object.keys(A[x]);for(let U=F.length,V=0;V<U;V++){const Q=F[V],Y=M[Q];Y.distance===-1&&(Y.distance=M[x].distance+1,Y.parent=x,L.unshift(Q))}}return M}function D(q,M){return function(L){return M(q(L))}}function N(q,M){const L=[M[q].parent,q];let x=A[M[q].parent][q],F=M[q].parent;for(;M[F].parent;)L.unshift(M[F].parent),x=D(A[M[F].parent][F],x),F=M[F].parent;return x.conversion=L,x}return route=function(q){const M=$(q),L={},x=Object.keys(M);for(let F=x.length,U=0;U<F;U++){const V=x[U];M[V].parent!==null&&(L[V]=N(V,M))}return L},route}var colorConvert,hasRequiredColorConvert;function requireColorConvert(){if(hasRequiredColorConvert)return colorConvert;hasRequiredColorConvert=1;const A=requireConversions(),_=requireRoute(),$={},D=Object.keys(A);function N(M){const L=function(...x){const F=x[0];return F==null?F:(F.length>1&&(x=F),M(x))};return"conversion"in M&&(L.conversion=M.conversion),L}function q(M){const L=function(...x){const F=x[0];if(F==null)return F;F.length>1&&(x=F);const U=M(x);if(typeof U=="object")for(let V=U.length,Q=0;Q<V;Q++)U[Q]=Math.round(U[Q]);return U};return"conversion"in M&&(L.conversion=M.conversion),L}return D.forEach(M=>{$[M]={},Object.defineProperty($[M],"channels",{value:A[M].channels}),Object.defineProperty($[M],"labels",{value:A[M].labels});const L=_(M);Object.keys(L).forEach(F=>{const U=L[F];$[M][F]=q(U),$[M][F].raw=N(U)})}),colorConvert=$,colorConvert}ansiStyles$1.exports;(function(A){const _=(U,V)=>(...Q)=>`\x1B[${U(...Q)+V}m`,$=(U,V)=>(...Q)=>{const Y=U(...Q);return`\x1B[${38+V};5;${Y}m`},D=(U,V)=>(...Q)=>{const Y=U(...Q);return`\x1B[${38+V};2;${Y[0]};${Y[1]};${Y[2]}m`},N=U=>U,q=(U,V,Q)=>[U,V,Q],M=(U,V,Q)=>{Object.defineProperty(U,V,{get:()=>{const Y=Q();return Object.defineProperty(U,V,{value:Y,enumerable:!0,configurable:!0}),Y},enumerable:!0,configurable:!0})};let L;const x=(U,V,Q,Y)=>{L===void 0&&(L=requireColorConvert());const X=Y?10:0,ee={};for(const[te,z]of Object.entries(L)){const G=te==="ansi16"?"ansi":te;te===V?ee[G]=U(Q,X):typeof z=="object"&&(ee[G]=U(z[V],X))}return ee};function F(){const U=new Map,V={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};V.color.gray=V.color.blackBright,V.bgColor.bgGray=V.bgColor.bgBlackBright,V.color.grey=V.color.blackBright,V.bgColor.bgGrey=V.bgColor.bgBlackBright;for(const[Q,Y]of Object.entries(V)){for(const[X,ee]of Object.entries(Y))V[X]={open:`\x1B[${ee[0]}m`,close:`\x1B[${ee[1]}m`},Y[X]=V[X],U.set(ee[0],ee[1]);Object.defineProperty(V,Q,{value:Y,enumerable:!1})}return Object.defineProperty(V,"codes",{value:U,enumerable:!1}),V.color.close="\x1B[39m",V.bgColor.close="\x1B[49m",M(V.color,"ansi",()=>x(_,"ansi16",N,!1)),M(V.color,"ansi256",()=>x($,"ansi256",N,!1)),M(V.color,"ansi16m",()=>x(D,"rgb",q,!1)),M(V.bgColor,"ansi",()=>x(_,"ansi16",N,!0)),M(V.bgColor,"ansi256",()=>x($,"ansi256",N,!0)),M(V.bgColor,"ansi16m",()=>x(D,"rgb",q,!0)),V}Object.defineProperty(A,"exports",{enumerable:!0,get:F})})(ansiStyles$1);var ansiStylesExports=ansiStyles$1.exports,browser={stdout:!1,stderr:!1};const stringReplaceAll$1=(A,_,$)=>{let D=A.indexOf(_);if(D===-1)return A;const N=_.length;let q=0,M="";do M+=A.substr(q,D-q)+_+$,q=D+N,D=A.indexOf(_,q);while(D!==-1);return M+=A.substr(q),M},stringEncaseCRLFWithFirstIndex$1=(A,_,$,D)=>{let N=0,q="";do{const M=A[D-1]==="\r";q+=A.substr(N,(M?D-1:D)-N)+_+(M?`\r
`:`
`)+$,N=D+1,D=A.indexOf(`
`,N)}while(D!==-1);return q+=A.substr(N),q};var util$1={stringReplaceAll:stringReplaceAll$1,stringEncaseCRLFWithFirstIndex:stringEncaseCRLFWithFirstIndex$1},templates,hasRequiredTemplates;function requireTemplates(){if(hasRequiredTemplates)return templates;hasRequiredTemplates=1;const A=/(?:\\(u(?:[a-f\d]{4}|\{[a-f\d]{1,6}\})|x[a-f\d]{2}|.))|(?:\{(~)?(\w+(?:\([^)]*\))?(?:\.\w+(?:\([^)]*\))?)*)(?:[ \t]|(?=\r?\n)))|(\})|((?:.|[\r\n\f])+?)/gi,_=/(?:^|\.)(\w+)(?:\(([^)]*)\))?/g,$=/^(['"])((?:\\.|(?!\1)[^\\])*)\1$/,D=/\\(u(?:[a-f\d]{4}|{[a-f\d]{1,6}})|x[a-f\d]{2}|.)|([^\\])/gi,N=new Map([["n",`
`],["r","\r"],["t","	"],["b","\b"],["f","\f"],["v","\v"],["0","\0"],["\\","\\"],["e","\x1B"],["a","\x07"]]);function q(F){const U=F[0]==="u",V=F[1]==="{";return U&&!V&&F.length===5||F[0]==="x"&&F.length===3?String.fromCharCode(parseInt(F.slice(1),16)):U&&V?String.fromCodePoint(parseInt(F.slice(2,-1),16)):N.get(F)||F}function M(F,U){const V=[],Q=U.trim().split(/\s*,\s*/g);let Y;for(const X of Q){const ee=Number(X);if(!Number.isNaN(ee))V.push(ee);else if(Y=X.match($))V.push(Y[2].replace(D,(te,z,G)=>z?q(z):G));else throw new Error(`Invalid Chalk template style argument: ${X} (in style '${F}')`)}return V}function L(F){_.lastIndex=0;const U=[];let V;for(;(V=_.exec(F))!==null;){const Q=V[1];if(V[2]){const Y=M(Q,V[2]);U.push([Q].concat(Y))}else U.push([Q])}return U}function x(F,U){const V={};for(const Y of U)for(const X of Y.styles)V[X[0]]=Y.inverse?null:X.slice(1);let Q=F;for(const[Y,X]of Object.entries(V))if(Array.isArray(X)){if(!(Y in Q))throw new Error(`Unknown Chalk style: ${Y}`);Q=X.length>0?Q[Y](...X):Q[Y]}return Q}return templates=(F,U)=>{const V=[],Q=[];let Y=[];if(U.replace(A,(X,ee,te,z,G,H)=>{if(ee)Y.push(q(ee));else if(z){const W=Y.join("");Y=[],Q.push(V.length===0?W:x(F,V)(W)),V.push({inverse:te,styles:L(z)})}else if(G){if(V.length===0)throw new Error("Found extraneous } in Chalk template literal");Q.push(x(F,V)(Y.join(""))),Y=[],V.pop()}else Y.push(H)}),Q.push(Y.join("")),V.length>0){const X=`Chalk template literal is missing ${V.length} closing bracket${V.length===1?"":"s"} (\`}\`)`;throw new Error(X)}return Q.join("")},templates}const ansiStyles=ansiStylesExports,{stdout:stdoutColor,stderr:stderrColor}=browser,{stringReplaceAll,stringEncaseCRLFWithFirstIndex}=util$1,{isArray}=Array,levelMapping=["ansi","ansi","ansi256","ansi16m"],styles=Object.create(null),applyOptions=(A,_={})=>{if(_.level&&!(Number.isInteger(_.level)&&_.level>=0&&_.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");const $=stdoutColor?stdoutColor.level:0;A.level=_.level===void 0?$:_.level};class ChalkClass{constructor(_){return chalkFactory(_)}}const chalkFactory=A=>{const _={};return applyOptions(_,A),_.template=(...$)=>chalkTag(_.template,...$),Object.setPrototypeOf(_,Chalk.prototype),Object.setPrototypeOf(_.template,_),_.template.constructor=()=>{throw new Error("`chalk.constructor()` is deprecated. Use `new chalk.Instance()` instead.")},_.template.Instance=ChalkClass,_.template};function Chalk(A){return chalkFactory(A)}for(const[A,_]of Object.entries(ansiStyles))styles[A]={get(){const $=createBuilder(this,createStyler(_.open,_.close,this._styler),this._isEmpty);return Object.defineProperty(this,A,{value:$}),$}};styles.visible={get(){const A=createBuilder(this,this._styler,!0);return Object.defineProperty(this,"visible",{value:A}),A}};const usedModels=["rgb","hex","keyword","hsl","hsv","hwb","ansi","ansi256"];for(const A of usedModels)styles[A]={get(){const{level:_}=this;return function(...$){const D=createStyler(ansiStyles.color[levelMapping[_]][A](...$),ansiStyles.color.close,this._styler);return createBuilder(this,D,this._isEmpty)}}};for(const A of usedModels){const _="bg"+A[0].toUpperCase()+A.slice(1);styles[_]={get(){const{level:$}=this;return function(...D){const N=createStyler(ansiStyles.bgColor[levelMapping[$]][A](...D),ansiStyles.bgColor.close,this._styler);return createBuilder(this,N,this._isEmpty)}}}}const proto=Object.defineProperties(()=>{},{...styles,level:{enumerable:!0,get(){return this._generator.level},set(A){this._generator.level=A}}}),createStyler=(A,_,$)=>{let D,N;return $===void 0?(D=A,N=_):(D=$.openAll+A,N=_+$.closeAll),{open:A,close:_,openAll:D,closeAll:N,parent:$}},createBuilder=(A,_,$)=>{const D=(...N)=>isArray(N[0])&&isArray(N[0].raw)?applyStyle(D,chalkTag(D,...N)):applyStyle(D,N.length===1?""+N[0]:N.join(" "));return Object.setPrototypeOf(D,proto),D._generator=A,D._styler=_,D._isEmpty=$,D},applyStyle=(A,_)=>{if(A.level<=0||!_)return A._isEmpty?"":_;let $=A._styler;if($===void 0)return _;const{openAll:D,closeAll:N}=$;if(_.indexOf("\x1B")!==-1)for(;$!==void 0;)_=stringReplaceAll(_,$.close,$.open),$=$.parent;const q=_.indexOf(`
`);return q!==-1&&(_=stringEncaseCRLFWithFirstIndex(_,N,D,q)),D+_+N};let template;const chalkTag=(A,..._)=>{const[$]=_;if(!isArray($)||!isArray($.raw))return _.join(" ");const D=_.slice(1),N=[$.raw[0]];for(let q=1;q<$.length;q++)N.push(String(D[q-1]).replace(/[{}\\]/g,"\\$&"),String($.raw[q]));return template===void 0&&(template=requireTemplates()),template(A,N.join(""))};Object.defineProperties(Chalk.prototype,styles);const chalk=Chalk();chalk.supportsColor=stdoutColor;chalk.stderr=Chalk({level:stderrColor?stderrColor.level:0});chalk.stderr.supportsColor=stderrColor;var source=chalk;const chalk$1=getDefaultExportFromCjs(source),mkSingleton=A=>{let _;return $=>{if(_&&$)throw new Error("Attempted to initialize service twice");if(!_){if(!$)throw new Error("Attempted to use service before initialization");_=A($)}return _}},MAX_BUF=1e3;let _curIdx=0;const _buf=[],createLogger=A=>{const _={raw:!1,debug:!0,trace:!1,errorTrace:!1,pfx:[""],...A},{pfx:$,errorTrace:D}=_,N=z=>[new Date().toISOString(),z,...$].filter(G=>!!G).map(G=>`[${G}]`).join(" "),q=(z="log",G,...H)=>{_buf.length<MAX_BUF?_buf.push(H):(_buf[_curIdx]=H,_curIdx++,_curIdx===MAX_BUF&&(_curIdx=0)),G&&console[z](...H.map(W=>{const ae=typeof W;return ae==="string"&&W.match(/\n/)?JSON.stringify(W,null,2):ae==="function"?`<<function ${JSON.stringify(W.toString())}>>`:ae==="object"?JSON.stringify(W,null,2):W}))},M=(...z)=>{q("log",_.raw,N("RAW"),...z)},L=(...z)=>{q("debug",_.debug,N(chalk$1.blueBright("DBG")),...z)},x=(...z)=>{q("warn",!0,N(chalk$1.yellow(chalk$1.cyanBright("WARN"))),...z)},F=(...z)=>{q("log",!0,N(chalk$1.gray("INFO")),...z)},U=(...z)=>{q("trace",_.trace,N("TRACE"),...z)},V=(...z)=>{q("error",!0,N(chalk$1.bgRed("ERROR")),...z),D&&(console.error("========== ERROR TRACEBACK BEGIN =============="),[..._buf.slice(_curIdx,MAX_BUF),..._buf.slice(0,_curIdx)].forEach(G=>{console.error(...G)}),console.error("========== ERROR TRACEBACK END =============="))},Q=(...z)=>{throw q("error",!0,N(chalk$1.bgRed("ABORT")),...z),new Error(`Fatal error: ${JSON.stringify(z)}`)},Y=(z,G)=>createLogger({..._,...G,pfx:[..._.pfx,z]}),te={raw:M,dbg:L,warn:x,info:F,error:V,create:Y,child:z=>Y(JSON.stringify(z)),trace:U,debug:L,breadcrumb:z=>($.push(z),te),abort:Q,shutdown(){L("Logger shutting down")}};return te},logger=mkSingleton(A=>createLogger(A)),createTimerManager=A=>{const{dbg:_,error:$}=logger().create("timerManager");let D=0;const N={};let q=!1;const M=(F,U)=>{if(q)throw new Error("Already shut down");const V=D++,Q=setTimeout(async()=>{Y();try{await F()}catch(X){$(X)}},U),Y=()=>{clearTimeout(Q),delete N[V]};return N[V]=Y,Y};return{add:M,shutdown:()=>{q=!0,_(`Canceling  ${values$1(N.length).length} timers`),forEach$1(N,F=>F()),_("done",N)},repeat:(F,U)=>{let V;const Q=async()=>{await F()&&!q&&(V=M(Q,U))};return Q().catch($),()=>{V==null||V(),V=void 0}}}};function assertExists(A,_="Value does not exist"){if(typeof A>"u")throw new Error(_)}function assertTruthy(A,_="Value should be truthy"){if(!A)throw new Error(_)}var parser$5={};parser$5.load=function(A,_,$={}){var D,N,q;for(D in _)q=_[D],$[D]=(N=A[D])!=null?N:q;return $};parser$5.overwrite=function(A,_,$={}){var D,N;for(D in A)N=A[D],_[D]!==void 0&&($[D]=N);return $};var DLList$2;DLList$2=class{constructor(_,$){this.incr=_,this.decr=$,this._first=null,this._last=null,this.length=0}push(_){var $;this.length++,typeof this.incr=="function"&&this.incr(),$={value:_,prev:this._last,next:null},this._last!=null?(this._last.next=$,this._last=$):this._first=this._last=$}shift(){var _;if(this._first!=null)return this.length--,typeof this.decr=="function"&&this.decr(),_=this._first.value,(this._first=this._first.next)!=null?this._first.prev=null:this._last=null,_}first(){if(this._first!=null)return this._first.value}getArray(){var _,$,D;for(_=this._first,D=[];_!=null;)D.push(($=_,_=_.next,$.value));return D}forEachShift(_){var $;for($=this.shift();$!=null;)_($),$=this.shift()}debug(){var _,$,D,N,q;for(_=this._first,q=[];_!=null;)q.push(($=_,_=_.next,{value:$.value,prev:(D=$.prev)!=null?D.value:void 0,next:(N=$.next)!=null?N.value:void 0}));return q}};var DLList_1=DLList$2;function asyncGeneratorStep$6(A,_,$,D,N,q,M){try{var L=A[q](M),x=L.value}catch(F){$(F);return}L.done?_(x):Promise.resolve(x).then(D,N)}function _asyncToGenerator$6(A){return function(){var _=this,$=arguments;return new Promise(function(D,N){var q=A.apply(_,$);function M(x){asyncGeneratorStep$6(q,D,N,M,L,"next",x)}function L(x){asyncGeneratorStep$6(q,D,N,M,L,"throw",x)}M(void 0)})}}var Events$3;Events$3=class{constructor(_){if(this.instance=_,this._events={},this.instance.on!=null||this.instance.once!=null||this.instance.removeAllListeners!=null)throw new Error("An Emitter already exists for this object");this.instance.on=($,D)=>this._addListener($,"many",D),this.instance.once=($,D)=>this._addListener($,"once",D),this.instance.removeAllListeners=($=null)=>$!=null?delete this._events[$]:this._events={}}_addListener(_,$,D){var N;return(N=this._events)[_]==null&&(N[_]=[]),this._events[_].push({cb:D,status:$}),this.instance}listenerCount(_){return this._events[_]!=null?this._events[_].length:0}trigger(_,...$){var D=this;return _asyncToGenerator$6(function*(){var N,q;try{return _!=="debug"&&D.trigger("debug",`Event triggered: ${_}`,$),D._events[_]==null?void 0:(D._events[_]=D._events[_].filter(function(M){return M.status!=="none"}),q=D._events[_].map(function(){var M=_asyncToGenerator$6(function*(L){var x,F;if(L.status!=="none"){L.status==="once"&&(L.status="none");try{return F=typeof L.cb=="function"?L.cb(...$):void 0,typeof(F!=null?F.then:void 0)=="function"?yield F:F}catch(U){return x=U,D.trigger("error",x),null}}});return function(L){return M.apply(this,arguments)}}()),(yield Promise.all(q)).find(function(M){return M!=null}))}catch(M){return N=M,D.trigger("error",N),null}})()}};var Events_1=Events$3,DLList$1,Events$2,Queues;DLList$1=DLList_1;Events$2=Events_1;Queues=class{constructor(_){this.Events=new Events$2(this),this._length=0,this._lists=(function(){var $,D,N;for(N=[],$=1,D=_;1<=D?$<=D:$>=D;1<=D?++$:--$)N.push(new DLList$1(()=>this.incr(),()=>this.decr()));return N}).call(this)}incr(){if(this._length++===0)return this.Events.trigger("leftzero")}decr(){if(--this._length===0)return this.Events.trigger("zero")}push(_){return this._lists[_.options.priority].push(_)}queued(_){return _!=null?this._lists[_].length:this._length}shiftAll(_){return this._lists.forEach(function($){return $.forEachShift(_)})}getFirst(_=this._lists){var $,D,N;for($=0,D=_.length;$<D;$++)if(N=_[$],N.length>0)return N;return[]}shiftLastFrom(_){return this.getFirst(this._lists.slice(_).reverse()).shift()}};var Queues_1=Queues,BottleneckError$4;BottleneckError$4=class extends Error{};var BottleneckError_1=BottleneckError$4;function asyncGeneratorStep$5(A,_,$,D,N,q,M){try{var L=A[q](M),x=L.value}catch(F){$(F);return}L.done?_(x):Promise.resolve(x).then(D,N)}function _asyncToGenerator$5(A){return function(){var _=this,$=arguments;return new Promise(function(D,N){var q=A.apply(_,$);function M(x){asyncGeneratorStep$5(q,D,N,M,L,"next",x)}function L(x){asyncGeneratorStep$5(q,D,N,M,L,"throw",x)}M(void 0)})}}var BottleneckError$3,DEFAULT_PRIORITY,Job,NUM_PRIORITIES,parser$4;NUM_PRIORITIES=10;DEFAULT_PRIORITY=5;parser$4=parser$5;BottleneckError$3=BottleneckError_1;Job=class{constructor(_,$,D,N,q,M,L,x){this.task=_,this.args=$,this.rejectOnDrop=q,this.Events=M,this._states=L,this.Promise=x,this.options=parser$4.load(D,N),this.options.priority=this._sanitizePriority(this.options.priority),this.options.id===N.id&&(this.options.id=`${this.options.id}-${this._randomIndex()}`),this.promise=new this.Promise((F,U)=>{this._resolve=F,this._reject=U}),this.retryCount=0}_sanitizePriority(_){var $;return $=~~_!==_?DEFAULT_PRIORITY:_,$<0?0:$>NUM_PRIORITIES-1?NUM_PRIORITIES-1:$}_randomIndex(){return Math.random().toString(36).slice(2)}doDrop({error:_,message:$="This job has been dropped by Bottleneck"}={}){return this._states.remove(this.options.id)?(this.rejectOnDrop&&this._reject(_??new BottleneckError$3($)),this.Events.trigger("dropped",{args:this.args,options:this.options,task:this.task,promise:this.promise}),!0):!1}_assertStatus(_){var $;if($=this._states.jobStatus(this.options.id),!($===_||_==="DONE"&&$===null))throw new BottleneckError$3(`Invalid job status ${$}, expected ${_}. Please open an issue at https://github.com/SGrondin/bottleneck/issues`)}doReceive(){return this._states.start(this.options.id),this.Events.trigger("received",{args:this.args,options:this.options})}doQueue(_,$){return this._assertStatus("RECEIVED"),this._states.next(this.options.id),this.Events.trigger("queued",{args:this.args,options:this.options,reachedHWM:_,blocked:$})}doRun(){return this.retryCount===0?(this._assertStatus("QUEUED"),this._states.next(this.options.id)):this._assertStatus("EXECUTING"),this.Events.trigger("scheduled",{args:this.args,options:this.options})}doExecute(_,$,D,N){var q=this;return _asyncToGenerator$5(function*(){var M,L,x;q.retryCount===0?(q._assertStatus("RUNNING"),q._states.next(q.options.id)):q._assertStatus("EXECUTING"),L={args:q.args,options:q.options,retryCount:q.retryCount},q.Events.trigger("executing",L);try{if(x=yield _!=null?_.schedule(q.options,q.task,...q.args):q.task(...q.args),$())return q.doDone(L),yield N(q.options,L),q._assertStatus("DONE"),q._resolve(x)}catch(F){return M=F,q._onFailure(M,L,$,D,N)}})()}doExpire(_,$,D){var N,q;return this._states.jobStatus(this.options.id==="RUNNING")&&this._states.next(this.options.id),this._assertStatus("EXECUTING"),q={args:this.args,options:this.options,retryCount:this.retryCount},N=new BottleneckError$3(`This job timed out after ${this.options.expiration} ms.`),this._onFailure(N,q,_,$,D)}_onFailure(_,$,D,N,q){var M=this;return _asyncToGenerator$5(function*(){var L,x;if(D())return L=yield M.Events.trigger("failed",_,$),L!=null?(x=~~L,M.Events.trigger("retry",`Retrying ${M.options.id} after ${x} ms`,$),M.retryCount++,N(x)):(M.doDone($),yield q(M.options,$),M._assertStatus("DONE"),M._reject(_))})()}doDone(_){return this._assertStatus("EXECUTING"),this._states.next(this.options.id),this.Events.trigger("done",_)}};var Job_1=Job;function asyncGeneratorStep$4(A,_,$,D,N,q,M){try{var L=A[q](M),x=L.value}catch(F){$(F);return}L.done?_(x):Promise.resolve(x).then(D,N)}function _asyncToGenerator$4(A){return function(){var _=this,$=arguments;return new Promise(function(D,N){var q=A.apply(_,$);function M(x){asyncGeneratorStep$4(q,D,N,M,L,"next",x)}function L(x){asyncGeneratorStep$4(q,D,N,M,L,"throw",x)}M(void 0)})}}var BottleneckError$2,LocalDatastore,parser$3;parser$3=parser$5;BottleneckError$2=BottleneckError_1;LocalDatastore=class{constructor(_,$,D){this.instance=_,this.storeOptions=$,this.clientId=this.instance._randomIndex(),parser$3.load(D,D,this),this._nextRequest=this._lastReservoirRefresh=this._lastReservoirIncrease=Date.now(),this._running=0,this._done=0,this._unblockTime=0,this.ready=this.Promise.resolve(),this.clients={},this._startHeartbeat()}_startHeartbeat(){var _;return this.heartbeat==null&&(this.storeOptions.reservoirRefreshInterval!=null&&this.storeOptions.reservoirRefreshAmount!=null||this.storeOptions.reservoirIncreaseInterval!=null&&this.storeOptions.reservoirIncreaseAmount!=null)?typeof(_=this.heartbeat=setInterval(()=>{var $,D,N,q,M;if(q=Date.now(),this.storeOptions.reservoirRefreshInterval!=null&&q>=this._lastReservoirRefresh+this.storeOptions.reservoirRefreshInterval&&(this._lastReservoirRefresh=q,this.storeOptions.reservoir=this.storeOptions.reservoirRefreshAmount,this.instance._drainAll(this.computeCapacity())),this.storeOptions.reservoirIncreaseInterval!=null&&q>=this._lastReservoirIncrease+this.storeOptions.reservoirIncreaseInterval){var L=this.storeOptions;if($=L.reservoirIncreaseAmount,N=L.reservoirIncreaseMaximum,M=L.reservoir,this._lastReservoirIncrease=q,D=N!=null?Math.min($,N-M):$,D>0)return this.storeOptions.reservoir+=D,this.instance._drainAll(this.computeCapacity())}},this.heartbeatInterval)).unref=="function"?_.unref():void 0:clearInterval(this.heartbeat)}__publish__(_){var $=this;return _asyncToGenerator$4(function*(){return yield $.yieldLoop(),$.instance.Events.trigger("message",_.toString())})()}__disconnect__(_){var $=this;return _asyncToGenerator$4(function*(){return yield $.yieldLoop(),clearInterval($.heartbeat),$.Promise.resolve()})()}yieldLoop(_=0){return new this.Promise(function($,D){return setTimeout($,_)})}computePenalty(){var _;return(_=this.storeOptions.penalty)!=null?_:15*this.storeOptions.minTime||5e3}__updateSettings__(_){var $=this;return _asyncToGenerator$4(function*(){return yield $.yieldLoop(),parser$3.overwrite(_,_,$.storeOptions),$._startHeartbeat(),$.instance._drainAll($.computeCapacity()),!0})()}__running__(){var _=this;return _asyncToGenerator$4(function*(){return yield _.yieldLoop(),_._running})()}__queued__(){var _=this;return _asyncToGenerator$4(function*(){return yield _.yieldLoop(),_.instance.queued()})()}__done__(){var _=this;return _asyncToGenerator$4(function*(){return yield _.yieldLoop(),_._done})()}__groupCheck__(_){var $=this;return _asyncToGenerator$4(function*(){return yield $.yieldLoop(),$._nextRequest+$.timeout<_})()}computeCapacity(){var _,$,D=this.storeOptions;return _=D.maxConcurrent,$=D.reservoir,_!=null&&$!=null?Math.min(_-this._running,$):_!=null?_-this._running:$??null}conditionsCheck(_){var $;return $=this.computeCapacity(),$==null||_<=$}__incrementReservoir__(_){var $=this;return _asyncToGenerator$4(function*(){var D;return yield $.yieldLoop(),D=$.storeOptions.reservoir+=_,$.instance._drainAll($.computeCapacity()),D})()}__currentReservoir__(){var _=this;return _asyncToGenerator$4(function*(){return yield _.yieldLoop(),_.storeOptions.reservoir})()}isBlocked(_){return this._unblockTime>=_}check(_,$){return this.conditionsCheck(_)&&this._nextRequest-$<=0}__check__(_){var $=this;return _asyncToGenerator$4(function*(){var D;return yield $.yieldLoop(),D=Date.now(),$.check(_,D)})()}__register__(_,$,D){var N=this;return _asyncToGenerator$4(function*(){var q,M;return yield N.yieldLoop(),q=Date.now(),N.conditionsCheck($)?(N._running+=$,N.storeOptions.reservoir!=null&&(N.storeOptions.reservoir-=$),M=Math.max(N._nextRequest-q,0),N._nextRequest=q+M+N.storeOptions.minTime,{success:!0,wait:M,reservoir:N.storeOptions.reservoir}):{success:!1}})()}strategyIsBlock(){return this.storeOptions.strategy===3}__submit__(_,$){var D=this;return _asyncToGenerator$4(function*(){var N,q,M;if(yield D.yieldLoop(),D.storeOptions.maxConcurrent!=null&&$>D.storeOptions.maxConcurrent)throw new BottleneckError$2(`Impossible to add a job having a weight of ${$} to a limiter having a maxConcurrent setting of ${D.storeOptions.maxConcurrent}`);return q=Date.now(),M=D.storeOptions.highWater!=null&&_===D.storeOptions.highWater&&!D.check($,q),N=D.strategyIsBlock()&&(M||D.isBlocked(q)),N&&(D._unblockTime=q+D.computePenalty(),D._nextRequest=D._unblockTime+D.storeOptions.minTime,D.instance._dropAllQueued()),{reachedHWM:M,blocked:N,strategy:D.storeOptions.strategy}})()}__free__(_,$){var D=this;return _asyncToGenerator$4(function*(){return yield D.yieldLoop(),D._running-=$,D._done+=$,D.instance._drainAll(D.computeCapacity()),{running:D._running}})()}};var LocalDatastore_1=LocalDatastore,Scripts$2={};const require$$0={"blacklist_client.lua":`local blacklist = ARGV[num_static_argv + 1]

if redis.call('zscore', client_last_seen_key, blacklist) then
  redis.call('zadd', client_last_seen_key, 0, blacklist)
end


return {}
`,"check.lua":`local weight = tonumber(ARGV[num_static_argv + 1])

local capacity = process_tick(now, false)['capacity']
local nextRequest = tonumber(redis.call('hget', settings_key, 'nextRequest'))

return conditions_check(capacity, weight) and nextRequest - now <= 0
`,"conditions_check.lua":`local conditions_check = function (capacity, weight)
  return capacity == nil or weight <= capacity
end
`,"current_reservoir.lua":`return process_tick(now, false)['reservoir']
`,"done.lua":`process_tick(now, false)

return tonumber(redis.call('hget', settings_key, 'done'))
`,"free.lua":`local index = ARGV[num_static_argv + 1]

redis.call('zadd', job_expirations_key, 0, index)

return process_tick(now, false)['running']
`,"get_time.lua":`redis.replicate_commands()

local get_time = function ()
  local time = redis.call('time')

  return tonumber(time[1]..string.sub(time[2], 1, 3))
end
`,"group_check.lua":`return not (redis.call('exists', settings_key) == 1)
`,"heartbeat.lua":`process_tick(now, true)
`,"increment_reservoir.lua":`local incr = tonumber(ARGV[num_static_argv + 1])

redis.call('hincrby', settings_key, 'reservoir', incr)

local reservoir = process_tick(now, true)['reservoir']

local groupTimeout = tonumber(redis.call('hget', settings_key, 'groupTimeout'))
refresh_expiration(0, 0, groupTimeout)

return reservoir
`,"init.lua":`local clear = tonumber(ARGV[num_static_argv + 1])
local limiter_version = ARGV[num_static_argv + 2]
local num_local_argv = num_static_argv + 2

if clear == 1 then
  redis.call('del', unpack(KEYS))
end

if redis.call('exists', settings_key) == 0 then
  -- Create
  local args = {'hmset', settings_key}

  for i = num_local_argv + 1, #ARGV do
    table.insert(args, ARGV[i])
  end

  redis.call(unpack(args))
  redis.call('hmset', settings_key,
    'nextRequest', now,
    'lastReservoirRefresh', now,
    'lastReservoirIncrease', now,
    'running', 0,
    'done', 0,
    'unblockTime', 0,
    'capacityPriorityCounter', 0
  )

else
  -- Apply migrations
  local settings = redis.call('hmget', settings_key,
    'id',
    'version'
  )
  local id = settings[1]
  local current_version = settings[2]

  if current_version ~= limiter_version then
    local version_digits = {}
    for k, v in string.gmatch(current_version, "([^.]+)") do
      table.insert(version_digits, tonumber(k))
    end

    -- 2.10.0
    if version_digits[2] < 10 then
      redis.call('hsetnx', settings_key, 'reservoirRefreshInterval', '')
      redis.call('hsetnx', settings_key, 'reservoirRefreshAmount', '')
      redis.call('hsetnx', settings_key, 'lastReservoirRefresh', '')
      redis.call('hsetnx', settings_key, 'done', 0)
      redis.call('hset', settings_key, 'version', '2.10.0')
    end

    -- 2.11.1
    if version_digits[2] < 11 or (version_digits[2] == 11 and version_digits[3] < 1) then
      if redis.call('hstrlen', settings_key, 'lastReservoirRefresh') == 0 then
        redis.call('hmset', settings_key,
          'lastReservoirRefresh', now,
          'version', '2.11.1'
        )
      end
    end

    -- 2.14.0
    if version_digits[2] < 14 then
      local old_running_key = 'b_'..id..'_running'
      local old_executing_key = 'b_'..id..'_executing'

      if redis.call('exists', old_running_key) == 1 then
        redis.call('rename', old_running_key, job_weights_key)
      end
      if redis.call('exists', old_executing_key) == 1 then
        redis.call('rename', old_executing_key, job_expirations_key)
      end
      redis.call('hset', settings_key, 'version', '2.14.0')
    end

    -- 2.15.2
    if version_digits[2] < 15 or (version_digits[2] == 15 and version_digits[3] < 2) then
      redis.call('hsetnx', settings_key, 'capacityPriorityCounter', 0)
      redis.call('hset', settings_key, 'version', '2.15.2')
    end

    -- 2.17.0
    if version_digits[2] < 17 then
      redis.call('hsetnx', settings_key, 'clientTimeout', 10000)
      redis.call('hset', settings_key, 'version', '2.17.0')
    end

    -- 2.18.0
    if version_digits[2] < 18 then
      redis.call('hsetnx', settings_key, 'reservoirIncreaseInterval', '')
      redis.call('hsetnx', settings_key, 'reservoirIncreaseAmount', '')
      redis.call('hsetnx', settings_key, 'reservoirIncreaseMaximum', '')
      redis.call('hsetnx', settings_key, 'lastReservoirIncrease', now)
      redis.call('hset', settings_key, 'version', '2.18.0')
    end

  end

  process_tick(now, false)
end

local groupTimeout = tonumber(redis.call('hget', settings_key, 'groupTimeout'))
refresh_expiration(0, 0, groupTimeout)

return {}
`,"process_tick.lua":`local process_tick = function (now, always_publish)

  local compute_capacity = function (maxConcurrent, running, reservoir)
    if maxConcurrent ~= nil and reservoir ~= nil then
      return math.min((maxConcurrent - running), reservoir)
    elseif maxConcurrent ~= nil then
      return maxConcurrent - running
    elseif reservoir ~= nil then
      return reservoir
    else
      return nil
    end
  end

  local settings = redis.call('hmget', settings_key,
    'id',
    'maxConcurrent',
    'running',
    'reservoir',
    'reservoirRefreshInterval',
    'reservoirRefreshAmount',
    'lastReservoirRefresh',
    'reservoirIncreaseInterval',
    'reservoirIncreaseAmount',
    'reservoirIncreaseMaximum',
    'lastReservoirIncrease',
    'capacityPriorityCounter',
    'clientTimeout'
  )
  local id = settings[1]
  local maxConcurrent = tonumber(settings[2])
  local running = tonumber(settings[3])
  local reservoir = tonumber(settings[4])
  local reservoirRefreshInterval = tonumber(settings[5])
  local reservoirRefreshAmount = tonumber(settings[6])
  local lastReservoirRefresh = tonumber(settings[7])
  local reservoirIncreaseInterval = tonumber(settings[8])
  local reservoirIncreaseAmount = tonumber(settings[9])
  local reservoirIncreaseMaximum = tonumber(settings[10])
  local lastReservoirIncrease = tonumber(settings[11])
  local capacityPriorityCounter = tonumber(settings[12])
  local clientTimeout = tonumber(settings[13])

  local initial_capacity = compute_capacity(maxConcurrent, running, reservoir)

  --
  -- Process 'running' changes
  --
  local expired = redis.call('zrangebyscore', job_expirations_key, '-inf', '('..now)

  if #expired > 0 then
    redis.call('zremrangebyscore', job_expirations_key, '-inf', '('..now)

    local flush_batch = function (batch, acc)
      local weights = redis.call('hmget', job_weights_key, unpack(batch))
                      redis.call('hdel',  job_weights_key, unpack(batch))
      local clients = redis.call('hmget', job_clients_key, unpack(batch))
                      redis.call('hdel',  job_clients_key, unpack(batch))

      -- Calculate sum of removed weights
      for i = 1, #weights do
        acc['total'] = acc['total'] + (tonumber(weights[i]) or 0)
      end

      -- Calculate sum of removed weights by client
      local client_weights = {}
      for i = 1, #clients do
        local removed = tonumber(weights[i]) or 0
        if removed > 0 then
          acc['client_weights'][clients[i]] = (acc['client_weights'][clients[i]] or 0) + removed
        end
      end
    end

    local acc = {
      ['total'] = 0,
      ['client_weights'] = {}
    }
    local batch_size = 1000

    -- Compute changes to Zsets and apply changes to Hashes
    for i = 1, #expired, batch_size do
      local batch = {}
      for j = i, math.min(i + batch_size - 1, #expired) do
        table.insert(batch, expired[j])
      end

      flush_batch(batch, acc)
    end

    -- Apply changes to Zsets
    if acc['total'] > 0 then
      redis.call('hincrby', settings_key, 'done', acc['total'])
      running = tonumber(redis.call('hincrby', settings_key, 'running', -acc['total']))
    end

    for client, weight in pairs(acc['client_weights']) do
      redis.call('zincrby', client_running_key, -weight, client)
    end
  end

  --
  -- Process 'reservoir' changes
  --
  local reservoirRefreshActive = reservoirRefreshInterval ~= nil and reservoirRefreshAmount ~= nil
  if reservoirRefreshActive and now >= lastReservoirRefresh + reservoirRefreshInterval then
    reservoir = reservoirRefreshAmount
    redis.call('hmset', settings_key,
      'reservoir', reservoir,
      'lastReservoirRefresh', now
    )
  end

  local reservoirIncreaseActive = reservoirIncreaseInterval ~= nil and reservoirIncreaseAmount ~= nil
  if reservoirIncreaseActive and now >= lastReservoirIncrease + reservoirIncreaseInterval then
    local num_intervals = math.floor((now - lastReservoirIncrease) / reservoirIncreaseInterval)
    local incr = reservoirIncreaseAmount * num_intervals
    if reservoirIncreaseMaximum ~= nil then
      incr = math.min(incr, reservoirIncreaseMaximum - (reservoir or 0))
    end
    if incr > 0 then
      reservoir = (reservoir or 0) + incr
    end
    redis.call('hmset', settings_key,
      'reservoir', reservoir,
      'lastReservoirIncrease', lastReservoirIncrease + (num_intervals * reservoirIncreaseInterval)
    )
  end

  --
  -- Clear unresponsive clients
  --
  local unresponsive = redis.call('zrangebyscore', client_last_seen_key, '-inf', (now - clientTimeout))
  local unresponsive_lookup = {}
  local terminated_clients = {}
  for i = 1, #unresponsive do
    unresponsive_lookup[unresponsive[i]] = true
    if tonumber(redis.call('zscore', client_running_key, unresponsive[i])) == 0 then
      table.insert(terminated_clients, unresponsive[i])
    end
  end
  if #terminated_clients > 0 then
    redis.call('zrem', client_running_key,         unpack(terminated_clients))
    redis.call('hdel', client_num_queued_key,      unpack(terminated_clients))
    redis.call('zrem', client_last_registered_key, unpack(terminated_clients))
    redis.call('zrem', client_last_seen_key,       unpack(terminated_clients))
  end

  --
  -- Broadcast capacity changes
  --
  local final_capacity = compute_capacity(maxConcurrent, running, reservoir)

  if always_publish or (initial_capacity ~= nil and final_capacity == nil) then
    -- always_publish or was not unlimited, now unlimited
    redis.call('publish', 'b_'..id, 'capacity:'..(final_capacity or ''))

  elseif initial_capacity ~= nil and final_capacity ~= nil and final_capacity > initial_capacity then
    -- capacity was increased
    -- send the capacity message to the limiter having the lowest number of running jobs
    -- the tiebreaker is the limiter having not registered a job in the longest time

    local lowest_concurrency_value = nil
    local lowest_concurrency_clients = {}
    local lowest_concurrency_last_registered = {}
    local client_concurrencies = redis.call('zrange', client_running_key, 0, -1, 'withscores')

    for i = 1, #client_concurrencies, 2 do
      local client = client_concurrencies[i]
      local concurrency = tonumber(client_concurrencies[i+1])

      if (
        lowest_concurrency_value == nil or lowest_concurrency_value == concurrency
      ) and (
        not unresponsive_lookup[client]
      ) and (
        tonumber(redis.call('hget', client_num_queued_key, client)) > 0
      ) then
        lowest_concurrency_value = concurrency
        table.insert(lowest_concurrency_clients, client)
        local last_registered = tonumber(redis.call('zscore', client_last_registered_key, client))
        table.insert(lowest_concurrency_last_registered, last_registered)
      end
    end

    if #lowest_concurrency_clients > 0 then
      local position = 1
      local earliest = lowest_concurrency_last_registered[1]

      for i,v in ipairs(lowest_concurrency_last_registered) do
        if v < earliest then
          position = i
          earliest = v
        end
      end

      local next_client = lowest_concurrency_clients[position]
      redis.call('publish', 'b_'..id,
        'capacity-priority:'..(final_capacity or '')..
        ':'..next_client..
        ':'..capacityPriorityCounter
      )
      redis.call('hincrby', settings_key, 'capacityPriorityCounter', '1')
    else
      redis.call('publish', 'b_'..id, 'capacity:'..(final_capacity or ''))
    end
  end

  return {
    ['capacity'] = final_capacity,
    ['running'] = running,
    ['reservoir'] = reservoir
  }
end
`,"queued.lua":`local clientTimeout = tonumber(redis.call('hget', settings_key, 'clientTimeout'))
local valid_clients = redis.call('zrangebyscore', client_last_seen_key, (now - clientTimeout), 'inf')
local client_queued = redis.call('hmget', client_num_queued_key, unpack(valid_clients))

local sum = 0
for i = 1, #client_queued do
  sum = sum + tonumber(client_queued[i])
end

return sum
`,"refresh_expiration.lua":`local refresh_expiration = function (now, nextRequest, groupTimeout)

  if groupTimeout ~= nil then
    local ttl = (nextRequest + groupTimeout) - now

    for i = 1, #KEYS do
      redis.call('pexpire', KEYS[i], ttl)
    end
  end

end
`,"refs.lua":`local settings_key = KEYS[1]
local job_weights_key = KEYS[2]
local job_expirations_key = KEYS[3]
local job_clients_key = KEYS[4]
local client_running_key = KEYS[5]
local client_num_queued_key = KEYS[6]
local client_last_registered_key = KEYS[7]
local client_last_seen_key = KEYS[8]

local now = tonumber(ARGV[1])
local client = ARGV[2]

local num_static_argv = 2
`,"register.lua":`local index = ARGV[num_static_argv + 1]
local weight = tonumber(ARGV[num_static_argv + 2])
local expiration = tonumber(ARGV[num_static_argv + 3])

local state = process_tick(now, false)
local capacity = state['capacity']
local reservoir = state['reservoir']

local settings = redis.call('hmget', settings_key,
  'nextRequest',
  'minTime',
  'groupTimeout'
)
local nextRequest = tonumber(settings[1])
local minTime = tonumber(settings[2])
local groupTimeout = tonumber(settings[3])

if conditions_check(capacity, weight) then

  redis.call('hincrby', settings_key, 'running', weight)
  redis.call('hset', job_weights_key, index, weight)
  if expiration ~= nil then
    redis.call('zadd', job_expirations_key, now + expiration, index)
  end
  redis.call('hset', job_clients_key, index, client)
  redis.call('zincrby', client_running_key, weight, client)
  redis.call('hincrby', client_num_queued_key, client, -1)
  redis.call('zadd', client_last_registered_key, now, client)

  local wait = math.max(nextRequest - now, 0)
  local newNextRequest = now + wait + minTime

  if reservoir == nil then
    redis.call('hset', settings_key,
      'nextRequest', newNextRequest
    )
  else
    reservoir = reservoir - weight
    redis.call('hmset', settings_key,
      'reservoir', reservoir,
      'nextRequest', newNextRequest
    )
  end

  refresh_expiration(now, newNextRequest, groupTimeout)

  return {true, wait, reservoir}

else
  return {false}
end
`,"register_client.lua":`local queued = tonumber(ARGV[num_static_argv + 1])

-- Could have been re-registered concurrently
if not redis.call('zscore', client_last_seen_key, client) then
  redis.call('zadd', client_running_key, 0, client)
  redis.call('hset', client_num_queued_key, client, queued)
  redis.call('zadd', client_last_registered_key, 0, client)
end

redis.call('zadd', client_last_seen_key, now, client)

return {}
`,"running.lua":`return process_tick(now, false)['running']
`,"submit.lua":`local queueLength = tonumber(ARGV[num_static_argv + 1])
local weight = tonumber(ARGV[num_static_argv + 2])

local capacity = process_tick(now, false)['capacity']

local settings = redis.call('hmget', settings_key,
  'id',
  'maxConcurrent',
  'highWater',
  'nextRequest',
  'strategy',
  'unblockTime',
  'penalty',
  'minTime',
  'groupTimeout'
)
local id = settings[1]
local maxConcurrent = tonumber(settings[2])
local highWater = tonumber(settings[3])
local nextRequest = tonumber(settings[4])
local strategy = tonumber(settings[5])
local unblockTime = tonumber(settings[6])
local penalty = tonumber(settings[7])
local minTime = tonumber(settings[8])
local groupTimeout = tonumber(settings[9])

if maxConcurrent ~= nil and weight > maxConcurrent then
  return redis.error_reply('OVERWEIGHT:'..weight..':'..maxConcurrent)
end

local reachedHWM = (highWater ~= nil and queueLength == highWater
  and not (
    conditions_check(capacity, weight)
    and nextRequest - now <= 0
  )
)

local blocked = strategy == 3 and (reachedHWM or unblockTime >= now)

if blocked then
  local computedPenalty = penalty
  if computedPenalty == nil then
    if minTime == 0 then
      computedPenalty = 5000
    else
      computedPenalty = 15 * minTime
    end
  end

  local newNextRequest = now + computedPenalty + minTime

  redis.call('hmset', settings_key,
    'unblockTime', now + computedPenalty,
    'nextRequest', newNextRequest
  )

  local clients_queued_reset = redis.call('hkeys', client_num_queued_key)
  local queued_reset = {}
  for i = 1, #clients_queued_reset do
    table.insert(queued_reset, clients_queued_reset[i])
    table.insert(queued_reset, 0)
  end
  redis.call('hmset', client_num_queued_key, unpack(queued_reset))

  redis.call('publish', 'b_'..id, 'blocked:')

  refresh_expiration(now, newNextRequest, groupTimeout)
end

if not blocked and not reachedHWM then
  redis.call('hincrby', client_num_queued_key, client, 1)
end

return {reachedHWM, blocked, strategy}
`,"update_settings.lua":`local args = {'hmset', settings_key}

for i = num_static_argv + 1, #ARGV do
  table.insert(args, ARGV[i])
end

redis.call(unpack(args))

process_tick(now, true)

local groupTimeout = tonumber(redis.call('hget', settings_key, 'groupTimeout'))
refresh_expiration(0, 0, groupTimeout)

return {}
`,"validate_client.lua":`if not redis.call('zscore', client_last_seen_key, client) then
  return redis.error_reply('UNKNOWN_CLIENT')
end

redis.call('zadd', client_last_seen_key, now, client)
`,"validate_keys.lua":`if not (redis.call('exists', settings_key) == 1) then
  return redis.error_reply('SETTINGS_KEY_NOT_FOUND')
end
`};(function(A){var _,$,D;$=require$$0,_={refs:$["refs.lua"],validate_keys:$["validate_keys.lua"],validate_client:$["validate_client.lua"],refresh_expiration:$["refresh_expiration.lua"],process_tick:$["process_tick.lua"],conditions_check:$["conditions_check.lua"],get_time:$["get_time.lua"]},A.allKeys=function(N){return[`b_${N}_settings`,`b_${N}_job_weights`,`b_${N}_job_expirations`,`b_${N}_job_clients`,`b_${N}_client_running`,`b_${N}_client_num_queued`,`b_${N}_client_last_registered`,`b_${N}_client_last_seen`]},D={init:{keys:A.allKeys,headers:["process_tick"],refresh_expiration:!0,code:$["init.lua"]},group_check:{keys:A.allKeys,headers:[],refresh_expiration:!1,code:$["group_check.lua"]},register_client:{keys:A.allKeys,headers:["validate_keys"],refresh_expiration:!1,code:$["register_client.lua"]},blacklist_client:{keys:A.allKeys,headers:["validate_keys","validate_client"],refresh_expiration:!1,code:$["blacklist_client.lua"]},heartbeat:{keys:A.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:$["heartbeat.lua"]},update_settings:{keys:A.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!0,code:$["update_settings.lua"]},running:{keys:A.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:$["running.lua"]},queued:{keys:A.allKeys,headers:["validate_keys","validate_client"],refresh_expiration:!1,code:$["queued.lua"]},done:{keys:A.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:$["done.lua"]},check:{keys:A.allKeys,headers:["validate_keys","validate_client","process_tick","conditions_check"],refresh_expiration:!1,code:$["check.lua"]},submit:{keys:A.allKeys,headers:["validate_keys","validate_client","process_tick","conditions_check"],refresh_expiration:!0,code:$["submit.lua"]},register:{keys:A.allKeys,headers:["validate_keys","validate_client","process_tick","conditions_check"],refresh_expiration:!0,code:$["register.lua"]},free:{keys:A.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!0,code:$["free.lua"]},current_reservoir:{keys:A.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:$["current_reservoir.lua"]},increment_reservoir:{keys:A.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!0,code:$["increment_reservoir.lua"]}},A.names=Object.keys(D),A.keys=function(N,q){return D[N].keys(q)},A.payload=function(N){var q;return q=D[N],Array.prototype.concat(_.refs,q.headers.map(function(M){return _[M]}),q.refresh_expiration?_.refresh_expiration:"",q.code).join(`
`)}})(Scripts$2);function asyncGeneratorStep$3(A,_,$,D,N,q,M){try{var L=A[q](M),x=L.value}catch(F){$(F);return}L.done?_(x):Promise.resolve(x).then(D,N)}function _asyncToGenerator$3(A){return function(){var _=this,$=arguments;return new Promise(function(D,N){var q=A.apply(_,$);function M(x){asyncGeneratorStep$3(q,D,N,M,L,"next",x)}function L(x){asyncGeneratorStep$3(q,D,N,M,L,"throw",x)}M(void 0)})}}var Events$1,RedisConnection$1,Scripts$1,parser$2;parser$2=parser$5;Events$1=Events_1;Scripts$1=Scripts$2;RedisConnection$1=(function(){class RedisConnection{constructor(options={}){parser$2.load(options,this.defaults,this),this.Redis==null&&(this.Redis=eval("require")("redis")),this.Events==null&&(this.Events=new Events$1(this)),this.terminated=!1,this.client==null&&(this.client=this.Redis.createClient(this.clientOptions)),this.subscriber=this.client.duplicate(),this.limiters={},this.shas={},this.ready=this.Promise.all([this._setup(this.client,!1),this._setup(this.subscriber,!0)]).then(()=>this._loadScripts()).then(()=>({client:this.client,subscriber:this.subscriber}))}_setup(A,_){return A.setMaxListeners(0),new this.Promise(($,D)=>(A.on("error",N=>this.Events.trigger("error",N)),_&&A.on("message",(N,q)=>{var M;return(M=this.limiters[N])!=null?M._store.onMessage(N,q):void 0}),A.ready?$():A.once("ready",$)))}_loadScript(A){return new this.Promise((_,$)=>{var D;return D=Scripts$1.payload(A),this.client.multi([["script","load",D]]).exec((N,q)=>N!=null?$(N):(this.shas[A]=q[0],_(q[0])))})}_loadScripts(){return this.Promise.all(Scripts$1.names.map(A=>this._loadScript(A)))}__runCommand__(A){var _=this;return _asyncToGenerator$3(function*(){return yield _.ready,new _.Promise(($,D)=>_.client.multi([A]).exec_atomic(function(N,q){return N!=null?D(N):$(q[0])}))})()}__addLimiter__(A){return this.Promise.all([A.channel(),A.channel_client()].map(_=>new this.Promise(($,D)=>{var N;return N=q=>{if(q===_)return this.subscriber.removeListener("subscribe",N),this.limiters[_]=A,$()},this.subscriber.on("subscribe",N),this.subscriber.subscribe(_)})))}__removeLimiter__(A){var _=this;return this.Promise.all([A.channel(),A.channel_client()].map(function(){var $=_asyncToGenerator$3(function*(D){return _.terminated||(yield new _.Promise((N,q)=>_.subscriber.unsubscribe(D,function(M,L){if(M!=null)return q(M);if(L===D)return N()}))),delete _.limiters[D]});return function(D){return $.apply(this,arguments)}}()))}__scriptArgs__(A,_,$,D){var N;return N=Scripts$1.keys(A,_),[this.shas[A],N.length].concat(N,$,D)}__scriptFn__(A){return this.client.evalsha.bind(this.client)}disconnect(A=!0){var _,$,D,N;for(N=Object.keys(this.limiters),_=0,D=N.length;_<D;_++)$=N[_],clearInterval(this.limiters[$]._store.heartbeat);return this.limiters={},this.terminated=!0,this.client.end(A),this.subscriber.end(A),this.Promise.resolve()}}return RedisConnection.prototype.datastore="redis",RedisConnection.prototype.defaults={Redis:null,clientOptions:{},client:null,Promise,Events:null},RedisConnection}).call(void 0);var RedisConnection_1=RedisConnection$1;function _slicedToArray$1(A,_){return _arrayWithHoles$1(A)||_iterableToArrayLimit$1(A,_)||_nonIterableRest$1()}function _nonIterableRest$1(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit$1(A,_){var $=[],D=!0,N=!1,q=void 0;try{for(var M=A[Symbol.iterator](),L;!(D=(L=M.next()).done)&&($.push(L.value),!(_&&$.length===_));D=!0);}catch(x){N=!0,q=x}finally{try{!D&&M.return!=null&&M.return()}finally{if(N)throw q}}return $}function _arrayWithHoles$1(A){if(Array.isArray(A))return A}function asyncGeneratorStep$2(A,_,$,D,N,q,M){try{var L=A[q](M),x=L.value}catch(F){$(F);return}L.done?_(x):Promise.resolve(x).then(D,N)}function _asyncToGenerator$2(A){return function(){var _=this,$=arguments;return new Promise(function(D,N){var q=A.apply(_,$);function M(x){asyncGeneratorStep$2(q,D,N,M,L,"next",x)}function L(x){asyncGeneratorStep$2(q,D,N,M,L,"throw",x)}M(void 0)})}}var Events,IORedisConnection$1,Scripts,parser$1;parser$1=parser$5;Events=Events_1;Scripts=Scripts$2;IORedisConnection$1=(function(){class IORedisConnection{constructor(options={}){parser$1.load(options,this.defaults,this),this.Redis==null&&(this.Redis=eval("require")("ioredis")),this.Events==null&&(this.Events=new Events(this)),this.terminated=!1,this.clusterNodes!=null?(this.client=new this.Redis.Cluster(this.clusterNodes,this.clientOptions),this.subscriber=new this.Redis.Cluster(this.clusterNodes,this.clientOptions)):this.client!=null&&this.client.duplicate==null?this.subscriber=new this.Redis.Cluster(this.client.startupNodes,this.client.options):(this.client==null&&(this.client=new this.Redis(this.clientOptions)),this.subscriber=this.client.duplicate()),this.limiters={},this.ready=this.Promise.all([this._setup(this.client,!1),this._setup(this.subscriber,!0)]).then(()=>(this._loadScripts(),{client:this.client,subscriber:this.subscriber}))}_setup(A,_){return A.setMaxListeners(0),new this.Promise(($,D)=>(A.on("error",N=>this.Events.trigger("error",N)),_&&A.on("message",(N,q)=>{var M;return(M=this.limiters[N])!=null?M._store.onMessage(N,q):void 0}),A.status==="ready"?$():A.once("ready",$)))}_loadScripts(){return Scripts.names.forEach(A=>this.client.defineCommand(A,{lua:Scripts.payload(A)}))}__runCommand__(A){var _=this;return _asyncToGenerator$2(function*(){var $;yield _.ready;var D=yield _.client.pipeline([A]).exec(),N=_slicedToArray$1(D,1),q=_slicedToArray$1(N[0],2);return q[0],$=q[1],$})()}__addLimiter__(A){return this.Promise.all([A.channel(),A.channel_client()].map(_=>new this.Promise(($,D)=>this.subscriber.subscribe(_,()=>(this.limiters[_]=A,$())))))}__removeLimiter__(A){var _=this;return[A.channel(),A.channel_client()].forEach(function(){var $=_asyncToGenerator$2(function*(D){return _.terminated||(yield _.subscriber.unsubscribe(D)),delete _.limiters[D]});return function(D){return $.apply(this,arguments)}}())}__scriptArgs__(A,_,$,D){var N;return N=Scripts.keys(A,_),[N.length].concat(N,$,D)}__scriptFn__(A){return this.client[A].bind(this.client)}disconnect(A=!0){var _,$,D,N;for(N=Object.keys(this.limiters),_=0,D=N.length;_<D;_++)$=N[_],clearInterval(this.limiters[$]._store.heartbeat);return this.limiters={},this.terminated=!0,A?this.Promise.all([this.client.quit(),this.subscriber.quit()]):(this.client.disconnect(),this.subscriber.disconnect(),this.Promise.resolve())}}return IORedisConnection.prototype.datastore="ioredis",IORedisConnection.prototype.defaults={Redis:null,clientOptions:{},clusterNodes:null,client:null,Promise,Events:null},IORedisConnection}).call(void 0);var IORedisConnection_1=IORedisConnection$1;function _slicedToArray(A,_){return _arrayWithHoles(A)||_iterableToArrayLimit(A,_)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(A,_){var $=[],D=!0,N=!1,q=void 0;try{for(var M=A[Symbol.iterator](),L;!(D=(L=M.next()).done)&&($.push(L.value),!(_&&$.length===_));D=!0);}catch(x){N=!0,q=x}finally{try{!D&&M.return!=null&&M.return()}finally{if(N)throw q}}return $}function _arrayWithHoles(A){if(Array.isArray(A))return A}function asyncGeneratorStep$1(A,_,$,D,N,q,M){try{var L=A[q](M),x=L.value}catch(F){$(F);return}L.done?_(x):Promise.resolve(x).then(D,N)}function _asyncToGenerator$1(A){return function(){var _=this,$=arguments;return new Promise(function(D,N){var q=A.apply(_,$);function M(x){asyncGeneratorStep$1(q,D,N,M,L,"next",x)}function L(x){asyncGeneratorStep$1(q,D,N,M,L,"throw",x)}M(void 0)})}}var BottleneckError$1,IORedisConnection,RedisConnection,RedisDatastore,parser;parser=parser$5;BottleneckError$1=BottleneckError_1;RedisConnection=RedisConnection_1;IORedisConnection=IORedisConnection_1;RedisDatastore=class{constructor(_,$,D){this.instance=_,this.storeOptions=$,this.originalId=this.instance.id,this.clientId=this.instance._randomIndex(),parser.load(D,D,this),this.clients={},this.capacityPriorityCounters={},this.sharedConnection=this.connection!=null,this.connection==null&&(this.connection=this.instance.datastore==="redis"?new RedisConnection({Redis:this.Redis,clientOptions:this.clientOptions,Promise:this.Promise,Events:this.instance.Events}):this.instance.datastore==="ioredis"?new IORedisConnection({Redis:this.Redis,clientOptions:this.clientOptions,clusterNodes:this.clusterNodes,Promise:this.Promise,Events:this.instance.Events}):void 0),this.instance.connection=this.connection,this.instance.datastore=this.connection.datastore,this.ready=this.connection.ready.then(N=>(this.clients=N,this.runScript("init",this.prepareInitSettings(this.clearDatastore)))).then(()=>this.connection.__addLimiter__(this.instance)).then(()=>this.runScript("register_client",[this.instance.queued()])).then(()=>{var N;return typeof(N=this.heartbeat=setInterval(()=>this.runScript("heartbeat",[]).catch(q=>this.instance.Events.trigger("error",q)),this.heartbeatInterval)).unref=="function"&&N.unref(),this.clients})}__publish__(_){var $=this;return _asyncToGenerator$1(function*(){var D,N=yield $.ready;return D=N.client,D.publish($.instance.channel(),`message:${_.toString()}`)})()}onMessage(_,$){var D=this;return _asyncToGenerator$1(function*(){var N,q,M,L,x,F,U,V,Q,Y;try{U=$.indexOf(":");var X=[$.slice(0,U),$.slice(U+1)];if(Y=X[0],M=X[1],Y==="capacity")return yield D.instance._drainAll(M.length>0?~~M:void 0);if(Y==="capacity-priority"){var ee=M.split(":"),te=_slicedToArray(ee,3);return Q=te[0],V=te[1],q=te[2],N=Q.length>0?~~Q:void 0,V===D.clientId?(L=yield D.instance._drainAll(N),F=N!=null?N-(L||0):"",yield D.clients.client.publish(D.instance.channel(),`capacity-priority:${F}::${q}`)):V===""?(clearTimeout(D.capacityPriorityCounters[q]),delete D.capacityPriorityCounters[q],D.instance._drainAll(N)):D.capacityPriorityCounters[q]=setTimeout(_asyncToGenerator$1(function*(){var z;try{return delete D.capacityPriorityCounters[q],yield D.runScript("blacklist_client",[V]),yield D.instance._drainAll(N)}catch(G){return z=G,D.instance.Events.trigger("error",z)}}),1e3)}else{if(Y==="message")return D.instance.Events.trigger("message",M);if(Y==="blocked")return yield D.instance._dropAllQueued()}}catch(z){return x=z,D.instance.Events.trigger("error",x)}})()}__disconnect__(_){return clearInterval(this.heartbeat),this.sharedConnection?this.connection.__removeLimiter__(this.instance):this.connection.disconnect(_)}runScript(_,$){var D=this;return _asyncToGenerator$1(function*(){return _==="init"||_==="register_client"||(yield D.ready),new D.Promise((N,q)=>{var M,L;return M=[Date.now(),D.clientId].concat($),D.instance.Events.trigger("debug",`Calling Redis script: ${_}.lua`,M),L=D.connection.__scriptArgs__(_,D.originalId,M,function(x,F){return x!=null?q(x):N(F)}),D.connection.__scriptFn__(_)(...L)}).catch(N=>N.message==="SETTINGS_KEY_NOT_FOUND"?_==="heartbeat"?D.Promise.resolve():D.runScript("init",D.prepareInitSettings(!1)).then(()=>D.runScript(_,$)):N.message==="UNKNOWN_CLIENT"?D.runScript("register_client",[D.instance.queued()]).then(()=>D.runScript(_,$)):D.Promise.reject(N))})()}prepareArray(_){var $,D,N,q;for(N=[],$=0,D=_.length;$<D;$++)q=_[$],N.push(q!=null?q.toString():"");return N}prepareObject(_){var $,D,N;$=[];for(D in _)N=_[D],$.push(D,N!=null?N.toString():"");return $}prepareInitSettings(_){var $;return $=this.prepareObject(Object.assign({},this.storeOptions,{id:this.originalId,version:this.instance.version,groupTimeout:this.timeout,clientTimeout:this.clientTimeout})),$.unshift(_?1:0,this.instance.version),$}convertBool(_){return!!_}__updateSettings__(_){var $=this;return _asyncToGenerator$1(function*(){return yield $.runScript("update_settings",$.prepareObject(_)),parser.overwrite(_,_,$.storeOptions)})()}__running__(){return this.runScript("running",[])}__queued__(){return this.runScript("queued",[])}__done__(){return this.runScript("done",[])}__groupCheck__(){var _=this;return _asyncToGenerator$1(function*(){return _.convertBool(yield _.runScript("group_check",[]))})()}__incrementReservoir__(_){return this.runScript("increment_reservoir",[_])}__currentReservoir__(){return this.runScript("current_reservoir",[])}__check__(_){var $=this;return _asyncToGenerator$1(function*(){return $.convertBool(yield $.runScript("check",$.prepareArray([_])))})()}__register__(_,$,D){var N=this;return _asyncToGenerator$1(function*(){var q,M,L,x=yield N.runScript("register",N.prepareArray([_,$,D])),F=_slicedToArray(x,3);return M=F[0],L=F[1],q=F[2],{success:N.convertBool(M),wait:L,reservoir:q}})()}__submit__(_,$){var D=this;return _asyncToGenerator$1(function*(){var N,q,M,L,x;try{var F=yield D.runScript("submit",D.prepareArray([_,$])),U=_slicedToArray(F,3);return L=U[0],N=U[1],x=U[2],{reachedHWM:D.convertBool(L),blocked:D.convertBool(N),strategy:x}}catch(Y){if(q=Y,q.message.indexOf("OVERWEIGHT")===0){var V=q.message.split(":"),Q=_slicedToArray(V,3);throw Q[0],$=Q[1],M=Q[2],new BottleneckError$1(`Impossible to add a job having a weight of ${$} to a limiter having a maxConcurrent setting of ${M}`)}else throw q}})()}__free__(_,$){var D=this;return _asyncToGenerator$1(function*(){var N;return N=yield D.runScript("free",D.prepareArray([_])),{running:N}})()}};var RedisDatastore_1=RedisDatastore,BottleneckError,States;BottleneckError=BottleneckError_1;States=class{constructor(_){this.status=_,this._jobs={},this.counts=this.status.map(function(){return 0})}next(_){var $,D;if($=this._jobs[_],D=$+1,$!=null&&D<this.status.length)return this.counts[$]--,this.counts[D]++,this._jobs[_]++;if($!=null)return this.counts[$]--,delete this._jobs[_]}start(_){var $;return $=0,this._jobs[_]=$,this.counts[$]++}remove(_){var $;return $=this._jobs[_],$!=null&&(this.counts[$]--,delete this._jobs[_]),$!=null}jobStatus(_){var $;return($=this.status[this._jobs[_]])!=null?$:null}statusJobs(_){var $,D,N,q,M;if(_!=null){if(D=this.status.indexOf(_),D<0)throw new BottleneckError(`status must be one of ${this.status.join(", ")}`);N=this._jobs,q=[];for($ in N)M=N[$],M===D&&q.push($);return q}else return Object.keys(this._jobs)}statusCounts(){return this.counts.reduce((_,$,D)=>(_[this.status[D]]=$,_),{})}};var States_1=States;function asyncGeneratorStep(A,_,$,D,N,q,M){try{var L=A[q](M),x=L.value}catch(F){$(F);return}L.done?_(x):Promise.resolve(x).then(D,N)}function _asyncToGenerator(A){return function(){var _=this,$=arguments;return new Promise(function(D,N){var q=A.apply(_,$);function M(x){asyncGeneratorStep(q,D,N,M,L,"next",x)}function L(x){asyncGeneratorStep(q,D,N,M,L,"throw",x)}M(void 0)})}}var DLList,Sync;DLList=DLList_1;Sync=class{constructor(_,$){this.schedule=this.schedule.bind(this),this.name=_,this.Promise=$,this._running=0,this._queue=new DLList}isEmpty(){return this._queue.length===0}_tryToRun(){var _=this;return _asyncToGenerator(function*(){var $,D,N,q,M,L,x;if(_._running<1&&_._queue.length>0){_._running++;var F=_._queue.shift();return x=F.task,$=F.args,M=F.resolve,q=F.reject,D=yield _asyncToGenerator(function*(){try{return L=yield x(...$),function(){return M(L)}}catch(U){return N=U,function(){return q(N)}}})(),_._running--,_._tryToRun(),D()}})()}schedule(_,...$){var D,N,q;return q=N=null,D=new this.Promise(function(M,L){return q=M,N=L}),this._queue.push({task:_,args:$,resolve:q,reject:N}),this._tryToRun(),D}};var Sync_1=Sync;const version$1="2.19.5",require$$8={version:version$1};var Group_1,hasRequiredGroup;function requireGroup(){if(hasRequiredGroup)return Group_1;hasRequiredGroup=1;function A(Q,Y){return D(Q)||$(Q,Y)||_()}function _(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function $(Q,Y){var X=[],ee=!0,te=!1,z=void 0;try{for(var G=Q[Symbol.iterator](),H;!(ee=(H=G.next()).done)&&(X.push(H.value),!(Y&&X.length===Y));ee=!0);}catch(W){te=!0,z=W}finally{try{!ee&&G.return!=null&&G.return()}finally{if(te)throw z}}return X}function D(Q){if(Array.isArray(Q))return Q}function N(Q,Y,X,ee,te,z,G){try{var H=Q[z](G),W=H.value}catch(ae){X(ae);return}H.done?Y(W):Promise.resolve(W).then(ee,te)}function q(Q){return function(){var Y=this,X=arguments;return new Promise(function(ee,te){var z=Q.apply(Y,X);function G(W){N(z,ee,te,G,H,"next",W)}function H(W){N(z,ee,te,G,H,"throw",W)}G(void 0)})}}var M,L,x,F,U,V;return V=parser$5,M=Events_1,F=RedisConnection_1,x=IORedisConnection_1,U=Scripts$2,L=(function(){class Q{constructor(X={}){this.deleteKey=this.deleteKey.bind(this),this.limiterOptions=X,V.load(this.limiterOptions,this.defaults,this),this.Events=new M(this),this.instances={},this.Bottleneck=requireBottleneck(),this._startAutoCleanup(),this.sharedConnection=this.connection!=null,this.connection==null&&(this.limiterOptions.datastore==="redis"?this.connection=new F(Object.assign({},this.limiterOptions,{Events:this.Events})):this.limiterOptions.datastore==="ioredis"&&(this.connection=new x(Object.assign({},this.limiterOptions,{Events:this.Events}))))}key(X=""){var ee;return(ee=this.instances[X])!=null?ee:(()=>{var te;return te=this.instances[X]=new this.Bottleneck(Object.assign(this.limiterOptions,{id:`${this.id}-${X}`,timeout:this.timeout,connection:this.connection})),this.Events.trigger("created",te,X),te})()}deleteKey(X=""){var ee=this;return q(function*(){var te,z;return z=ee.instances[X],ee.connection&&(te=yield ee.connection.__runCommand__(["del",...U.allKeys(`${ee.id}-${X}`)])),z!=null&&(delete ee.instances[X],yield z.disconnect()),z!=null||te>0})()}limiters(){var X,ee,te,z;ee=this.instances,te=[];for(X in ee)z=ee[X],te.push({key:X,limiter:z});return te}keys(){return Object.keys(this.instances)}clusterKeys(){var X=this;return q(function*(){var ee,te,z,G,H,W,ae,B,Z;if(X.connection==null)return X.Promise.resolve(X.keys());for(W=[],ee=null,Z=`b_${X.id}-`.length,te=9;ee!==0;){var oe=yield X.connection.__runCommand__(["scan",ee??0,"match",`b_${X.id}-*_settings`,"count",1e4]),fe=A(oe,2);for(B=fe[0],z=fe[1],ee=~~B,G=0,ae=z.length;G<ae;G++)H=z[G],W.push(H.slice(Z,-te))}return W})()}_startAutoCleanup(){var X=this,ee;return clearInterval(this.interval),typeof(ee=this.interval=setInterval(q(function*(){var te,z,G,H,W,ae;W=Date.now(),G=X.instances,H=[];for(z in G){ae=G[z];try{(yield ae._store.__groupCheck__(W))?H.push(X.deleteKey(z)):H.push(void 0)}catch(B){te=B,H.push(ae.Events.trigger("error",te))}}return H}),this.timeout/2)).unref=="function"?ee.unref():void 0}updateSettings(X={}){if(V.overwrite(X,this.defaults,this),V.overwrite(X,X,this.limiterOptions),X.timeout!=null)return this._startAutoCleanup()}disconnect(X=!0){var ee;if(!this.sharedConnection)return(ee=this.connection)!=null?ee.disconnect(X):void 0}}return Q.prototype.defaults={timeout:1e3*60*5,connection:null,Promise,id:"group-key"},Q}).call(void 0),Group_1=L,Group_1}var Batcher_1,hasRequiredBatcher;function requireBatcher(){if(hasRequiredBatcher)return Batcher_1;hasRequiredBatcher=1;var A,_,$;return $=parser$5,_=Events_1,A=(function(){class D{constructor(q={}){this.options=q,$.load(this.options,this.defaults,this),this.Events=new _(this),this._arr=[],this._resetPromise(),this._lastFlush=Date.now()}_resetPromise(){return this._promise=new this.Promise((q,M)=>this._resolve=q)}_flush(){return clearTimeout(this._timeout),this._lastFlush=Date.now(),this._resolve(),this.Events.trigger("batch",this._arr),this._arr=[],this._resetPromise()}add(q){var M;return this._arr.push(q),M=this._promise,this._arr.length===this.maxSize?this._flush():this.maxTime!=null&&this._arr.length===1&&(this._timeout=setTimeout(()=>this._flush(),this.maxTime)),M}}return D.prototype.defaults={maxTime:null,maxSize:null,Promise},D}).call(void 0),Batcher_1=A,Batcher_1}var Bottleneck_1,hasRequiredBottleneck;function requireBottleneck(){if(hasRequiredBottleneck)return Bottleneck_1;hasRequiredBottleneck=1;function A(W,ae){return q(W)||_(W,ae)||D()}function _(W,ae){var B=[],Z=!0,oe=!1,fe=void 0;try{for(var me=W[Symbol.iterator](),_e;!(Z=(_e=me.next()).done)&&(B.push(_e.value),!(ae&&B.length===ae));Z=!0);}catch(ye){oe=!0,fe=ye}finally{try{!Z&&me.return!=null&&me.return()}finally{if(oe)throw fe}}return B}function $(W){return q(W)||N(W)||D()}function D(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function N(W){if(Symbol.iterator in Object(W)||Object.prototype.toString.call(W)==="[object Arguments]")return Array.from(W)}function q(W){if(Array.isArray(W))return W}function M(W,ae,B,Z,oe,fe,me){try{var _e=W[fe](me),ye=_e.value}catch(Re){B(Re);return}_e.done?ae(ye):Promise.resolve(ye).then(Z,oe)}function L(W){return function(){var ae=this,B=arguments;return new Promise(function(Z,oe){var fe=W.apply(ae,B);function me(ye){M(fe,Z,oe,me,_e,"next",ye)}function _e(ye){M(fe,Z,oe,me,_e,"throw",ye)}me(void 0)})}}var x,F,U,V,Q,Y,X,ee,te,z,G,H=[].splice;return Y=10,F=5,G=parser$5,X=Queues_1,V=Job_1,Q=LocalDatastore_1,ee=RedisDatastore_1,U=Events_1,te=States_1,z=Sync_1,x=(function(){class W{constructor(B={},...Z){var oe,fe;this._addToQueue=this._addToQueue.bind(this),this._validateOptions(B,Z),G.load(B,this.instanceDefaults,this),this._queues=new X(Y),this._scheduled={},this._states=new te(["RECEIVED","QUEUED","RUNNING","EXECUTING"].concat(this.trackDoneStatus?["DONE"]:[])),this._limiter=null,this.Events=new U(this),this._submitLock=new z("submit",this.Promise),this._registerLock=new z("register",this.Promise),fe=G.load(B,this.storeDefaults,{}),this._store=(function(){if(this.datastore==="redis"||this.datastore==="ioredis"||this.connection!=null)return oe=G.load(B,this.redisStoreDefaults,{}),new ee(this,fe,oe);if(this.datastore==="local")return oe=G.load(B,this.localStoreDefaults,{}),new Q(this,fe,oe);throw new W.prototype.BottleneckError(`Invalid datastore type: ${this.datastore}`)}).call(this),this._queues.on("leftzero",()=>{var me;return(me=this._store.heartbeat)!=null&&typeof me.ref=="function"?me.ref():void 0}),this._queues.on("zero",()=>{var me;return(me=this._store.heartbeat)!=null&&typeof me.unref=="function"?me.unref():void 0})}_validateOptions(B,Z){if(!(B!=null&&typeof B=="object"&&Z.length===0))throw new W.prototype.BottleneckError("Bottleneck v2 takes a single object argument. Refer to https://github.com/SGrondin/bottleneck#upgrading-to-v2 if you're upgrading from Bottleneck v1.")}ready(){return this._store.ready}clients(){return this._store.clients}channel(){return`b_${this.id}`}channel_client(){return`b_${this.id}_${this._store.clientId}`}publish(B){return this._store.__publish__(B)}disconnect(B=!0){return this._store.__disconnect__(B)}chain(B){return this._limiter=B,this}queued(B){return this._queues.queued(B)}clusterQueued(){return this._store.__queued__()}empty(){return this.queued()===0&&this._submitLock.isEmpty()}running(){return this._store.__running__()}done(){return this._store.__done__()}jobStatus(B){return this._states.jobStatus(B)}jobs(B){return this._states.statusJobs(B)}counts(){return this._states.statusCounts()}_randomIndex(){return Math.random().toString(36).slice(2)}check(B=1){return this._store.__check__(B)}_clearGlobalState(B){return this._scheduled[B]!=null?(clearTimeout(this._scheduled[B].expiration),delete this._scheduled[B],!0):!1}_free(B,Z,oe,fe){var me=this;return L(function*(){var _e,ye;try{var Re=yield me._store.__free__(B,oe.weight);if(ye=Re.running,me.Events.trigger("debug",`Freed ${oe.id}`,fe),ye===0&&me.empty())return me.Events.trigger("idle")}catch(ke){return _e=ke,me.Events.trigger("error",_e)}})()}_run(B,Z,oe){var fe,me,_e;return Z.doRun(),fe=this._clearGlobalState.bind(this,B),_e=this._run.bind(this,B,Z),me=this._free.bind(this,B,Z),this._scheduled[B]={timeout:setTimeout(()=>Z.doExecute(this._limiter,fe,_e,me),oe),expiration:Z.options.expiration!=null?setTimeout(function(){return Z.doExpire(fe,_e,me)},oe+Z.options.expiration):void 0,job:Z}}_drainOne(B){return this._registerLock.schedule(()=>{var Z,oe,fe,me,_e;if(this.queued()===0)return this.Promise.resolve(null);_e=this._queues.getFirst();var ye=fe=_e.first();return me=ye.options,Z=ye.args,B!=null&&me.weight>B?this.Promise.resolve(null):(this.Events.trigger("debug",`Draining ${me.id}`,{args:Z,options:me}),oe=this._randomIndex(),this._store.__register__(oe,me.weight,me.expiration).then(({success:Re,wait:ke,reservoir:De})=>{var Le;return this.Events.trigger("debug",`Drained ${me.id}`,{success:Re,args:Z,options:me}),Re?(_e.shift(),Le=this.empty(),Le&&this.Events.trigger("empty"),De===0&&this.Events.trigger("depleted",Le),this._run(oe,fe,ke),this.Promise.resolve(me.weight)):this.Promise.resolve(null)}))})}_drainAll(B,Z=0){return this._drainOne(B).then(oe=>{var fe;return oe!=null?(fe=B!=null?B-oe:B,this._drainAll(fe,Z+oe)):this.Promise.resolve(Z)}).catch(oe=>this.Events.trigger("error",oe))}_dropAllQueued(B){return this._queues.shiftAll(function(Z){return Z.doDrop({message:B})})}stop(B={}){var Z,oe;return B=G.load(B,this.stopDefaults),oe=fe=>{var me;return me=()=>{var _e;return _e=this._states.counts,_e[0]+_e[1]+_e[2]+_e[3]===fe},new this.Promise((_e,ye)=>me()?_e():this.on("done",()=>{if(me())return this.removeAllListeners("done"),_e()}))},Z=B.dropWaitingJobs?(this._run=function(fe,me){return me.doDrop({message:B.dropErrorMessage})},this._drainOne=()=>this.Promise.resolve(null),this._registerLock.schedule(()=>this._submitLock.schedule(()=>{var fe,me,_e;me=this._scheduled;for(fe in me)_e=me[fe],this.jobStatus(_e.job.options.id)==="RUNNING"&&(clearTimeout(_e.timeout),clearTimeout(_e.expiration),_e.job.doDrop({message:B.dropErrorMessage}));return this._dropAllQueued(B.dropErrorMessage),oe(0)}))):this.schedule({priority:Y-1,weight:0},()=>oe(1)),this._receive=function(fe){return fe._reject(new W.prototype.BottleneckError(B.enqueueErrorMessage))},this.stop=()=>this.Promise.reject(new W.prototype.BottleneckError("stop() has already been called")),Z}_addToQueue(B){var Z=this;return L(function*(){var oe,fe,me,_e,ye,Re,ke;oe=B.args,_e=B.options;try{var De=yield Z._store.__submit__(Z.queued(),_e.weight);ye=De.reachedHWM,fe=De.blocked,ke=De.strategy}catch(Le){return me=Le,Z.Events.trigger("debug",`Could not queue ${_e.id}`,{args:oe,options:_e,error:me}),B.doDrop({error:me}),!1}return fe?(B.doDrop(),!0):ye&&(Re=ke===W.prototype.strategy.LEAK?Z._queues.shiftLastFrom(_e.priority):ke===W.prototype.strategy.OVERFLOW_PRIORITY?Z._queues.shiftLastFrom(_e.priority+1):ke===W.prototype.strategy.OVERFLOW?B:void 0,Re!=null&&Re.doDrop(),Re==null||ke===W.prototype.strategy.OVERFLOW)?(Re==null&&B.doDrop(),ye):(B.doQueue(ye,fe),Z._queues.push(B),yield Z._drainAll(),ye)})()}_receive(B){return this._states.jobStatus(B.options.id)!=null?(B._reject(new W.prototype.BottleneckError(`A job with the same id already exists (id=${B.options.id})`)),!1):(B.doReceive(),this._submitLock.schedule(this._addToQueue,B))}submit(...B){var Z,oe,fe,me,_e,ye,Re;if(typeof B[0]=="function"){var ke,De,Le,Ve;_e=B,ke=_e,De=$(ke),oe=De[0],B=De.slice(1),Le=H.call(B,-1),Ve=A(Le,1),Z=Ve[0],me=G.load({},this.jobDefaults)}else{var Ke,we,pe,ie;ye=B,Ke=ye,we=$(Ke),me=we[0],oe=we[1],B=we.slice(2),pe=H.call(B,-1),ie=A(pe,1),Z=ie[0],me=G.load(me,this.jobDefaults)}return Re=(...he)=>new this.Promise(function(ce,K){return oe(...he,function(...ne){return(ne[0]!=null?K:ce)(ne)})}),fe=new V(Re,B,me,this.jobDefaults,this.rejectOnDrop,this.Events,this._states,this.Promise),fe.promise.then(function(he){return typeof Z=="function"?Z(...he):void 0}).catch(function(he){return Array.isArray(he)?typeof Z=="function"?Z(...he):void 0:typeof Z=="function"?Z(he):void 0}),this._receive(fe)}schedule(...B){var Z,oe,fe;if(typeof B[0]=="function"){var me=B,_e=$(me);fe=_e[0],B=_e.slice(1),oe={}}else{var ye=B,Re=$(ye);oe=Re[0],fe=Re[1],B=Re.slice(2)}return Z=new V(fe,B,oe,this.jobDefaults,this.rejectOnDrop,this.Events,this._states,this.Promise),this._receive(Z),Z.promise}wrap(B){var Z,oe;return Z=this.schedule.bind(this),oe=function(...me){return Z(B.bind(this),...me)},oe.withOptions=function(fe,...me){return Z(fe,B,...me)},oe}updateSettings(B={}){var Z=this;return L(function*(){return yield Z._store.__updateSettings__(G.overwrite(B,Z.storeDefaults)),G.overwrite(B,Z.instanceDefaults,Z),Z})()}currentReservoir(){return this._store.__currentReservoir__()}incrementReservoir(B=0){return this._store.__incrementReservoir__(B)}}return W.default=W,W.Events=U,W.version=W.prototype.version=require$$8.version,W.strategy=W.prototype.strategy={LEAK:1,OVERFLOW:2,OVERFLOW_PRIORITY:4,BLOCK:3},W.BottleneckError=W.prototype.BottleneckError=BottleneckError_1,W.Group=W.prototype.Group=requireGroup(),W.RedisConnection=W.prototype.RedisConnection=RedisConnection_1,W.IORedisConnection=W.prototype.IORedisConnection=IORedisConnection_1,W.Batcher=W.prototype.Batcher=requireBatcher(),W.prototype.jobDefaults={priority:F,weight:1,expiration:null,id:"<no-id>"},W.prototype.storeDefaults={maxConcurrent:null,minTime:0,highWater:null,strategy:W.prototype.strategy.LEAK,penalty:null,reservoir:null,reservoirRefreshInterval:null,reservoirRefreshAmount:null,reservoirIncreaseInterval:null,reservoirIncreaseAmount:null,reservoirIncreaseMaximum:null},W.prototype.localStoreDefaults={Promise,timeout:null,heartbeatInterval:250},W.prototype.redisStoreDefaults={Promise,timeout:null,heartbeatInterval:5e3,clientTimeout:1e4,Redis:null,clientOptions:{},clusterNodes:null,clearDatastore:!1,connection:null},W.prototype.instanceDefaults={datastore:"local",connection:null,id:"<no-id>",rejectOnDrop:!0,trackDoneStatus:!1,Promise},W.prototype.stopDefaults={enqueueErrorMessage:"This limiter has been stopped and cannot accept new jobs.",dropWaitingJobs:!0,dropErrorMessage:"This limiter has been stopped."},W}).call(void 0),Bottleneck_1=x,Bottleneck_1}requireBottleneck();const nanoid=customAlphabet("abcdefghijklmnopqrstuvwxyz"),newId=()=>nanoid(15);var ajv={exports:{}},core$2={},validate={},boolSchema={},errors={},codegen={},code$1={};(function(A){Object.defineProperty(A,"__esModule",{value:!0}),A.regexpCode=A.getEsmExportName=A.getProperty=A.safeStringify=A.stringify=A.strConcat=A.addCodeArg=A.str=A._=A.nil=A._Code=A.Name=A.IDENTIFIER=A._CodeOrName=void 0;class _{}A._CodeOrName=_,A.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class $ extends _{constructor(G){if(super(),!A.IDENTIFIER.test(G))throw new Error("CodeGen: name must be a valid identifier");this.str=G}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}A.Name=$;class D extends _{constructor(G){super(),this._items=typeof G=="string"?[G]:G}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const G=this._items[0];return G===""||G==='""'}get str(){var G;return(G=this._str)!==null&&G!==void 0?G:this._str=this._items.reduce((H,W)=>`${H}${W}`,"")}get names(){var G;return(G=this._names)!==null&&G!==void 0?G:this._names=this._items.reduce((H,W)=>(W instanceof $&&(H[W.str]=(H[W.str]||0)+1),H),{})}}A._Code=D,A.nil=new D("");function N(z,...G){const H=[z[0]];let W=0;for(;W<G.length;)L(H,G[W]),H.push(z[++W]);return new D(H)}A._=N;const q=new D("+");function M(z,...G){const H=[Y(z[0])];let W=0;for(;W<G.length;)H.push(q),L(H,G[W]),H.push(q,Y(z[++W]));return x(H),new D(H)}A.str=M;function L(z,G){G instanceof D?z.push(...G._items):G instanceof $?z.push(G):z.push(V(G))}A.addCodeArg=L;function x(z){let G=1;for(;G<z.length-1;){if(z[G]===q){const H=F(z[G-1],z[G+1]);if(H!==void 0){z.splice(G-1,3,H);continue}z[G++]="+"}G++}}function F(z,G){if(G==='""')return z;if(z==='""')return G;if(typeof z=="string")return G instanceof $||z[z.length-1]!=='"'?void 0:typeof G!="string"?`${z.slice(0,-1)}${G}"`:G[0]==='"'?z.slice(0,-1)+G.slice(1):void 0;if(typeof G=="string"&&G[0]==='"'&&!(z instanceof $))return`"${z}${G.slice(1)}`}function U(z,G){return G.emptyStr()?z:z.emptyStr()?G:M`${z}${G}`}A.strConcat=U;function V(z){return typeof z=="number"||typeof z=="boolean"||z===null?z:Y(Array.isArray(z)?z.join(","):z)}function Q(z){return new D(Y(z))}A.stringify=Q;function Y(z){return JSON.stringify(z).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}A.safeStringify=Y;function X(z){return typeof z=="string"&&A.IDENTIFIER.test(z)?new D(`.${z}`):N`[${z}]`}A.getProperty=X;function ee(z){if(typeof z=="string"&&A.IDENTIFIER.test(z))return new D(`${z}`);throw new Error(`CodeGen: invalid export name: ${z}, use explicit $id name mapping`)}A.getEsmExportName=ee;function te(z){return new D(z.toString())}A.regexpCode=te})(code$1);var scope={};(function(A){Object.defineProperty(A,"__esModule",{value:!0}),A.ValueScope=A.ValueScopeName=A.Scope=A.varKinds=A.UsedValueState=void 0;const _=code$1;class $ extends Error{constructor(F){super(`CodeGen: "code" for ${F} not defined`),this.value=F.value}}var D;(function(x){x[x.Started=0]="Started",x[x.Completed=1]="Completed"})(D=A.UsedValueState||(A.UsedValueState={})),A.varKinds={const:new _.Name("const"),let:new _.Name("let"),var:new _.Name("var")};class N{constructor({prefixes:F,parent:U}={}){this._names={},this._prefixes=F,this._parent=U}toName(F){return F instanceof _.Name?F:this.name(F)}name(F){return new _.Name(this._newName(F))}_newName(F){const U=this._names[F]||this._nameGroup(F);return`${F}${U.index++}`}_nameGroup(F){var U,V;if(!((V=(U=this._parent)===null||U===void 0?void 0:U._prefixes)===null||V===void 0)&&V.has(F)||this._prefixes&&!this._prefixes.has(F))throw new Error(`CodeGen: prefix "${F}" is not allowed in this scope`);return this._names[F]={prefix:F,index:0}}}A.Scope=N;class q extends _.Name{constructor(F,U){super(U),this.prefix=F}setValue(F,{property:U,itemIndex:V}){this.value=F,this.scopePath=(0,_._)`.${new _.Name(U)}[${V}]`}}A.ValueScopeName=q;const M=(0,_._)`\n`;class L extends N{constructor(F){super(F),this._values={},this._scope=F.scope,this.opts={...F,_n:F.lines?M:_.nil}}get(){return this._scope}name(F){return new q(F,this._newName(F))}value(F,U){var V;if(U.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const Q=this.toName(F),{prefix:Y}=Q,X=(V=U.key)!==null&&V!==void 0?V:U.ref;let ee=this._values[Y];if(ee){const G=ee.get(X);if(G)return G}else ee=this._values[Y]=new Map;ee.set(X,Q);const te=this._scope[Y]||(this._scope[Y]=[]),z=te.length;return te[z]=U.ref,Q.setValue(U,{property:Y,itemIndex:z}),Q}getValue(F,U){const V=this._values[F];if(V)return V.get(U)}scopeRefs(F,U=this._values){return this._reduceValues(U,V=>{if(V.scopePath===void 0)throw new Error(`CodeGen: name "${V}" has no value`);return(0,_._)`${F}${V.scopePath}`})}scopeCode(F=this._values,U,V){return this._reduceValues(F,Q=>{if(Q.value===void 0)throw new Error(`CodeGen: name "${Q}" has no value`);return Q.value.code},U,V)}_reduceValues(F,U,V={},Q){let Y=_.nil;for(const X in F){const ee=F[X];if(!ee)continue;const te=V[X]=V[X]||new Map;ee.forEach(z=>{if(te.has(z))return;te.set(z,D.Started);let G=U(z);if(G){const H=this.opts.es5?A.varKinds.var:A.varKinds.const;Y=(0,_._)`${Y}${H} ${z} = ${G};${this.opts._n}`}else if(G=Q==null?void 0:Q(z))Y=(0,_._)`${Y}${G}${this.opts._n}`;else throw new $(z);te.set(z,D.Completed)})}return Y}}A.ValueScope=L})(scope);(function(A){Object.defineProperty(A,"__esModule",{value:!0}),A.or=A.and=A.not=A.CodeGen=A.operators=A.varKinds=A.ValueScopeName=A.ValueScope=A.Scope=A.Name=A.regexpCode=A.stringify=A.getProperty=A.nil=A.strConcat=A.str=A._=void 0;const _=code$1,$=scope;var D=code$1;Object.defineProperty(A,"_",{enumerable:!0,get:function(){return D._}}),Object.defineProperty(A,"str",{enumerable:!0,get:function(){return D.str}}),Object.defineProperty(A,"strConcat",{enumerable:!0,get:function(){return D.strConcat}}),Object.defineProperty(A,"nil",{enumerable:!0,get:function(){return D.nil}}),Object.defineProperty(A,"getProperty",{enumerable:!0,get:function(){return D.getProperty}}),Object.defineProperty(A,"stringify",{enumerable:!0,get:function(){return D.stringify}}),Object.defineProperty(A,"regexpCode",{enumerable:!0,get:function(){return D.regexpCode}}),Object.defineProperty(A,"Name",{enumerable:!0,get:function(){return D.Name}});var N=scope;Object.defineProperty(A,"Scope",{enumerable:!0,get:function(){return N.Scope}}),Object.defineProperty(A,"ValueScope",{enumerable:!0,get:function(){return N.ValueScope}}),Object.defineProperty(A,"ValueScopeName",{enumerable:!0,get:function(){return N.ValueScopeName}}),Object.defineProperty(A,"varKinds",{enumerable:!0,get:function(){return N.varKinds}}),A.operators={GT:new _._Code(">"),GTE:new _._Code(">="),LT:new _._Code("<"),LTE:new _._Code("<="),EQ:new _._Code("==="),NEQ:new _._Code("!=="),NOT:new _._Code("!"),OR:new _._Code("||"),AND:new _._Code("&&"),ADD:new _._Code("+")};class q{optimizeNodes(){return this}optimizeNames(K,ne){return this}}class M extends q{constructor(K,ne,de){super(),this.varKind=K,this.name=ne,this.rhs=de}render({es5:K,_n:ne}){const de=K?$.varKinds.var:this.varKind,ge=this.rhs===void 0?"":` = ${this.rhs}`;return`${de} ${this.name}${ge};`+ne}optimizeNames(K,ne){if(K[this.name.str])return this.rhs&&(this.rhs=ke(this.rhs,K,ne)),this}get names(){return this.rhs instanceof _._CodeOrName?this.rhs.names:{}}}class L extends q{constructor(K,ne,de){super(),this.lhs=K,this.rhs=ne,this.sideEffects=de}render({_n:K}){return`${this.lhs} = ${this.rhs};`+K}optimizeNames(K,ne){if(!(this.lhs instanceof _.Name&&!K[this.lhs.str]&&!this.sideEffects))return this.rhs=ke(this.rhs,K,ne),this}get names(){const K=this.lhs instanceof _.Name?{}:{...this.lhs.names};return Re(K,this.rhs)}}class x extends L{constructor(K,ne,de,ge){super(K,de,ge),this.op=ne}render({_n:K}){return`${this.lhs} ${this.op}= ${this.rhs};`+K}}class F extends q{constructor(K){super(),this.label=K,this.names={}}render({_n:K}){return`${this.label}:`+K}}class U extends q{constructor(K){super(),this.label=K,this.names={}}render({_n:K}){return`break${this.label?` ${this.label}`:""};`+K}}class V extends q{constructor(K){super(),this.error=K}render({_n:K}){return`throw ${this.error};`+K}get names(){return this.error.names}}class Q extends q{constructor(K){super(),this.code=K}render({_n:K}){return`${this.code};`+K}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(K,ne){return this.code=ke(this.code,K,ne),this}get names(){return this.code instanceof _._CodeOrName?this.code.names:{}}}class Y extends q{constructor(K=[]){super(),this.nodes=K}render(K){return this.nodes.reduce((ne,de)=>ne+de.render(K),"")}optimizeNodes(){const{nodes:K}=this;let ne=K.length;for(;ne--;){const de=K[ne].optimizeNodes();Array.isArray(de)?K.splice(ne,1,...de):de?K[ne]=de:K.splice(ne,1)}return K.length>0?this:void 0}optimizeNames(K,ne){const{nodes:de}=this;let ge=de.length;for(;ge--;){const ve=de[ge];ve.optimizeNames(K,ne)||(De(K,ve.names),de.splice(ge,1))}return de.length>0?this:void 0}get names(){return this.nodes.reduce((K,ne)=>ye(K,ne.names),{})}}class X extends Y{render(K){return"{"+K._n+super.render(K)+"}"+K._n}}class ee extends Y{}class te extends X{}te.kind="else";class z extends X{constructor(K,ne){super(ne),this.condition=K}render(K){let ne=`if(${this.condition})`+super.render(K);return this.else&&(ne+="else "+this.else.render(K)),ne}optimizeNodes(){super.optimizeNodes();const K=this.condition;if(K===!0)return this.nodes;let ne=this.else;if(ne){const de=ne.optimizeNodes();ne=this.else=Array.isArray(de)?new te(de):de}if(ne)return K===!1?ne instanceof z?ne:ne.nodes:this.nodes.length?this:new z(Le(K),ne instanceof z?[ne]:ne.nodes);if(!(K===!1||!this.nodes.length))return this}optimizeNames(K,ne){var de;if(this.else=(de=this.else)===null||de===void 0?void 0:de.optimizeNames(K,ne),!!(super.optimizeNames(K,ne)||this.else))return this.condition=ke(this.condition,K,ne),this}get names(){const K=super.names;return Re(K,this.condition),this.else&&ye(K,this.else.names),K}}z.kind="if";class G extends X{}G.kind="for";class H extends G{constructor(K){super(),this.iteration=K}render(K){return`for(${this.iteration})`+super.render(K)}optimizeNames(K,ne){if(super.optimizeNames(K,ne))return this.iteration=ke(this.iteration,K,ne),this}get names(){return ye(super.names,this.iteration.names)}}class W extends G{constructor(K,ne,de,ge){super(),this.varKind=K,this.name=ne,this.from=de,this.to=ge}render(K){const ne=K.es5?$.varKinds.var:this.varKind,{name:de,from:ge,to:ve}=this;return`for(${ne} ${de}=${ge}; ${de}<${ve}; ${de}++)`+super.render(K)}get names(){const K=Re(super.names,this.from);return Re(K,this.to)}}class ae extends G{constructor(K,ne,de,ge){super(),this.loop=K,this.varKind=ne,this.name=de,this.iterable=ge}render(K){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(K)}optimizeNames(K,ne){if(super.optimizeNames(K,ne))return this.iterable=ke(this.iterable,K,ne),this}get names(){return ye(super.names,this.iterable.names)}}class B extends X{constructor(K,ne,de){super(),this.name=K,this.args=ne,this.async=de}render(K){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(K)}}B.kind="func";class Z extends Y{render(K){return"return "+super.render(K)}}Z.kind="return";class oe extends X{render(K){let ne="try"+super.render(K);return this.catch&&(ne+=this.catch.render(K)),this.finally&&(ne+=this.finally.render(K)),ne}optimizeNodes(){var K,ne;return super.optimizeNodes(),(K=this.catch)===null||K===void 0||K.optimizeNodes(),(ne=this.finally)===null||ne===void 0||ne.optimizeNodes(),this}optimizeNames(K,ne){var de,ge;return super.optimizeNames(K,ne),(de=this.catch)===null||de===void 0||de.optimizeNames(K,ne),(ge=this.finally)===null||ge===void 0||ge.optimizeNames(K,ne),this}get names(){const K=super.names;return this.catch&&ye(K,this.catch.names),this.finally&&ye(K,this.finally.names),K}}class fe extends X{constructor(K){super(),this.error=K}render(K){return`catch(${this.error})`+super.render(K)}}fe.kind="catch";class me extends X{render(K){return"finally"+super.render(K)}}me.kind="finally";class _e{constructor(K,ne={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...ne,_n:ne.lines?`
`:""},this._extScope=K,this._scope=new $.Scope({parent:K}),this._nodes=[new ee]}toString(){return this._root.render(this.opts)}name(K){return this._scope.name(K)}scopeName(K){return this._extScope.name(K)}scopeValue(K,ne){const de=this._extScope.value(K,ne);return(this._values[de.prefix]||(this._values[de.prefix]=new Set)).add(de),de}getScopeValue(K,ne){return this._extScope.getValue(K,ne)}scopeRefs(K){return this._extScope.scopeRefs(K,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(K,ne,de,ge){const ve=this._scope.toName(ne);return de!==void 0&&ge&&(this._constants[ve.str]=de),this._leafNode(new M(K,ve,de)),ve}const(K,ne,de){return this._def($.varKinds.const,K,ne,de)}let(K,ne,de){return this._def($.varKinds.let,K,ne,de)}var(K,ne,de){return this._def($.varKinds.var,K,ne,de)}assign(K,ne,de){return this._leafNode(new L(K,ne,de))}add(K,ne){return this._leafNode(new x(K,A.operators.ADD,ne))}code(K){return typeof K=="function"?K():K!==_.nil&&this._leafNode(new Q(K)),this}object(...K){const ne=["{"];for(const[de,ge]of K)ne.length>1&&ne.push(","),ne.push(de),(de!==ge||this.opts.es5)&&(ne.push(":"),(0,_.addCodeArg)(ne,ge));return ne.push("}"),new _._Code(ne)}if(K,ne,de){if(this._blockNode(new z(K)),ne&&de)this.code(ne).else().code(de).endIf();else if(ne)this.code(ne).endIf();else if(de)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(K){return this._elseNode(new z(K))}else(){return this._elseNode(new te)}endIf(){return this._endBlockNode(z,te)}_for(K,ne){return this._blockNode(K),ne&&this.code(ne).endFor(),this}for(K,ne){return this._for(new H(K),ne)}forRange(K,ne,de,ge,ve=this.opts.es5?$.varKinds.var:$.varKinds.let){const Se=this._scope.toName(K);return this._for(new W(ve,Se,ne,de),()=>ge(Se))}forOf(K,ne,de,ge=$.varKinds.const){const ve=this._scope.toName(K);if(this.opts.es5){const Se=ne instanceof _.Name?ne:this.var("_arr",ne);return this.forRange("_i",0,(0,_._)`${Se}.length`,Ce=>{this.var(ve,(0,_._)`${Se}[${Ce}]`),de(ve)})}return this._for(new ae("of",ge,ve,ne),()=>de(ve))}forIn(K,ne,de,ge=this.opts.es5?$.varKinds.var:$.varKinds.const){if(this.opts.ownProperties)return this.forOf(K,(0,_._)`Object.keys(${ne})`,de);const ve=this._scope.toName(K);return this._for(new ae("in",ge,ve,ne),()=>de(ve))}endFor(){return this._endBlockNode(G)}label(K){return this._leafNode(new F(K))}break(K){return this._leafNode(new U(K))}return(K){const ne=new Z;if(this._blockNode(ne),this.code(K),ne.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(Z)}try(K,ne,de){if(!ne&&!de)throw new Error('CodeGen: "try" without "catch" and "finally"');const ge=new oe;if(this._blockNode(ge),this.code(K),ne){const ve=this.name("e");this._currNode=ge.catch=new fe(ve),ne(ve)}return de&&(this._currNode=ge.finally=new me,this.code(de)),this._endBlockNode(fe,me)}throw(K){return this._leafNode(new V(K))}block(K,ne){return this._blockStarts.push(this._nodes.length),K&&this.code(K).endBlock(ne),this}endBlock(K){const ne=this._blockStarts.pop();if(ne===void 0)throw new Error("CodeGen: not in self-balancing block");const de=this._nodes.length-ne;if(de<0||K!==void 0&&de!==K)throw new Error(`CodeGen: wrong number of nodes: ${de} vs ${K} expected`);return this._nodes.length=ne,this}func(K,ne=_.nil,de,ge){return this._blockNode(new B(K,ne,de)),ge&&this.code(ge).endFunc(),this}endFunc(){return this._endBlockNode(B)}optimize(K=1){for(;K-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(K){return this._currNode.nodes.push(K),this}_blockNode(K){this._currNode.nodes.push(K),this._nodes.push(K)}_endBlockNode(K,ne){const de=this._currNode;if(de instanceof K||ne&&de instanceof ne)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${ne?`${K.kind}/${ne.kind}`:K.kind}"`)}_elseNode(K){const ne=this._currNode;if(!(ne instanceof z))throw new Error('CodeGen: "else" without "if"');return this._currNode=ne.else=K,this}get _root(){return this._nodes[0]}get _currNode(){const K=this._nodes;return K[K.length-1]}set _currNode(K){const ne=this._nodes;ne[ne.length-1]=K}}A.CodeGen=_e;function ye(ce,K){for(const ne in K)ce[ne]=(ce[ne]||0)+(K[ne]||0);return ce}function Re(ce,K){return K instanceof _._CodeOrName?ye(ce,K.names):ce}function ke(ce,K,ne){if(ce instanceof _.Name)return de(ce);if(!ge(ce))return ce;return new _._Code(ce._items.reduce((ve,Se)=>(Se instanceof _.Name&&(Se=de(Se)),Se instanceof _._Code?ve.push(...Se._items):ve.push(Se),ve),[]));function de(ve){const Se=ne[ve.str];return Se===void 0||K[ve.str]!==1?ve:(delete K[ve.str],Se)}function ge(ve){return ve instanceof _._Code&&ve._items.some(Se=>Se instanceof _.Name&&K[Se.str]===1&&ne[Se.str]!==void 0)}}function De(ce,K){for(const ne in K)ce[ne]=(ce[ne]||0)-(K[ne]||0)}function Le(ce){return typeof ce=="boolean"||typeof ce=="number"||ce===null?!ce:(0,_._)`!${he(ce)}`}A.not=Le;const Ve=ie(A.operators.AND);function Ke(...ce){return ce.reduce(Ve)}A.and=Ke;const we=ie(A.operators.OR);function pe(...ce){return ce.reduce(we)}A.or=pe;function ie(ce){return(K,ne)=>K===_.nil?ne:ne===_.nil?K:(0,_._)`${he(K)} ${ce} ${he(ne)}`}function he(ce){return ce instanceof _.Name?ce:(0,_._)`(${ce})`}})(codegen);var util={};(function(A){Object.defineProperty(A,"__esModule",{value:!0}),A.checkStrictMode=A.getErrorPath=A.Type=A.useFunc=A.setEvaluated=A.evaluatedPropsToName=A.mergeEvaluated=A.eachItem=A.unescapeJsonPointer=A.escapeJsonPointer=A.escapeFragment=A.unescapeFragment=A.schemaRefOrVal=A.schemaHasRulesButRef=A.schemaHasRules=A.checkUnknownRules=A.alwaysValidSchema=A.toHash=void 0;const _=codegen,$=code$1;function D(B){const Z={};for(const oe of B)Z[oe]=!0;return Z}A.toHash=D;function N(B,Z){return typeof Z=="boolean"?Z:Object.keys(Z).length===0?!0:(q(B,Z),!M(Z,B.self.RULES.all))}A.alwaysValidSchema=N;function q(B,Z=B.schema){const{opts:oe,self:fe}=B;if(!oe.strictSchema||typeof Z=="boolean")return;const me=fe.RULES.keywords;for(const _e in Z)me[_e]||ae(B,`unknown keyword: "${_e}"`)}A.checkUnknownRules=q;function M(B,Z){if(typeof B=="boolean")return!B;for(const oe in B)if(Z[oe])return!0;return!1}A.schemaHasRules=M;function L(B,Z){if(typeof B=="boolean")return!B;for(const oe in B)if(oe!=="$ref"&&Z.all[oe])return!0;return!1}A.schemaHasRulesButRef=L;function x({topSchemaRef:B,schemaPath:Z},oe,fe,me){if(!me){if(typeof oe=="number"||typeof oe=="boolean")return oe;if(typeof oe=="string")return(0,_._)`${oe}`}return(0,_._)`${B}${Z}${(0,_.getProperty)(fe)}`}A.schemaRefOrVal=x;function F(B){return Q(decodeURIComponent(B))}A.unescapeFragment=F;function U(B){return encodeURIComponent(V(B))}A.escapeFragment=U;function V(B){return typeof B=="number"?`${B}`:B.replace(/~/g,"~0").replace(/\//g,"~1")}A.escapeJsonPointer=V;function Q(B){return B.replace(/~1/g,"/").replace(/~0/g,"~")}A.unescapeJsonPointer=Q;function Y(B,Z){if(Array.isArray(B))for(const oe of B)Z(oe);else Z(B)}A.eachItem=Y;function X({mergeNames:B,mergeToName:Z,mergeValues:oe,resultToName:fe}){return(me,_e,ye,Re)=>{const ke=ye===void 0?_e:ye instanceof _.Name?(_e instanceof _.Name?B(me,_e,ye):Z(me,_e,ye),ye):_e instanceof _.Name?(Z(me,ye,_e),_e):oe(_e,ye);return Re===_.Name&&!(ke instanceof _.Name)?fe(me,ke):ke}}A.mergeEvaluated={props:X({mergeNames:(B,Z,oe)=>B.if((0,_._)`${oe} !== true && ${Z} !== undefined`,()=>{B.if((0,_._)`${Z} === true`,()=>B.assign(oe,!0),()=>B.assign(oe,(0,_._)`${oe} || {}`).code((0,_._)`Object.assign(${oe}, ${Z})`))}),mergeToName:(B,Z,oe)=>B.if((0,_._)`${oe} !== true`,()=>{Z===!0?B.assign(oe,!0):(B.assign(oe,(0,_._)`${oe} || {}`),te(B,oe,Z))}),mergeValues:(B,Z)=>B===!0?!0:{...B,...Z},resultToName:ee}),items:X({mergeNames:(B,Z,oe)=>B.if((0,_._)`${oe} !== true && ${Z} !== undefined`,()=>B.assign(oe,(0,_._)`${Z} === true ? true : ${oe} > ${Z} ? ${oe} : ${Z}`)),mergeToName:(B,Z,oe)=>B.if((0,_._)`${oe} !== true`,()=>B.assign(oe,Z===!0?!0:(0,_._)`${oe} > ${Z} ? ${oe} : ${Z}`)),mergeValues:(B,Z)=>B===!0?!0:Math.max(B,Z),resultToName:(B,Z)=>B.var("items",Z)})};function ee(B,Z){if(Z===!0)return B.var("props",!0);const oe=B.var("props",(0,_._)`{}`);return Z!==void 0&&te(B,oe,Z),oe}A.evaluatedPropsToName=ee;function te(B,Z,oe){Object.keys(oe).forEach(fe=>B.assign((0,_._)`${Z}${(0,_.getProperty)(fe)}`,!0))}A.setEvaluated=te;const z={};function G(B,Z){return B.scopeValue("func",{ref:Z,code:z[Z.code]||(z[Z.code]=new $._Code(Z.code))})}A.useFunc=G;var H;(function(B){B[B.Num=0]="Num",B[B.Str=1]="Str"})(H=A.Type||(A.Type={}));function W(B,Z,oe){if(B instanceof _.Name){const fe=Z===H.Num;return oe?fe?(0,_._)`"[" + ${B} + "]"`:(0,_._)`"['" + ${B} + "']"`:fe?(0,_._)`"/" + ${B}`:(0,_._)`"/" + ${B}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return oe?(0,_.getProperty)(B).toString():"/"+V(B)}A.getErrorPath=W;function ae(B,Z,oe=B.opts.strictSchema){if(oe){if(Z=`strict mode: ${Z}`,oe===!0)throw new Error(Z);B.self.logger.warn(Z)}}A.checkStrictMode=ae})(util);var names$1={};Object.defineProperty(names$1,"__esModule",{value:!0});const codegen_1$t=codegen,names={data:new codegen_1$t.Name("data"),valCxt:new codegen_1$t.Name("valCxt"),instancePath:new codegen_1$t.Name("instancePath"),parentData:new codegen_1$t.Name("parentData"),parentDataProperty:new codegen_1$t.Name("parentDataProperty"),rootData:new codegen_1$t.Name("rootData"),dynamicAnchors:new codegen_1$t.Name("dynamicAnchors"),vErrors:new codegen_1$t.Name("vErrors"),errors:new codegen_1$t.Name("errors"),this:new codegen_1$t.Name("this"),self:new codegen_1$t.Name("self"),scope:new codegen_1$t.Name("scope"),json:new codegen_1$t.Name("json"),jsonPos:new codegen_1$t.Name("jsonPos"),jsonLen:new codegen_1$t.Name("jsonLen"),jsonPart:new codegen_1$t.Name("jsonPart")};names$1.default=names;(function(A){Object.defineProperty(A,"__esModule",{value:!0}),A.extendErrors=A.resetErrorsCount=A.reportExtraError=A.reportError=A.keyword$DataError=A.keywordError=void 0;const _=codegen,$=util,D=names$1;A.keywordError={message:({keyword:te})=>(0,_.str)`must pass "${te}" keyword validation`},A.keyword$DataError={message:({keyword:te,schemaType:z})=>z?(0,_.str)`"${te}" keyword must be ${z} ($data)`:(0,_.str)`"${te}" keyword is invalid ($data)`};function N(te,z=A.keywordError,G,H){const{it:W}=te,{gen:ae,compositeRule:B,allErrors:Z}=W,oe=V(te,z,G);H??(B||Z)?x(ae,oe):F(W,(0,_._)`[${oe}]`)}A.reportError=N;function q(te,z=A.keywordError,G){const{it:H}=te,{gen:W,compositeRule:ae,allErrors:B}=H,Z=V(te,z,G);x(W,Z),ae||B||F(H,D.default.vErrors)}A.reportExtraError=q;function M(te,z){te.assign(D.default.errors,z),te.if((0,_._)`${D.default.vErrors} !== null`,()=>te.if(z,()=>te.assign((0,_._)`${D.default.vErrors}.length`,z),()=>te.assign(D.default.vErrors,null)))}A.resetErrorsCount=M;function L({gen:te,keyword:z,schemaValue:G,data:H,errsCount:W,it:ae}){if(W===void 0)throw new Error("ajv implementation error");const B=te.name("err");te.forRange("i",W,D.default.errors,Z=>{te.const(B,(0,_._)`${D.default.vErrors}[${Z}]`),te.if((0,_._)`${B}.instancePath === undefined`,()=>te.assign((0,_._)`${B}.instancePath`,(0,_.strConcat)(D.default.instancePath,ae.errorPath))),te.assign((0,_._)`${B}.schemaPath`,(0,_.str)`${ae.errSchemaPath}/${z}`),ae.opts.verbose&&(te.assign((0,_._)`${B}.schema`,G),te.assign((0,_._)`${B}.data`,H))})}A.extendErrors=L;function x(te,z){const G=te.const("err",z);te.if((0,_._)`${D.default.vErrors} === null`,()=>te.assign(D.default.vErrors,(0,_._)`[${G}]`),(0,_._)`${D.default.vErrors}.push(${G})`),te.code((0,_._)`${D.default.errors}++`)}function F(te,z){const{gen:G,validateName:H,schemaEnv:W}=te;W.$async?G.throw((0,_._)`new ${te.ValidationError}(${z})`):(G.assign((0,_._)`${H}.errors`,z),G.return(!1))}const U={keyword:new _.Name("keyword"),schemaPath:new _.Name("schemaPath"),params:new _.Name("params"),propertyName:new _.Name("propertyName"),message:new _.Name("message"),schema:new _.Name("schema"),parentSchema:new _.Name("parentSchema")};function V(te,z,G){const{createErrors:H}=te.it;return H===!1?(0,_._)`{}`:Q(te,z,G)}function Q(te,z,G={}){const{gen:H,it:W}=te,ae=[Y(W,G),X(te,G)];return ee(te,z,ae),H.object(...ae)}function Y({errorPath:te},{instancePath:z}){const G=z?(0,_.str)`${te}${(0,$.getErrorPath)(z,$.Type.Str)}`:te;return[D.default.instancePath,(0,_.strConcat)(D.default.instancePath,G)]}function X({keyword:te,it:{errSchemaPath:z}},{schemaPath:G,parentSchema:H}){let W=H?z:(0,_.str)`${z}/${te}`;return G&&(W=(0,_.str)`${W}${(0,$.getErrorPath)(G,$.Type.Str)}`),[U.schemaPath,W]}function ee(te,{params:z,message:G},H){const{keyword:W,data:ae,schemaValue:B,it:Z}=te,{opts:oe,propertyName:fe,topSchemaRef:me,schemaPath:_e}=Z;H.push([U.keyword,W],[U.params,typeof z=="function"?z(te):z||(0,_._)`{}`]),oe.messages&&H.push([U.message,typeof G=="function"?G(te):G]),oe.verbose&&H.push([U.schema,B],[U.parentSchema,(0,_._)`${me}${_e}`],[D.default.data,ae]),fe&&H.push([U.propertyName,fe])}})(errors);Object.defineProperty(boolSchema,"__esModule",{value:!0});boolSchema.boolOrEmptySchema=boolSchema.topBoolOrEmptySchema=void 0;const errors_1$2=errors,codegen_1$s=codegen,names_1$6=names$1,boolError={message:"boolean schema is false"};function topBoolOrEmptySchema(A){const{gen:_,schema:$,validateName:D}=A;$===!1?falseSchemaError(A,!1):typeof $=="object"&&$.$async===!0?_.return(names_1$6.default.data):(_.assign((0,codegen_1$s._)`${D}.errors`,null),_.return(!0))}boolSchema.topBoolOrEmptySchema=topBoolOrEmptySchema;function boolOrEmptySchema(A,_){const{gen:$,schema:D}=A;D===!1?($.var(_,!1),falseSchemaError(A)):$.var(_,!0)}boolSchema.boolOrEmptySchema=boolOrEmptySchema;function falseSchemaError(A,_){const{gen:$,data:D}=A,N={gen:$,keyword:"false schema",data:D,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:A};(0,errors_1$2.reportError)(N,boolError,void 0,_)}var dataType={},rules={};Object.defineProperty(rules,"__esModule",{value:!0});rules.getRules=rules.isJSONType=void 0;const _jsonTypes=["string","number","integer","boolean","null","object","array"],jsonTypes=new Set(_jsonTypes);function isJSONType(A){return typeof A=="string"&&jsonTypes.has(A)}rules.isJSONType=isJSONType;function getRules(){const A={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...A,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},A.number,A.string,A.array,A.object],post:{rules:[]},all:{},keywords:{}}}rules.getRules=getRules;var applicability={};Object.defineProperty(applicability,"__esModule",{value:!0});applicability.shouldUseRule=applicability.shouldUseGroup=applicability.schemaHasRulesForType=void 0;function schemaHasRulesForType({schema:A,self:_},$){const D=_.RULES.types[$];return D&&D!==!0&&shouldUseGroup(A,D)}applicability.schemaHasRulesForType=schemaHasRulesForType;function shouldUseGroup(A,_){return _.rules.some($=>shouldUseRule(A,$))}applicability.shouldUseGroup=shouldUseGroup;function shouldUseRule(A,_){var $;return A[_.keyword]!==void 0||(($=_.definition.implements)===null||$===void 0?void 0:$.some(D=>A[D]!==void 0))}applicability.shouldUseRule=shouldUseRule;(function(A){Object.defineProperty(A,"__esModule",{value:!0}),A.reportTypeError=A.checkDataTypes=A.checkDataType=A.coerceAndCheckDataType=A.getJSONTypes=A.getSchemaTypes=A.DataType=void 0;const _=rules,$=applicability,D=errors,N=codegen,q=util;var M;(function(H){H[H.Correct=0]="Correct",H[H.Wrong=1]="Wrong"})(M=A.DataType||(A.DataType={}));function L(H){const W=x(H.type);if(W.includes("null")){if(H.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!W.length&&H.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');H.nullable===!0&&W.push("null")}return W}A.getSchemaTypes=L;function x(H){const W=Array.isArray(H)?H:H?[H]:[];if(W.every(_.isJSONType))return W;throw new Error("type must be JSONType or JSONType[]: "+W.join(","))}A.getJSONTypes=x;function F(H,W){const{gen:ae,data:B,opts:Z}=H,oe=V(W,Z.coerceTypes),fe=W.length>0&&!(oe.length===0&&W.length===1&&(0,$.schemaHasRulesForType)(H,W[0]));if(fe){const me=ee(W,B,Z.strictNumbers,M.Wrong);ae.if(me,()=>{oe.length?Q(H,W,oe):z(H)})}return fe}A.coerceAndCheckDataType=F;const U=new Set(["string","number","integer","boolean","null"]);function V(H,W){return W?H.filter(ae=>U.has(ae)||W==="array"&&ae==="array"):[]}function Q(H,W,ae){const{gen:B,data:Z,opts:oe}=H,fe=B.let("dataType",(0,N._)`typeof ${Z}`),me=B.let("coerced",(0,N._)`undefined`);oe.coerceTypes==="array"&&B.if((0,N._)`${fe} == 'object' && Array.isArray(${Z}) && ${Z}.length == 1`,()=>B.assign(Z,(0,N._)`${Z}[0]`).assign(fe,(0,N._)`typeof ${Z}`).if(ee(W,Z,oe.strictNumbers),()=>B.assign(me,Z))),B.if((0,N._)`${me} !== undefined`);for(const ye of ae)(U.has(ye)||ye==="array"&&oe.coerceTypes==="array")&&_e(ye);B.else(),z(H),B.endIf(),B.if((0,N._)`${me} !== undefined`,()=>{B.assign(Z,me),Y(H,me)});function _e(ye){switch(ye){case"string":B.elseIf((0,N._)`${fe} == "number" || ${fe} == "boolean"`).assign(me,(0,N._)`"" + ${Z}`).elseIf((0,N._)`${Z} === null`).assign(me,(0,N._)`""`);return;case"number":B.elseIf((0,N._)`${fe} == "boolean" || ${Z} === null
              || (${fe} == "string" && ${Z} && ${Z} == +${Z})`).assign(me,(0,N._)`+${Z}`);return;case"integer":B.elseIf((0,N._)`${fe} === "boolean" || ${Z} === null
              || (${fe} === "string" && ${Z} && ${Z} == +${Z} && !(${Z} % 1))`).assign(me,(0,N._)`+${Z}`);return;case"boolean":B.elseIf((0,N._)`${Z} === "false" || ${Z} === 0 || ${Z} === null`).assign(me,!1).elseIf((0,N._)`${Z} === "true" || ${Z} === 1`).assign(me,!0);return;case"null":B.elseIf((0,N._)`${Z} === "" || ${Z} === 0 || ${Z} === false`),B.assign(me,null);return;case"array":B.elseIf((0,N._)`${fe} === "string" || ${fe} === "number"
              || ${fe} === "boolean" || ${Z} === null`).assign(me,(0,N._)`[${Z}]`)}}}function Y({gen:H,parentData:W,parentDataProperty:ae},B){H.if((0,N._)`${W} !== undefined`,()=>H.assign((0,N._)`${W}[${ae}]`,B))}function X(H,W,ae,B=M.Correct){const Z=B===M.Correct?N.operators.EQ:N.operators.NEQ;let oe;switch(H){case"null":return(0,N._)`${W} ${Z} null`;case"array":oe=(0,N._)`Array.isArray(${W})`;break;case"object":oe=(0,N._)`${W} && typeof ${W} == "object" && !Array.isArray(${W})`;break;case"integer":oe=fe((0,N._)`!(${W} % 1) && !isNaN(${W})`);break;case"number":oe=fe();break;default:return(0,N._)`typeof ${W} ${Z} ${H}`}return B===M.Correct?oe:(0,N.not)(oe);function fe(me=N.nil){return(0,N.and)((0,N._)`typeof ${W} == "number"`,me,ae?(0,N._)`isFinite(${W})`:N.nil)}}A.checkDataType=X;function ee(H,W,ae,B){if(H.length===1)return X(H[0],W,ae,B);let Z;const oe=(0,q.toHash)(H);if(oe.array&&oe.object){const fe=(0,N._)`typeof ${W} != "object"`;Z=oe.null?fe:(0,N._)`!${W} || ${fe}`,delete oe.null,delete oe.array,delete oe.object}else Z=N.nil;oe.number&&delete oe.integer;for(const fe in oe)Z=(0,N.and)(Z,X(fe,W,ae,B));return Z}A.checkDataTypes=ee;const te={message:({schema:H})=>`must be ${H}`,params:({schema:H,schemaValue:W})=>typeof H=="string"?(0,N._)`{type: ${H}}`:(0,N._)`{type: ${W}}`};function z(H){const W=G(H);(0,D.reportError)(W,te)}A.reportTypeError=z;function G(H){const{gen:W,data:ae,schema:B}=H,Z=(0,q.schemaRefOrVal)(H,B,"type");return{gen:W,keyword:"type",data:ae,schema:B.type,schemaCode:Z,schemaValue:Z,parentSchema:B,params:{},it:H}}})(dataType);var defaults={};Object.defineProperty(defaults,"__esModule",{value:!0});defaults.assignDefaults=void 0;const codegen_1$r=codegen,util_1$p=util;function assignDefaults(A,_){const{properties:$,items:D}=A.schema;if(_==="object"&&$)for(const N in $)assignDefault(A,N,$[N].default);else _==="array"&&Array.isArray(D)&&D.forEach((N,q)=>assignDefault(A,q,N.default))}defaults.assignDefaults=assignDefaults;function assignDefault(A,_,$){const{gen:D,compositeRule:N,data:q,opts:M}=A;if($===void 0)return;const L=(0,codegen_1$r._)`${q}${(0,codegen_1$r.getProperty)(_)}`;if(N){(0,util_1$p.checkStrictMode)(A,`default is ignored for: ${L}`);return}let x=(0,codegen_1$r._)`${L} === undefined`;M.useDefaults==="empty"&&(x=(0,codegen_1$r._)`${x} || ${L} === null || ${L} === ""`),D.if(x,(0,codegen_1$r._)`${L} = ${(0,codegen_1$r.stringify)($)}`)}var keyword={},code={};Object.defineProperty(code,"__esModule",{value:!0});code.validateUnion=code.validateArray=code.usePattern=code.callValidateCode=code.schemaProperties=code.allSchemaProperties=code.noPropertyInData=code.propertyInData=code.isOwnProperty=code.hasPropFunc=code.reportMissingProp=code.checkMissingProp=code.checkReportMissingProp=void 0;const codegen_1$q=codegen,util_1$o=util,names_1$5=names$1,util_2$1=util;function checkReportMissingProp(A,_){const{gen:$,data:D,it:N}=A;$.if(noPropertyInData($,D,_,N.opts.ownProperties),()=>{A.setParams({missingProperty:(0,codegen_1$q._)`${_}`},!0),A.error()})}code.checkReportMissingProp=checkReportMissingProp;function checkMissingProp({gen:A,data:_,it:{opts:$}},D,N){return(0,codegen_1$q.or)(...D.map(q=>(0,codegen_1$q.and)(noPropertyInData(A,_,q,$.ownProperties),(0,codegen_1$q._)`${N} = ${q}`)))}code.checkMissingProp=checkMissingProp;function reportMissingProp(A,_){A.setParams({missingProperty:_},!0),A.error()}code.reportMissingProp=reportMissingProp;function hasPropFunc(A){return A.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,codegen_1$q._)`Object.prototype.hasOwnProperty`})}code.hasPropFunc=hasPropFunc;function isOwnProperty(A,_,$){return(0,codegen_1$q._)`${hasPropFunc(A)}.call(${_}, ${$})`}code.isOwnProperty=isOwnProperty;function propertyInData(A,_,$,D){const N=(0,codegen_1$q._)`${_}${(0,codegen_1$q.getProperty)($)} !== undefined`;return D?(0,codegen_1$q._)`${N} && ${isOwnProperty(A,_,$)}`:N}code.propertyInData=propertyInData;function noPropertyInData(A,_,$,D){const N=(0,codegen_1$q._)`${_}${(0,codegen_1$q.getProperty)($)} === undefined`;return D?(0,codegen_1$q.or)(N,(0,codegen_1$q.not)(isOwnProperty(A,_,$))):N}code.noPropertyInData=noPropertyInData;function allSchemaProperties(A){return A?Object.keys(A).filter(_=>_!=="__proto__"):[]}code.allSchemaProperties=allSchemaProperties;function schemaProperties(A,_){return allSchemaProperties(_).filter($=>!(0,util_1$o.alwaysValidSchema)(A,_[$]))}code.schemaProperties=schemaProperties;function callValidateCode({schemaCode:A,data:_,it:{gen:$,topSchemaRef:D,schemaPath:N,errorPath:q},it:M},L,x,F){const U=F?(0,codegen_1$q._)`${A}, ${_}, ${D}${N}`:_,V=[[names_1$5.default.instancePath,(0,codegen_1$q.strConcat)(names_1$5.default.instancePath,q)],[names_1$5.default.parentData,M.parentData],[names_1$5.default.parentDataProperty,M.parentDataProperty],[names_1$5.default.rootData,names_1$5.default.rootData]];M.opts.dynamicRef&&V.push([names_1$5.default.dynamicAnchors,names_1$5.default.dynamicAnchors]);const Q=(0,codegen_1$q._)`${U}, ${$.object(...V)}`;return x!==codegen_1$q.nil?(0,codegen_1$q._)`${L}.call(${x}, ${Q})`:(0,codegen_1$q._)`${L}(${Q})`}code.callValidateCode=callValidateCode;const newRegExp=(0,codegen_1$q._)`new RegExp`;function usePattern({gen:A,it:{opts:_}},$){const D=_.unicodeRegExp?"u":"",{regExp:N}=_.code,q=N($,D);return A.scopeValue("pattern",{key:q.toString(),ref:q,code:(0,codegen_1$q._)`${N.code==="new RegExp"?newRegExp:(0,util_2$1.useFunc)(A,N)}(${$}, ${D})`})}code.usePattern=usePattern;function validateArray(A){const{gen:_,data:$,keyword:D,it:N}=A,q=_.name("valid");if(N.allErrors){const L=_.let("valid",!0);return M(()=>_.assign(L,!1)),L}return _.var(q,!0),M(()=>_.break()),q;function M(L){const x=_.const("len",(0,codegen_1$q._)`${$}.length`);_.forRange("i",0,x,F=>{A.subschema({keyword:D,dataProp:F,dataPropType:util_1$o.Type.Num},q),_.if((0,codegen_1$q.not)(q),L)})}}code.validateArray=validateArray;function validateUnion(A){const{gen:_,schema:$,keyword:D,it:N}=A;if(!Array.isArray($))throw new Error("ajv implementation error");if($.some(x=>(0,util_1$o.alwaysValidSchema)(N,x))&&!N.opts.unevaluated)return;const M=_.let("valid",!1),L=_.name("_valid");_.block(()=>$.forEach((x,F)=>{const U=A.subschema({keyword:D,schemaProp:F,compositeRule:!0},L);_.assign(M,(0,codegen_1$q._)`${M} || ${L}`),A.mergeValidEvaluated(U,L)||_.if((0,codegen_1$q.not)(M))})),A.result(M,()=>A.reset(),()=>A.error(!0))}code.validateUnion=validateUnion;Object.defineProperty(keyword,"__esModule",{value:!0});keyword.validateKeywordUsage=keyword.validSchemaType=keyword.funcKeywordCode=keyword.macroKeywordCode=void 0;const codegen_1$p=codegen,names_1$4=names$1,code_1$9=code,errors_1$1=errors;function macroKeywordCode(A,_){const{gen:$,keyword:D,schema:N,parentSchema:q,it:M}=A,L=_.macro.call(M.self,N,q,M),x=useKeyword($,D,L);M.opts.validateSchema!==!1&&M.self.validateSchema(L,!0);const F=$.name("valid");A.subschema({schema:L,schemaPath:codegen_1$p.nil,errSchemaPath:`${M.errSchemaPath}/${D}`,topSchemaRef:x,compositeRule:!0},F),A.pass(F,()=>A.error(!0))}keyword.macroKeywordCode=macroKeywordCode;function funcKeywordCode(A,_){var $;const{gen:D,keyword:N,schema:q,parentSchema:M,$data:L,it:x}=A;checkAsyncKeyword(x,_);const F=!L&&_.compile?_.compile.call(x.self,q,M,x):_.validate,U=useKeyword(D,N,F),V=D.let("valid");A.block$data(V,Q),A.ok(($=_.valid)!==null&&$!==void 0?$:V);function Q(){if(_.errors===!1)ee(),_.modifying&&modifyData(A),te(()=>A.error());else{const z=_.async?Y():X();_.modifying&&modifyData(A),te(()=>addErrs(A,z))}}function Y(){const z=D.let("ruleErrs",null);return D.try(()=>ee((0,codegen_1$p._)`await `),G=>D.assign(V,!1).if((0,codegen_1$p._)`${G} instanceof ${x.ValidationError}`,()=>D.assign(z,(0,codegen_1$p._)`${G}.errors`),()=>D.throw(G))),z}function X(){const z=(0,codegen_1$p._)`${U}.errors`;return D.assign(z,null),ee(codegen_1$p.nil),z}function ee(z=_.async?(0,codegen_1$p._)`await `:codegen_1$p.nil){const G=x.opts.passContext?names_1$4.default.this:names_1$4.default.self,H=!("compile"in _&&!L||_.schema===!1);D.assign(V,(0,codegen_1$p._)`${z}${(0,code_1$9.callValidateCode)(A,U,G,H)}`,_.modifying)}function te(z){var G;D.if((0,codegen_1$p.not)((G=_.valid)!==null&&G!==void 0?G:V),z)}}keyword.funcKeywordCode=funcKeywordCode;function modifyData(A){const{gen:_,data:$,it:D}=A;_.if(D.parentData,()=>_.assign($,(0,codegen_1$p._)`${D.parentData}[${D.parentDataProperty}]`))}function addErrs(A,_){const{gen:$}=A;$.if((0,codegen_1$p._)`Array.isArray(${_})`,()=>{$.assign(names_1$4.default.vErrors,(0,codegen_1$p._)`${names_1$4.default.vErrors} === null ? ${_} : ${names_1$4.default.vErrors}.concat(${_})`).assign(names_1$4.default.errors,(0,codegen_1$p._)`${names_1$4.default.vErrors}.length`),(0,errors_1$1.extendErrors)(A)},()=>A.error())}function checkAsyncKeyword({schemaEnv:A},_){if(_.async&&!A.$async)throw new Error("async keyword in sync schema")}function useKeyword(A,_,$){if($===void 0)throw new Error(`keyword "${_}" failed to compile`);return A.scopeValue("keyword",typeof $=="function"?{ref:$}:{ref:$,code:(0,codegen_1$p.stringify)($)})}function validSchemaType(A,_,$=!1){return!_.length||_.some(D=>D==="array"?Array.isArray(A):D==="object"?A&&typeof A=="object"&&!Array.isArray(A):typeof A==D||$&&typeof A>"u")}keyword.validSchemaType=validSchemaType;function validateKeywordUsage({schema:A,opts:_,self:$,errSchemaPath:D},N,q){if(Array.isArray(N.keyword)?!N.keyword.includes(q):N.keyword!==q)throw new Error("ajv implementation error");const M=N.dependencies;if(M!=null&&M.some(L=>!Object.prototype.hasOwnProperty.call(A,L)))throw new Error(`parent schema must have dependencies of ${q}: ${M.join(",")}`);if(N.validateSchema&&!N.validateSchema(A[q])){const x=`keyword "${q}" value is invalid at path "${D}": `+$.errorsText(N.validateSchema.errors);if(_.validateSchema==="log")$.logger.error(x);else throw new Error(x)}}keyword.validateKeywordUsage=validateKeywordUsage;var subschema={};Object.defineProperty(subschema,"__esModule",{value:!0});subschema.extendSubschemaMode=subschema.extendSubschemaData=subschema.getSubschema=void 0;const codegen_1$o=codegen,util_1$n=util;function getSubschema(A,{keyword:_,schemaProp:$,schema:D,schemaPath:N,errSchemaPath:q,topSchemaRef:M}){if(_!==void 0&&D!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(_!==void 0){const L=A.schema[_];return $===void 0?{schema:L,schemaPath:(0,codegen_1$o._)`${A.schemaPath}${(0,codegen_1$o.getProperty)(_)}`,errSchemaPath:`${A.errSchemaPath}/${_}`}:{schema:L[$],schemaPath:(0,codegen_1$o._)`${A.schemaPath}${(0,codegen_1$o.getProperty)(_)}${(0,codegen_1$o.getProperty)($)}`,errSchemaPath:`${A.errSchemaPath}/${_}/${(0,util_1$n.escapeFragment)($)}`}}if(D!==void 0){if(N===void 0||q===void 0||M===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:D,schemaPath:N,topSchemaRef:M,errSchemaPath:q}}throw new Error('either "keyword" or "schema" must be passed')}subschema.getSubschema=getSubschema;function extendSubschemaData(A,_,{dataProp:$,dataPropType:D,data:N,dataTypes:q,propertyName:M}){if(N!==void 0&&$!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:L}=_;if($!==void 0){const{errorPath:F,dataPathArr:U,opts:V}=_,Q=L.let("data",(0,codegen_1$o._)`${_.data}${(0,codegen_1$o.getProperty)($)}`,!0);x(Q),A.errorPath=(0,codegen_1$o.str)`${F}${(0,util_1$n.getErrorPath)($,D,V.jsPropertySyntax)}`,A.parentDataProperty=(0,codegen_1$o._)`${$}`,A.dataPathArr=[...U,A.parentDataProperty]}if(N!==void 0){const F=N instanceof codegen_1$o.Name?N:L.let("data",N,!0);x(F),M!==void 0&&(A.propertyName=M)}q&&(A.dataTypes=q);function x(F){A.data=F,A.dataLevel=_.dataLevel+1,A.dataTypes=[],_.definedProperties=new Set,A.parentData=_.data,A.dataNames=[..._.dataNames,F]}}subschema.extendSubschemaData=extendSubschemaData;function extendSubschemaMode(A,{jtdDiscriminator:_,jtdMetadata:$,compositeRule:D,createErrors:N,allErrors:q}){D!==void 0&&(A.compositeRule=D),N!==void 0&&(A.createErrors=N),q!==void 0&&(A.allErrors=q),A.jtdDiscriminator=_,A.jtdMetadata=$}subschema.extendSubschemaMode=extendSubschemaMode;var resolve$1={},fastDeepEqual=function A(_,$){if(_===$)return!0;if(_&&$&&typeof _=="object"&&typeof $=="object"){if(_.constructor!==$.constructor)return!1;var D,N,q;if(Array.isArray(_)){if(D=_.length,D!=$.length)return!1;for(N=D;N--!==0;)if(!A(_[N],$[N]))return!1;return!0}if(_.constructor===RegExp)return _.source===$.source&&_.flags===$.flags;if(_.valueOf!==Object.prototype.valueOf)return _.valueOf()===$.valueOf();if(_.toString!==Object.prototype.toString)return _.toString()===$.toString();if(q=Object.keys(_),D=q.length,D!==Object.keys($).length)return!1;for(N=D;N--!==0;)if(!Object.prototype.hasOwnProperty.call($,q[N]))return!1;for(N=D;N--!==0;){var M=q[N];if(!A(_[M],$[M]))return!1}return!0}return _!==_&&$!==$},jsonSchemaTraverse={exports:{}},traverse$1=jsonSchemaTraverse.exports=function(A,_,$){typeof _=="function"&&($=_,_={}),$=_.cb||$;var D=typeof $=="function"?$:$.pre||function(){},N=$.post||function(){};_traverse(_,D,N,A,"",A)};traverse$1.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};traverse$1.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};traverse$1.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};traverse$1.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function _traverse(A,_,$,D,N,q,M,L,x,F){if(D&&typeof D=="object"&&!Array.isArray(D)){_(D,N,q,M,L,x,F);for(var U in D){var V=D[U];if(Array.isArray(V)){if(U in traverse$1.arrayKeywords)for(var Q=0;Q<V.length;Q++)_traverse(A,_,$,V[Q],N+"/"+U+"/"+Q,q,N,U,D,Q)}else if(U in traverse$1.propsKeywords){if(V&&typeof V=="object")for(var Y in V)_traverse(A,_,$,V[Y],N+"/"+U+"/"+escapeJsonPtr(Y),q,N,U,D,Y)}else(U in traverse$1.keywords||A.allKeys&&!(U in traverse$1.skipKeywords))&&_traverse(A,_,$,V,N+"/"+U,q,N,U,D)}$(D,N,q,M,L,x,F)}}function escapeJsonPtr(A){return A.replace(/~/g,"~0").replace(/\//g,"~1")}var jsonSchemaTraverseExports=jsonSchemaTraverse.exports;Object.defineProperty(resolve$1,"__esModule",{value:!0});resolve$1.getSchemaRefs=resolve$1.resolveUrl=resolve$1.normalizeId=resolve$1._getFullPath=resolve$1.getFullPath=resolve$1.inlineRef=void 0;const util_1$m=util,equal$2=fastDeepEqual,traverse=jsonSchemaTraverseExports,SIMPLE_INLINED=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function inlineRef(A,_=!0){return typeof A=="boolean"?!0:_===!0?!hasRef(A):_?countKeys(A)<=_:!1}resolve$1.inlineRef=inlineRef;const REF_KEYWORDS=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function hasRef(A){for(const _ in A){if(REF_KEYWORDS.has(_))return!0;const $=A[_];if(Array.isArray($)&&$.some(hasRef)||typeof $=="object"&&hasRef($))return!0}return!1}function countKeys(A){let _=0;for(const $ in A){if($==="$ref")return 1/0;if(_++,!SIMPLE_INLINED.has($)&&(typeof A[$]=="object"&&(0,util_1$m.eachItem)(A[$],D=>_+=countKeys(D)),_===1/0))return 1/0}return _}function getFullPath(A,_="",$){$!==!1&&(_=normalizeId(_));const D=A.parse(_);return _getFullPath(A,D)}resolve$1.getFullPath=getFullPath;function _getFullPath(A,_){return A.serialize(_).split("#")[0]+"#"}resolve$1._getFullPath=_getFullPath;const TRAILING_SLASH_HASH=/#\/?$/;function normalizeId(A){return A?A.replace(TRAILING_SLASH_HASH,""):""}resolve$1.normalizeId=normalizeId;function resolveUrl(A,_,$){return $=normalizeId($),A.resolve(_,$)}resolve$1.resolveUrl=resolveUrl;const ANCHOR=/^[a-z_][-a-z0-9._]*$/i;function getSchemaRefs(A,_){if(typeof A=="boolean")return{};const{schemaId:$,uriResolver:D}=this.opts,N=normalizeId(A[$]||_),q={"":N},M=getFullPath(D,N,!1),L={},x=new Set;return traverse(A,{allKeys:!0},(V,Q,Y,X)=>{if(X===void 0)return;const ee=M+Q;let te=q[X];typeof V[$]=="string"&&(te=z.call(this,V[$])),G.call(this,V.$anchor),G.call(this,V.$dynamicAnchor),q[Q]=te;function z(H){const W=this.opts.uriResolver.resolve;if(H=normalizeId(te?W(te,H):H),x.has(H))throw U(H);x.add(H);let ae=this.refs[H];return typeof ae=="string"&&(ae=this.refs[ae]),typeof ae=="object"?F(V,ae.schema,H):H!==normalizeId(ee)&&(H[0]==="#"?(F(V,L[H],H),L[H]=V):this.refs[H]=ee),H}function G(H){if(typeof H=="string"){if(!ANCHOR.test(H))throw new Error(`invalid anchor "${H}"`);z.call(this,`#${H}`)}}}),L;function F(V,Q,Y){if(Q!==void 0&&!equal$2(V,Q))throw U(Y)}function U(V){return new Error(`reference "${V}" resolves to more than one schema`)}}resolve$1.getSchemaRefs=getSchemaRefs;Object.defineProperty(validate,"__esModule",{value:!0});validate.getData=validate.KeywordCxt=validate.validateFunctionCode=void 0;const boolSchema_1=boolSchema,dataType_1$1=dataType,applicability_1=applicability,dataType_2=dataType,defaults_1=defaults,keyword_1=keyword,subschema_1=subschema,codegen_1$n=codegen,names_1$3=names$1,resolve_1$2=resolve$1,util_1$l=util,errors_1=errors;function validateFunctionCode(A){if(isSchemaObj(A)&&(checkKeywords(A),schemaCxtHasRules(A))){topSchemaObjCode(A);return}validateFunction(A,()=>(0,boolSchema_1.topBoolOrEmptySchema)(A))}validate.validateFunctionCode=validateFunctionCode;function validateFunction({gen:A,validateName:_,schema:$,schemaEnv:D,opts:N},q){N.code.es5?A.func(_,(0,codegen_1$n._)`${names_1$3.default.data}, ${names_1$3.default.valCxt}`,D.$async,()=>{A.code((0,codegen_1$n._)`"use strict"; ${funcSourceUrl($,N)}`),destructureValCxtES5(A,N),A.code(q)}):A.func(_,(0,codegen_1$n._)`${names_1$3.default.data}, ${destructureValCxt(N)}`,D.$async,()=>A.code(funcSourceUrl($,N)).code(q))}function destructureValCxt(A){return(0,codegen_1$n._)`{${names_1$3.default.instancePath}="", ${names_1$3.default.parentData}, ${names_1$3.default.parentDataProperty}, ${names_1$3.default.rootData}=${names_1$3.default.data}${A.dynamicRef?(0,codegen_1$n._)`, ${names_1$3.default.dynamicAnchors}={}`:codegen_1$n.nil}}={}`}function destructureValCxtES5(A,_){A.if(names_1$3.default.valCxt,()=>{A.var(names_1$3.default.instancePath,(0,codegen_1$n._)`${names_1$3.default.valCxt}.${names_1$3.default.instancePath}`),A.var(names_1$3.default.parentData,(0,codegen_1$n._)`${names_1$3.default.valCxt}.${names_1$3.default.parentData}`),A.var(names_1$3.default.parentDataProperty,(0,codegen_1$n._)`${names_1$3.default.valCxt}.${names_1$3.default.parentDataProperty}`),A.var(names_1$3.default.rootData,(0,codegen_1$n._)`${names_1$3.default.valCxt}.${names_1$3.default.rootData}`),_.dynamicRef&&A.var(names_1$3.default.dynamicAnchors,(0,codegen_1$n._)`${names_1$3.default.valCxt}.${names_1$3.default.dynamicAnchors}`)},()=>{A.var(names_1$3.default.instancePath,(0,codegen_1$n._)`""`),A.var(names_1$3.default.parentData,(0,codegen_1$n._)`undefined`),A.var(names_1$3.default.parentDataProperty,(0,codegen_1$n._)`undefined`),A.var(names_1$3.default.rootData,names_1$3.default.data),_.dynamicRef&&A.var(names_1$3.default.dynamicAnchors,(0,codegen_1$n._)`{}`)})}function topSchemaObjCode(A){const{schema:_,opts:$,gen:D}=A;validateFunction(A,()=>{$.$comment&&_.$comment&&commentKeyword(A),checkNoDefault(A),D.let(names_1$3.default.vErrors,null),D.let(names_1$3.default.errors,0),$.unevaluated&&resetEvaluated(A),typeAndKeywords(A),returnResults(A)})}function resetEvaluated(A){const{gen:_,validateName:$}=A;A.evaluated=_.const("evaluated",(0,codegen_1$n._)`${$}.evaluated`),_.if((0,codegen_1$n._)`${A.evaluated}.dynamicProps`,()=>_.assign((0,codegen_1$n._)`${A.evaluated}.props`,(0,codegen_1$n._)`undefined`)),_.if((0,codegen_1$n._)`${A.evaluated}.dynamicItems`,()=>_.assign((0,codegen_1$n._)`${A.evaluated}.items`,(0,codegen_1$n._)`undefined`))}function funcSourceUrl(A,_){const $=typeof A=="object"&&A[_.schemaId];return $&&(_.code.source||_.code.process)?(0,codegen_1$n._)`/*# sourceURL=${$} */`:codegen_1$n.nil}function subschemaCode(A,_){if(isSchemaObj(A)&&(checkKeywords(A),schemaCxtHasRules(A))){subSchemaObjCode(A,_);return}(0,boolSchema_1.boolOrEmptySchema)(A,_)}function schemaCxtHasRules({schema:A,self:_}){if(typeof A=="boolean")return!A;for(const $ in A)if(_.RULES.all[$])return!0;return!1}function isSchemaObj(A){return typeof A.schema!="boolean"}function subSchemaObjCode(A,_){const{schema:$,gen:D,opts:N}=A;N.$comment&&$.$comment&&commentKeyword(A),updateContext(A),checkAsyncSchema(A);const q=D.const("_errs",names_1$3.default.errors);typeAndKeywords(A,q),D.var(_,(0,codegen_1$n._)`${q} === ${names_1$3.default.errors}`)}function checkKeywords(A){(0,util_1$l.checkUnknownRules)(A),checkRefsAndKeywords(A)}function typeAndKeywords(A,_){if(A.opts.jtd)return schemaKeywords(A,[],!1,_);const $=(0,dataType_1$1.getSchemaTypes)(A.schema),D=(0,dataType_1$1.coerceAndCheckDataType)(A,$);schemaKeywords(A,$,!D,_)}function checkRefsAndKeywords(A){const{schema:_,errSchemaPath:$,opts:D,self:N}=A;_.$ref&&D.ignoreKeywordsWithRef&&(0,util_1$l.schemaHasRulesButRef)(_,N.RULES)&&N.logger.warn(`$ref: keywords ignored in schema at path "${$}"`)}function checkNoDefault(A){const{schema:_,opts:$}=A;_.default!==void 0&&$.useDefaults&&$.strictSchema&&(0,util_1$l.checkStrictMode)(A,"default is ignored in the schema root")}function updateContext(A){const _=A.schema[A.opts.schemaId];_&&(A.baseId=(0,resolve_1$2.resolveUrl)(A.opts.uriResolver,A.baseId,_))}function checkAsyncSchema(A){if(A.schema.$async&&!A.schemaEnv.$async)throw new Error("async schema in sync schema")}function commentKeyword({gen:A,schemaEnv:_,schema:$,errSchemaPath:D,opts:N}){const q=$.$comment;if(N.$comment===!0)A.code((0,codegen_1$n._)`${names_1$3.default.self}.logger.log(${q})`);else if(typeof N.$comment=="function"){const M=(0,codegen_1$n.str)`${D}/$comment`,L=A.scopeValue("root",{ref:_.root});A.code((0,codegen_1$n._)`${names_1$3.default.self}.opts.$comment(${q}, ${M}, ${L}.schema)`)}}function returnResults(A){const{gen:_,schemaEnv:$,validateName:D,ValidationError:N,opts:q}=A;$.$async?_.if((0,codegen_1$n._)`${names_1$3.default.errors} === 0`,()=>_.return(names_1$3.default.data),()=>_.throw((0,codegen_1$n._)`new ${N}(${names_1$3.default.vErrors})`)):(_.assign((0,codegen_1$n._)`${D}.errors`,names_1$3.default.vErrors),q.unevaluated&&assignEvaluated(A),_.return((0,codegen_1$n._)`${names_1$3.default.errors} === 0`))}function assignEvaluated({gen:A,evaluated:_,props:$,items:D}){$ instanceof codegen_1$n.Name&&A.assign((0,codegen_1$n._)`${_}.props`,$),D instanceof codegen_1$n.Name&&A.assign((0,codegen_1$n._)`${_}.items`,D)}function schemaKeywords(A,_,$,D){const{gen:N,schema:q,data:M,allErrors:L,opts:x,self:F}=A,{RULES:U}=F;if(q.$ref&&(x.ignoreKeywordsWithRef||!(0,util_1$l.schemaHasRulesButRef)(q,U))){N.block(()=>keywordCode(A,"$ref",U.all.$ref.definition));return}x.jtd||checkStrictTypes(A,_),N.block(()=>{for(const Q of U.rules)V(Q);V(U.post)});function V(Q){(0,applicability_1.shouldUseGroup)(q,Q)&&(Q.type?(N.if((0,dataType_2.checkDataType)(Q.type,M,x.strictNumbers)),iterateKeywords(A,Q),_.length===1&&_[0]===Q.type&&$&&(N.else(),(0,dataType_2.reportTypeError)(A)),N.endIf()):iterateKeywords(A,Q),L||N.if((0,codegen_1$n._)`${names_1$3.default.errors} === ${D||0}`))}}function iterateKeywords(A,_){const{gen:$,schema:D,opts:{useDefaults:N}}=A;N&&(0,defaults_1.assignDefaults)(A,_.type),$.block(()=>{for(const q of _.rules)(0,applicability_1.shouldUseRule)(D,q)&&keywordCode(A,q.keyword,q.definition,_.type)})}function checkStrictTypes(A,_){A.schemaEnv.meta||!A.opts.strictTypes||(checkContextTypes(A,_),A.opts.allowUnionTypes||checkMultipleTypes(A,_),checkKeywordTypes(A,A.dataTypes))}function checkContextTypes(A,_){if(_.length){if(!A.dataTypes.length){A.dataTypes=_;return}_.forEach($=>{includesType(A.dataTypes,$)||strictTypesError(A,`type "${$}" not allowed by context "${A.dataTypes.join(",")}"`)}),A.dataTypes=A.dataTypes.filter($=>includesType(_,$))}}function checkMultipleTypes(A,_){_.length>1&&!(_.length===2&&_.includes("null"))&&strictTypesError(A,"use allowUnionTypes to allow union type keyword")}function checkKeywordTypes(A,_){const $=A.self.RULES.all;for(const D in $){const N=$[D];if(typeof N=="object"&&(0,applicability_1.shouldUseRule)(A.schema,N)){const{type:q}=N.definition;q.length&&!q.some(M=>hasApplicableType(_,M))&&strictTypesError(A,`missing type "${q.join(",")}" for keyword "${D}"`)}}}function hasApplicableType(A,_){return A.includes(_)||_==="number"&&A.includes("integer")}function includesType(A,_){return A.includes(_)||_==="integer"&&A.includes("number")}function strictTypesError(A,_){const $=A.schemaEnv.baseId+A.errSchemaPath;_+=` at "${$}" (strictTypes)`,(0,util_1$l.checkStrictMode)(A,_,A.opts.strictTypes)}class KeywordCxt{constructor(_,$,D){if((0,keyword_1.validateKeywordUsage)(_,$,D),this.gen=_.gen,this.allErrors=_.allErrors,this.keyword=D,this.data=_.data,this.schema=_.schema[D],this.$data=$.$data&&_.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,util_1$l.schemaRefOrVal)(_,this.schema,D,this.$data),this.schemaType=$.schemaType,this.parentSchema=_.schema,this.params={},this.it=_,this.def=$,this.$data)this.schemaCode=_.gen.const("vSchema",getData(this.$data,_));else if(this.schemaCode=this.schemaValue,!(0,keyword_1.validSchemaType)(this.schema,$.schemaType,$.allowUndefined))throw new Error(`${D} value must be ${JSON.stringify($.schemaType)}`);("code"in $?$.trackErrors:$.errors!==!1)&&(this.errsCount=_.gen.const("_errs",names_1$3.default.errors))}result(_,$,D){this.failResult((0,codegen_1$n.not)(_),$,D)}failResult(_,$,D){this.gen.if(_),D?D():this.error(),$?(this.gen.else(),$(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(_,$){this.failResult((0,codegen_1$n.not)(_),void 0,$)}fail(_){if(_===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(_),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(_){if(!this.$data)return this.fail(_);const{schemaCode:$}=this;this.fail((0,codegen_1$n._)`${$} !== undefined && (${(0,codegen_1$n.or)(this.invalid$data(),_)})`)}error(_,$,D){if($){this.setParams($),this._error(_,D),this.setParams({});return}this._error(_,D)}_error(_,$){(_?errors_1.reportExtraError:errors_1.reportError)(this,this.def.error,$)}$dataError(){(0,errors_1.reportError)(this,this.def.$dataError||errors_1.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,errors_1.resetErrorsCount)(this.gen,this.errsCount)}ok(_){this.allErrors||this.gen.if(_)}setParams(_,$){$?Object.assign(this.params,_):this.params=_}block$data(_,$,D=codegen_1$n.nil){this.gen.block(()=>{this.check$data(_,D),$()})}check$data(_=codegen_1$n.nil,$=codegen_1$n.nil){if(!this.$data)return;const{gen:D,schemaCode:N,schemaType:q,def:M}=this;D.if((0,codegen_1$n.or)((0,codegen_1$n._)`${N} === undefined`,$)),_!==codegen_1$n.nil&&D.assign(_,!0),(q.length||M.validateSchema)&&(D.elseIf(this.invalid$data()),this.$dataError(),_!==codegen_1$n.nil&&D.assign(_,!1)),D.else()}invalid$data(){const{gen:_,schemaCode:$,schemaType:D,def:N,it:q}=this;return(0,codegen_1$n.or)(M(),L());function M(){if(D.length){if(!($ instanceof codegen_1$n.Name))throw new Error("ajv implementation error");const x=Array.isArray(D)?D:[D];return(0,codegen_1$n._)`${(0,dataType_2.checkDataTypes)(x,$,q.opts.strictNumbers,dataType_2.DataType.Wrong)}`}return codegen_1$n.nil}function L(){if(N.validateSchema){const x=_.scopeValue("validate$data",{ref:N.validateSchema});return(0,codegen_1$n._)`!${x}(${$})`}return codegen_1$n.nil}}subschema(_,$){const D=(0,subschema_1.getSubschema)(this.it,_);(0,subschema_1.extendSubschemaData)(D,this.it,_),(0,subschema_1.extendSubschemaMode)(D,_);const N={...this.it,...D,items:void 0,props:void 0};return subschemaCode(N,$),N}mergeEvaluated(_,$){const{it:D,gen:N}=this;D.opts.unevaluated&&(D.props!==!0&&_.props!==void 0&&(D.props=util_1$l.mergeEvaluated.props(N,_.props,D.props,$)),D.items!==!0&&_.items!==void 0&&(D.items=util_1$l.mergeEvaluated.items(N,_.items,D.items,$)))}mergeValidEvaluated(_,$){const{it:D,gen:N}=this;if(D.opts.unevaluated&&(D.props!==!0||D.items!==!0))return N.if($,()=>this.mergeEvaluated(_,codegen_1$n.Name)),!0}}validate.KeywordCxt=KeywordCxt;function keywordCode(A,_,$,D){const N=new KeywordCxt(A,$,_);"code"in $?$.code(N,D):N.$data&&$.validate?(0,keyword_1.funcKeywordCode)(N,$):"macro"in $?(0,keyword_1.macroKeywordCode)(N,$):($.compile||$.validate)&&(0,keyword_1.funcKeywordCode)(N,$)}const JSON_POINTER=/^\/(?:[^~]|~0|~1)*$/,RELATIVE_JSON_POINTER=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function getData(A,{dataLevel:_,dataNames:$,dataPathArr:D}){let N,q;if(A==="")return names_1$3.default.rootData;if(A[0]==="/"){if(!JSON_POINTER.test(A))throw new Error(`Invalid JSON-pointer: ${A}`);N=A,q=names_1$3.default.rootData}else{const F=RELATIVE_JSON_POINTER.exec(A);if(!F)throw new Error(`Invalid JSON-pointer: ${A}`);const U=+F[1];if(N=F[2],N==="#"){if(U>=_)throw new Error(x("property/index",U));return D[_-U]}if(U>_)throw new Error(x("data",U));if(q=$[_-U],!N)return q}let M=q;const L=N.split("/");for(const F of L)F&&(q=(0,codegen_1$n._)`${q}${(0,codegen_1$n.getProperty)((0,util_1$l.unescapeJsonPointer)(F))}`,M=(0,codegen_1$n._)`${M} && ${q}`);return M;function x(F,U){return`Cannot access ${F} ${U} levels up, current level is ${_}`}}validate.getData=getData;var validation_error={};Object.defineProperty(validation_error,"__esModule",{value:!0});class ValidationError extends Error{constructor(_){super("validation failed"),this.errors=_,this.ajv=this.validation=!0}}validation_error.default=ValidationError;var ref_error={};Object.defineProperty(ref_error,"__esModule",{value:!0});const resolve_1$1=resolve$1;class MissingRefError extends Error{constructor(_,$,D,N){super(N||`can't resolve reference ${D} from id ${$}`),this.missingRef=(0,resolve_1$1.resolveUrl)(_,$,D),this.missingSchema=(0,resolve_1$1.normalizeId)((0,resolve_1$1.getFullPath)(_,this.missingRef))}}ref_error.default=MissingRefError;var compile={};Object.defineProperty(compile,"__esModule",{value:!0});compile.resolveSchema=compile.getCompilingSchema=compile.resolveRef=compile.compileSchema=compile.SchemaEnv=void 0;const codegen_1$m=codegen,validation_error_1=validation_error,names_1$2=names$1,resolve_1=resolve$1,util_1$k=util,validate_1$1=validate;class SchemaEnv{constructor(_){var $;this.refs={},this.dynamicAnchors={};let D;typeof _.schema=="object"&&(D=_.schema),this.schema=_.schema,this.schemaId=_.schemaId,this.root=_.root||this,this.baseId=($=_.baseId)!==null&&$!==void 0?$:(0,resolve_1.normalizeId)(D==null?void 0:D[_.schemaId||"$id"]),this.schemaPath=_.schemaPath,this.localRefs=_.localRefs,this.meta=_.meta,this.$async=D==null?void 0:D.$async,this.refs={}}}compile.SchemaEnv=SchemaEnv;function compileSchema(A){const _=getCompilingSchema.call(this,A);if(_)return _;const $=(0,resolve_1.getFullPath)(this.opts.uriResolver,A.root.baseId),{es5:D,lines:N}=this.opts.code,{ownProperties:q}=this.opts,M=new codegen_1$m.CodeGen(this.scope,{es5:D,lines:N,ownProperties:q});let L;A.$async&&(L=M.scopeValue("Error",{ref:validation_error_1.default,code:(0,codegen_1$m._)`require("ajv/dist/runtime/validation_error").default`}));const x=M.scopeName("validate");A.validateName=x;const F={gen:M,allErrors:this.opts.allErrors,data:names_1$2.default.data,parentData:names_1$2.default.parentData,parentDataProperty:names_1$2.default.parentDataProperty,dataNames:[names_1$2.default.data],dataPathArr:[codegen_1$m.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:M.scopeValue("schema",this.opts.code.source===!0?{ref:A.schema,code:(0,codegen_1$m.stringify)(A.schema)}:{ref:A.schema}),validateName:x,ValidationError:L,schema:A.schema,schemaEnv:A,rootId:$,baseId:A.baseId||$,schemaPath:codegen_1$m.nil,errSchemaPath:A.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,codegen_1$m._)`""`,opts:this.opts,self:this};let U;try{this._compilations.add(A),(0,validate_1$1.validateFunctionCode)(F),M.optimize(this.opts.code.optimize);const V=M.toString();U=`${M.scopeRefs(names_1$2.default.scope)}return ${V}`,this.opts.code.process&&(U=this.opts.code.process(U,A));const Y=new Function(`${names_1$2.default.self}`,`${names_1$2.default.scope}`,U)(this,this.scope.get());if(this.scope.value(x,{ref:Y}),Y.errors=null,Y.schema=A.schema,Y.schemaEnv=A,A.$async&&(Y.$async=!0),this.opts.code.source===!0&&(Y.source={validateName:x,validateCode:V,scopeValues:M._values}),this.opts.unevaluated){const{props:X,items:ee}=F;Y.evaluated={props:X instanceof codegen_1$m.Name?void 0:X,items:ee instanceof codegen_1$m.Name?void 0:ee,dynamicProps:X instanceof codegen_1$m.Name,dynamicItems:ee instanceof codegen_1$m.Name},Y.source&&(Y.source.evaluated=(0,codegen_1$m.stringify)(Y.evaluated))}return A.validate=Y,A}catch(V){throw delete A.validate,delete A.validateName,U&&this.logger.error("Error compiling schema, function code:",U),V}finally{this._compilations.delete(A)}}compile.compileSchema=compileSchema;function resolveRef(A,_,$){var D;$=(0,resolve_1.resolveUrl)(this.opts.uriResolver,_,$);const N=A.refs[$];if(N)return N;let q=resolve.call(this,A,$);if(q===void 0){const M=(D=A.localRefs)===null||D===void 0?void 0:D[$],{schemaId:L}=this.opts;M&&(q=new SchemaEnv({schema:M,schemaId:L,root:A,baseId:_}))}if(q!==void 0)return A.refs[$]=inlineOrCompile.call(this,q)}compile.resolveRef=resolveRef;function inlineOrCompile(A){return(0,resolve_1.inlineRef)(A.schema,this.opts.inlineRefs)?A.schema:A.validate?A:compileSchema.call(this,A)}function getCompilingSchema(A){for(const _ of this._compilations)if(sameSchemaEnv(_,A))return _}compile.getCompilingSchema=getCompilingSchema;function sameSchemaEnv(A,_){return A.schema===_.schema&&A.root===_.root&&A.baseId===_.baseId}function resolve(A,_){let $;for(;typeof($=this.refs[_])=="string";)_=$;return $||this.schemas[_]||resolveSchema.call(this,A,_)}function resolveSchema(A,_){const $=this.opts.uriResolver.parse(_),D=(0,resolve_1._getFullPath)(this.opts.uriResolver,$);let N=(0,resolve_1.getFullPath)(this.opts.uriResolver,A.baseId,void 0);if(Object.keys(A.schema).length>0&&D===N)return getJsonPointer.call(this,$,A);const q=(0,resolve_1.normalizeId)(D),M=this.refs[q]||this.schemas[q];if(typeof M=="string"){const L=resolveSchema.call(this,A,M);return typeof(L==null?void 0:L.schema)!="object"?void 0:getJsonPointer.call(this,$,L)}if(typeof(M==null?void 0:M.schema)=="object"){if(M.validate||compileSchema.call(this,M),q===(0,resolve_1.normalizeId)(_)){const{schema:L}=M,{schemaId:x}=this.opts,F=L[x];return F&&(N=(0,resolve_1.resolveUrl)(this.opts.uriResolver,N,F)),new SchemaEnv({schema:L,schemaId:x,root:A,baseId:N})}return getJsonPointer.call(this,$,M)}}compile.resolveSchema=resolveSchema;const PREVENT_SCOPE_CHANGE=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function getJsonPointer(A,{baseId:_,schema:$,root:D}){var N;if(((N=A.fragment)===null||N===void 0?void 0:N[0])!=="/")return;for(const L of A.fragment.slice(1).split("/")){if(typeof $=="boolean")return;const x=$[(0,util_1$k.unescapeFragment)(L)];if(x===void 0)return;$=x;const F=typeof $=="object"&&$[this.opts.schemaId];!PREVENT_SCOPE_CHANGE.has(L)&&F&&(_=(0,resolve_1.resolveUrl)(this.opts.uriResolver,_,F))}let q;if(typeof $!="boolean"&&$.$ref&&!(0,util_1$k.schemaHasRulesButRef)($,this.RULES)){const L=(0,resolve_1.resolveUrl)(this.opts.uriResolver,_,$.$ref);q=resolveSchema.call(this,D,L)}const{schemaId:M}=this.opts;if(q=q||new SchemaEnv({schema:$,schemaId:M,root:D,baseId:_}),q.schema!==q.root.schema)return q}const $id$1="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description="Meta-schema for $data reference (JSON AnySchema extension proposal)",type$1="object",required$1=["$data"],properties$2={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties$1=!1,require$$9={$id:$id$1,description,type:type$1,required:required$1,properties:properties$2,additionalProperties:additionalProperties$1};var uri$1={},uri_all={exports:{}};/** @license URI.js v4.4.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js */(function(A,_){(function($,D){D(_)})(commonjsGlobal,function($){function D(){for(var re=arguments.length,J=Array(re),se=0;se<re;se++)J[se]=arguments[se];if(J.length>1){J[0]=J[0].slice(0,-1);for(var ue=J.length-1,le=1;le<ue;++le)J[le]=J[le].slice(1,-1);return J[ue]=J[ue].slice(1),J.join("")}else return J[0]}function N(re){return"(?:"+re+")"}function q(re){return re===void 0?"undefined":re===null?"null":Object.prototype.toString.call(re).split(" ").pop().split("]").shift().toLowerCase()}function M(re){return re.toUpperCase()}function L(re){return re!=null?re instanceof Array?re:typeof re.length!="number"||re.split||re.setInterval||re.call?[re]:Array.prototype.slice.call(re):[]}function x(re,J){var se=re;if(J)for(var ue in J)se[ue]=J[ue];return se}function F(re){var J="[A-Za-z]",se="[0-9]",ue=D(se,"[A-Fa-f]"),le=N(N("%[EFef]"+ue+"%"+ue+ue+"%"+ue+ue)+"|"+N("%[89A-Fa-f]"+ue+"%"+ue+ue)+"|"+N("%"+ue+ue)),$e="[\\:\\/\\?\\#\\[\\]\\@]",be="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",Oe=D($e,be),Te=re?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",qe=re?"[\\uE000-\\uF8FF]":"[]",Pe=D(J,se,"[\\-\\.\\_\\~]",Te);N(J+D(J,se,"[\\+\\-\\.]")+"*"),N(N(le+"|"+D(Pe,be,"[\\:]"))+"*");var Ie=N(N("25[0-5]")+"|"+N("2[0-4]"+se)+"|"+N("1"+se+se)+"|"+N("0?[1-9]"+se)+"|0?0?"+se),Me=N(Ie+"\\."+Ie+"\\."+Ie+"\\."+Ie),Ee=N(ue+"{1,4}"),Ae=N(N(Ee+"\\:"+Ee)+"|"+Me),xe=N(N(Ee+"\\:")+"{6}"+Ae),je=N("\\:\\:"+N(Ee+"\\:")+"{5}"+Ae),Ze=N(N(Ee)+"?\\:\\:"+N(Ee+"\\:")+"{4}"+Ae),Je=N(N(N(Ee+"\\:")+"{0,1}"+Ee)+"?\\:\\:"+N(Ee+"\\:")+"{3}"+Ae),Qe=N(N(N(Ee+"\\:")+"{0,2}"+Ee)+"?\\:\\:"+N(Ee+"\\:")+"{2}"+Ae),ut=N(N(N(Ee+"\\:")+"{0,3}"+Ee)+"?\\:\\:"+Ee+"\\:"+Ae),rt=N(N(N(Ee+"\\:")+"{0,4}"+Ee)+"?\\:\\:"+Ae),Be=N(N(N(Ee+"\\:")+"{0,5}"+Ee)+"?\\:\\:"+Ee),Ye=N(N(N(Ee+"\\:")+"{0,6}"+Ee)+"?\\:\\:"),nt=N([xe,je,Ze,Je,Qe,ut,rt,Be,Ye].join("|")),Xe=N(N(Pe+"|"+le)+"+");N("[vV]"+ue+"+\\."+D(Pe,be,"[\\:]")+"+"),N(N(le+"|"+D(Pe,be))+"*");var vt=N(le+"|"+D(Pe,be,"[\\:\\@]"));return N(N(le+"|"+D(Pe,be,"[\\@]"))+"+"),N(N(vt+"|"+D("[\\/\\?]",qe))+"*"),{NOT_SCHEME:new RegExp(D("[^]",J,se,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(D("[^\\%\\:]",Pe,be),"g"),NOT_HOST:new RegExp(D("[^\\%\\[\\]\\:]",Pe,be),"g"),NOT_PATH:new RegExp(D("[^\\%\\/\\:\\@]",Pe,be),"g"),NOT_PATH_NOSCHEME:new RegExp(D("[^\\%\\/\\@]",Pe,be),"g"),NOT_QUERY:new RegExp(D("[^\\%]",Pe,be,"[\\:\\@\\/\\?]",qe),"g"),NOT_FRAGMENT:new RegExp(D("[^\\%]",Pe,be,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(D("[^]",Pe,be),"g"),UNRESERVED:new RegExp(Pe,"g"),OTHER_CHARS:new RegExp(D("[^\\%]",Pe,Oe),"g"),PCT_ENCODED:new RegExp(le,"g"),IPV4ADDRESS:new RegExp("^("+Me+")$"),IPV6ADDRESS:new RegExp("^\\[?("+nt+")"+N(N("\\%25|\\%(?!"+ue+"{2})")+"("+Xe+")")+"?\\]?$")}}var U=F(!1),V=F(!0),Q=function(){function re(J,se){var ue=[],le=!0,$e=!1,be=void 0;try{for(var Oe=J[Symbol.iterator](),Te;!(le=(Te=Oe.next()).done)&&(ue.push(Te.value),!(se&&ue.length===se));le=!0);}catch(qe){$e=!0,be=qe}finally{try{!le&&Oe.return&&Oe.return()}finally{if($e)throw be}}return ue}return function(J,se){if(Array.isArray(J))return J;if(Symbol.iterator in Object(J))return re(J,se);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),Y=function(re){if(Array.isArray(re)){for(var J=0,se=Array(re.length);J<re.length;J++)se[J]=re[J];return se}else return Array.from(re)},X=2147483647,ee=36,te=1,z=26,G=38,H=700,W=72,ae=128,B="-",Z=/^xn--/,oe=/[^\0-\x7E]/,fe=/[\x2E\u3002\uFF0E\uFF61]/g,me={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},_e=ee-te,ye=Math.floor,Re=String.fromCharCode;function ke(re){throw new RangeError(me[re])}function De(re,J){for(var se=[],ue=re.length;ue--;)se[ue]=J(re[ue]);return se}function Le(re,J){var se=re.split("@"),ue="";se.length>1&&(ue=se[0]+"@",re=se[1]),re=re.replace(fe,".");var le=re.split("."),$e=De(le,J).join(".");return ue+$e}function Ve(re){for(var J=[],se=0,ue=re.length;se<ue;){var le=re.charCodeAt(se++);if(le>=55296&&le<=56319&&se<ue){var $e=re.charCodeAt(se++);($e&64512)==56320?J.push(((le&1023)<<10)+($e&1023)+65536):(J.push(le),se--)}else J.push(le)}return J}var Ke=function(J){return String.fromCodePoint.apply(String,Y(J))},we=function(J){return J-48<10?J-22:J-65<26?J-65:J-97<26?J-97:ee},pe=function(J,se){return J+22+75*(J<26)-((se!=0)<<5)},ie=function(J,se,ue){var le=0;for(J=ue?ye(J/H):J>>1,J+=ye(J/se);J>_e*z>>1;le+=ee)J=ye(J/_e);return ye(le+(_e+1)*J/(J+G))},he=function(J){var se=[],ue=J.length,le=0,$e=ae,be=W,Oe=J.lastIndexOf(B);Oe<0&&(Oe=0);for(var Te=0;Te<Oe;++Te)J.charCodeAt(Te)>=128&&ke("not-basic"),se.push(J.charCodeAt(Te));for(var qe=Oe>0?Oe+1:0;qe<ue;){for(var Pe=le,Ie=1,Me=ee;;Me+=ee){qe>=ue&&ke("invalid-input");var Ee=we(J.charCodeAt(qe++));(Ee>=ee||Ee>ye((X-le)/Ie))&&ke("overflow"),le+=Ee*Ie;var Ae=Me<=be?te:Me>=be+z?z:Me-be;if(Ee<Ae)break;var xe=ee-Ae;Ie>ye(X/xe)&&ke("overflow"),Ie*=xe}var je=se.length+1;be=ie(le-Pe,je,Pe==0),ye(le/je)>X-$e&&ke("overflow"),$e+=ye(le/je),le%=je,se.splice(le++,0,$e)}return String.fromCodePoint.apply(String,se)},ce=function(J){var se=[];J=Ve(J);var ue=J.length,le=ae,$e=0,be=W,Oe=!0,Te=!1,qe=void 0;try{for(var Pe=J[Symbol.iterator](),Ie;!(Oe=(Ie=Pe.next()).done);Oe=!0){var Me=Ie.value;Me<128&&se.push(Re(Me))}}catch(yt){Te=!0,qe=yt}finally{try{!Oe&&Pe.return&&Pe.return()}finally{if(Te)throw qe}}var Ee=se.length,Ae=Ee;for(Ee&&se.push(B);Ae<ue;){var xe=X,je=!0,Ze=!1,Je=void 0;try{for(var Qe=J[Symbol.iterator](),ut;!(je=(ut=Qe.next()).done);je=!0){var rt=ut.value;rt>=le&&rt<xe&&(xe=rt)}}catch(yt){Ze=!0,Je=yt}finally{try{!je&&Qe.return&&Qe.return()}finally{if(Ze)throw Je}}var Be=Ae+1;xe-le>ye((X-$e)/Be)&&ke("overflow"),$e+=(xe-le)*Be,le=xe;var Ye=!0,nt=!1,Xe=void 0;try{for(var vt=J[Symbol.iterator](),jt;!(Ye=(jt=vt.next()).done);Ye=!0){var Nt=jt.value;if(Nt<le&&++$e>X&&ke("overflow"),Nt==le){for(var bt=$e,wt=ee;;wt+=ee){var Et=wt<=be?te:wt>=be+z?z:wt-be;if(bt<Et)break;var Dt=bt-Et,qt=ee-Et;se.push(Re(pe(Et+Dt%qt,0))),bt=ye(Dt/qt)}se.push(Re(pe(bt,0))),be=ie($e,Be,Ae==Ee),$e=0,++Ae}}}catch(yt){nt=!0,Xe=yt}finally{try{!Ye&&vt.return&&vt.return()}finally{if(nt)throw Xe}}++$e,++le}return se.join("")},K=function(J){return Le(J,function(se){return Z.test(se)?he(se.slice(4).toLowerCase()):se})},ne=function(J){return Le(J,function(se){return oe.test(se)?"xn--"+ce(se):se})},de={version:"2.1.0",ucs2:{decode:Ve,encode:Ke},decode:he,encode:ce,toASCII:ne,toUnicode:K},ge={};function ve(re){var J=re.charCodeAt(0),se=void 0;return J<16?se="%0"+J.toString(16).toUpperCase():J<128?se="%"+J.toString(16).toUpperCase():J<2048?se="%"+(J>>6|192).toString(16).toUpperCase()+"%"+(J&63|128).toString(16).toUpperCase():se="%"+(J>>12|224).toString(16).toUpperCase()+"%"+(J>>6&63|128).toString(16).toUpperCase()+"%"+(J&63|128).toString(16).toUpperCase(),se}function Se(re){for(var J="",se=0,ue=re.length;se<ue;){var le=parseInt(re.substr(se+1,2),16);if(le<128)J+=String.fromCharCode(le),se+=3;else if(le>=194&&le<224){if(ue-se>=6){var $e=parseInt(re.substr(se+4,2),16);J+=String.fromCharCode((le&31)<<6|$e&63)}else J+=re.substr(se,6);se+=6}else if(le>=224){if(ue-se>=9){var be=parseInt(re.substr(se+4,2),16),Oe=parseInt(re.substr(se+7,2),16);J+=String.fromCharCode((le&15)<<12|(be&63)<<6|Oe&63)}else J+=re.substr(se,9);se+=9}else J+=re.substr(se,3),se+=3}return J}function Ce(re,J){function se(ue){var le=Se(ue);return le.match(J.UNRESERVED)?le:ue}return re.scheme&&(re.scheme=String(re.scheme).replace(J.PCT_ENCODED,se).toLowerCase().replace(J.NOT_SCHEME,"")),re.userinfo!==void 0&&(re.userinfo=String(re.userinfo).replace(J.PCT_ENCODED,se).replace(J.NOT_USERINFO,ve).replace(J.PCT_ENCODED,M)),re.host!==void 0&&(re.host=String(re.host).replace(J.PCT_ENCODED,se).toLowerCase().replace(J.NOT_HOST,ve).replace(J.PCT_ENCODED,M)),re.path!==void 0&&(re.path=String(re.path).replace(J.PCT_ENCODED,se).replace(re.scheme?J.NOT_PATH:J.NOT_PATH_NOSCHEME,ve).replace(J.PCT_ENCODED,M)),re.query!==void 0&&(re.query=String(re.query).replace(J.PCT_ENCODED,se).replace(J.NOT_QUERY,ve).replace(J.PCT_ENCODED,M)),re.fragment!==void 0&&(re.fragment=String(re.fragment).replace(J.PCT_ENCODED,se).replace(J.NOT_FRAGMENT,ve).replace(J.PCT_ENCODED,M)),re}function Ne(re){return re.replace(/^0*(.*)/,"$1")||"0"}function ze(re,J){var se=re.match(J.IPV4ADDRESS)||[],ue=Q(se,2),le=ue[1];return le?le.split(".").map(Ne).join("."):re}function st(re,J){var se=re.match(J.IPV6ADDRESS)||[],ue=Q(se,3),le=ue[1],$e=ue[2];if(le){for(var be=le.toLowerCase().split("::").reverse(),Oe=Q(be,2),Te=Oe[0],qe=Oe[1],Pe=qe?qe.split(":").map(Ne):[],Ie=Te.split(":").map(Ne),Me=J.IPV4ADDRESS.test(Ie[Ie.length-1]),Ee=Me?7:8,Ae=Ie.length-Ee,xe=Array(Ee),je=0;je<Ee;++je)xe[je]=Pe[je]||Ie[Ae+je]||"";Me&&(xe[Ee-1]=ze(xe[Ee-1],J));var Ze=xe.reduce(function(Be,Ye,nt){if(!Ye||Ye==="0"){var Xe=Be[Be.length-1];Xe&&Xe.index+Xe.length===nt?Xe.length++:Be.push({index:nt,length:1})}return Be},[]),Je=Ze.sort(function(Be,Ye){return Ye.length-Be.length})[0],Qe=void 0;if(Je&&Je.length>1){var ut=xe.slice(0,Je.index),rt=xe.slice(Je.index+Je.length);Qe=ut.join(":")+"::"+rt.join(":")}else Qe=xe.join(":");return $e&&(Qe+="%"+$e),Qe}else return re}var dt=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,ht="".match(/(){0}/)[1]===void 0;function Ue(re){var J=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},se={},ue=J.iri!==!1?V:U;J.reference==="suffix"&&(re=(J.scheme?J.scheme+":":"")+"//"+re);var le=re.match(dt);if(le){ht?(se.scheme=le[1],se.userinfo=le[3],se.host=le[4],se.port=parseInt(le[5],10),se.path=le[6]||"",se.query=le[7],se.fragment=le[8],isNaN(se.port)&&(se.port=le[5])):(se.scheme=le[1]||void 0,se.userinfo=re.indexOf("@")!==-1?le[3]:void 0,se.host=re.indexOf("//")!==-1?le[4]:void 0,se.port=parseInt(le[5],10),se.path=le[6]||"",se.query=re.indexOf("?")!==-1?le[7]:void 0,se.fragment=re.indexOf("#")!==-1?le[8]:void 0,isNaN(se.port)&&(se.port=re.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?le[4]:void 0)),se.host&&(se.host=st(ze(se.host,ue),ue)),se.scheme===void 0&&se.userinfo===void 0&&se.host===void 0&&se.port===void 0&&!se.path&&se.query===void 0?se.reference="same-document":se.scheme===void 0?se.reference="relative":se.fragment===void 0?se.reference="absolute":se.reference="uri",J.reference&&J.reference!=="suffix"&&J.reference!==se.reference&&(se.error=se.error||"URI is not a "+J.reference+" reference.");var $e=ge[(J.scheme||se.scheme||"").toLowerCase()];if(!J.unicodeSupport&&(!$e||!$e.unicodeSupport)){if(se.host&&(J.domainHost||$e&&$e.domainHost))try{se.host=de.toASCII(se.host.replace(ue.PCT_ENCODED,Se).toLowerCase())}catch(be){se.error=se.error||"Host's domain name can not be converted to ASCII via punycode: "+be}Ce(se,U)}else Ce(se,ue);$e&&$e.parse&&$e.parse(se,J)}else se.error=se.error||"URI can not be parsed.";return se}function ft(re,J){var se=J.iri!==!1?V:U,ue=[];return re.userinfo!==void 0&&(ue.push(re.userinfo),ue.push("@")),re.host!==void 0&&ue.push(st(ze(String(re.host),se),se).replace(se.IPV6ADDRESS,function(le,$e,be){return"["+$e+(be?"%25"+be:"")+"]"})),(typeof re.port=="number"||typeof re.port=="string")&&(ue.push(":"),ue.push(String(re.port))),ue.length?ue.join(""):void 0}var it=/^\.\.?\//,ot=/^\/\.(\/|$)/,at=/^\/\.\.(\/|$)/,pt=/^\/?(?:.|\n)*?(?=\/|$)/;function He(re){for(var J=[];re.length;)if(re.match(it))re=re.replace(it,"");else if(re.match(ot))re=re.replace(ot,"/");else if(re.match(at))re=re.replace(at,"/"),J.pop();else if(re==="."||re==="..")re="";else{var se=re.match(pt);if(se){var ue=se[0];re=re.slice(ue.length),J.push(ue)}else throw new Error("Unexpected dot segment condition")}return J.join("")}function Fe(re){var J=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},se=J.iri?V:U,ue=[],le=ge[(J.scheme||re.scheme||"").toLowerCase()];if(le&&le.serialize&&le.serialize(re,J),re.host&&!se.IPV6ADDRESS.test(re.host)){if(J.domainHost||le&&le.domainHost)try{re.host=J.iri?de.toUnicode(re.host):de.toASCII(re.host.replace(se.PCT_ENCODED,Se).toLowerCase())}catch(Oe){re.error=re.error||"Host's domain name can not be converted to "+(J.iri?"Unicode":"ASCII")+" via punycode: "+Oe}}Ce(re,se),J.reference!=="suffix"&&re.scheme&&(ue.push(re.scheme),ue.push(":"));var $e=ft(re,J);if($e!==void 0&&(J.reference!=="suffix"&&ue.push("//"),ue.push($e),re.path&&re.path.charAt(0)!=="/"&&ue.push("/")),re.path!==void 0){var be=re.path;!J.absolutePath&&(!le||!le.absolutePath)&&(be=He(be)),$e===void 0&&(be=be.replace(/^\/\//,"/%2F")),ue.push(be)}return re.query!==void 0&&(ue.push("?"),ue.push(re.query)),re.fragment!==void 0&&(ue.push("#"),ue.push(re.fragment)),ue.join("")}function ct(re,J){var se=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},ue=arguments[3],le={};return ue||(re=Ue(Fe(re,se),se),J=Ue(Fe(J,se),se)),se=se||{},!se.tolerant&&J.scheme?(le.scheme=J.scheme,le.userinfo=J.userinfo,le.host=J.host,le.port=J.port,le.path=He(J.path||""),le.query=J.query):(J.userinfo!==void 0||J.host!==void 0||J.port!==void 0?(le.userinfo=J.userinfo,le.host=J.host,le.port=J.port,le.path=He(J.path||""),le.query=J.query):(J.path?(J.path.charAt(0)==="/"?le.path=He(J.path):((re.userinfo!==void 0||re.host!==void 0||re.port!==void 0)&&!re.path?le.path="/"+J.path:re.path?le.path=re.path.slice(0,re.path.lastIndexOf("/")+1)+J.path:le.path=J.path,le.path=He(le.path)),le.query=J.query):(le.path=re.path,J.query!==void 0?le.query=J.query:le.query=re.query),le.userinfo=re.userinfo,le.host=re.host,le.port=re.port),le.scheme=re.scheme),le.fragment=J.fragment,le}function mt(re,J,se){var ue=x({scheme:"null"},se);return Fe(ct(Ue(re,ue),Ue(J,ue),ue,!0),ue)}function et(re,J){return typeof re=="string"?re=Fe(Ue(re,J),J):q(re)==="object"&&(re=Ue(Fe(re,J),J)),re}function _t(re,J,se){return typeof re=="string"?re=Fe(Ue(re,se),se):q(re)==="object"&&(re=Fe(re,se)),typeof J=="string"?J=Fe(Ue(J,se),se):q(J)==="object"&&(J=Fe(J,se)),re===J}function $t(re,J){return re&&re.toString().replace(!J||!J.iri?U.ESCAPE:V.ESCAPE,ve)}function Ge(re,J){return re&&re.toString().replace(!J||!J.iri?U.PCT_ENCODED:V.PCT_ENCODED,Se)}var tt={scheme:"http",domainHost:!0,parse:function(J,se){return J.host||(J.error=J.error||"HTTP URIs must have a host."),J},serialize:function(J,se){var ue=String(J.scheme).toLowerCase()==="https";return(J.port===(ue?443:80)||J.port==="")&&(J.port=void 0),J.path||(J.path="/"),J}},kt={scheme:"https",domainHost:tt.domainHost,parse:tt.parse,serialize:tt.serialize};function Pt(re){return typeof re.secure=="boolean"?re.secure:String(re.scheme).toLowerCase()==="wss"}var gt={scheme:"ws",domainHost:!0,parse:function(J,se){var ue=J;return ue.secure=Pt(ue),ue.resourceName=(ue.path||"/")+(ue.query?"?"+ue.query:""),ue.path=void 0,ue.query=void 0,ue},serialize:function(J,se){if((J.port===(Pt(J)?443:80)||J.port==="")&&(J.port=void 0),typeof J.secure=="boolean"&&(J.scheme=J.secure?"wss":"ws",J.secure=void 0),J.resourceName){var ue=J.resourceName.split("?"),le=Q(ue,2),$e=le[0],be=le[1];J.path=$e&&$e!=="/"?$e:void 0,J.query=be,J.resourceName=void 0}return J.fragment=void 0,J}},Ct={scheme:"wss",domainHost:gt.domainHost,parse:gt.parse,serialize:gt.serialize},Mt={},Rt="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",We="[0-9A-Fa-f]",Lt=N(N("%[EFef]"+We+"%"+We+We+"%"+We+We)+"|"+N("%[89A-Fa-f]"+We+"%"+We+We)+"|"+N("%"+We+We)),xt="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",Ft="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",Ut=D(Ft,'[\\"\\\\]'),Vt="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",Gt=new RegExp(Rt,"g"),lt=new RegExp(Lt,"g"),Bt=new RegExp(D("[^]",xt,"[\\.]",'[\\"]',Ut),"g"),Ot=new RegExp(D("[^]",Rt,Vt),"g"),Kt=Ot;function St(re){var J=Se(re);return J.match(Gt)?J:re}var It={scheme:"mailto",parse:function(J,se){var ue=J,le=ue.to=ue.path?ue.path.split(","):[];if(ue.path=void 0,ue.query){for(var $e=!1,be={},Oe=ue.query.split("&"),Te=0,qe=Oe.length;Te<qe;++Te){var Pe=Oe[Te].split("=");switch(Pe[0]){case"to":for(var Ie=Pe[1].split(","),Me=0,Ee=Ie.length;Me<Ee;++Me)le.push(Ie[Me]);break;case"subject":ue.subject=Ge(Pe[1],se);break;case"body":ue.body=Ge(Pe[1],se);break;default:$e=!0,be[Ge(Pe[0],se)]=Ge(Pe[1],se);break}}$e&&(ue.headers=be)}ue.query=void 0;for(var Ae=0,xe=le.length;Ae<xe;++Ae){var je=le[Ae].split("@");if(je[0]=Ge(je[0]),se.unicodeSupport)je[1]=Ge(je[1],se).toLowerCase();else try{je[1]=de.toASCII(Ge(je[1],se).toLowerCase())}catch(Ze){ue.error=ue.error||"Email address's domain name can not be converted to ASCII via punycode: "+Ze}le[Ae]=je.join("@")}return ue},serialize:function(J,se){var ue=J,le=L(J.to);if(le){for(var $e=0,be=le.length;$e<be;++$e){var Oe=String(le[$e]),Te=Oe.lastIndexOf("@"),qe=Oe.slice(0,Te).replace(lt,St).replace(lt,M).replace(Bt,ve),Pe=Oe.slice(Te+1);try{Pe=se.iri?de.toUnicode(Pe):de.toASCII(Ge(Pe,se).toLowerCase())}catch(Ae){ue.error=ue.error||"Email address's domain name can not be converted to "+(se.iri?"Unicode":"ASCII")+" via punycode: "+Ae}le[$e]=qe+"@"+Pe}ue.path=le.join(",")}var Ie=J.headers=J.headers||{};J.subject&&(Ie.subject=J.subject),J.body&&(Ie.body=J.body);var Me=[];for(var Ee in Ie)Ie[Ee]!==Mt[Ee]&&Me.push(Ee.replace(lt,St).replace(lt,M).replace(Ot,ve)+"="+Ie[Ee].replace(lt,St).replace(lt,M).replace(Kt,ve));return Me.length&&(ue.query=Me.join("&")),ue}},zt=/^([^\:]+)\:(.*)/,Tt={scheme:"urn",parse:function(J,se){var ue=J.path&&J.path.match(zt),le=J;if(ue){var $e=se.scheme||le.scheme||"urn",be=ue[1].toLowerCase(),Oe=ue[2],Te=$e+":"+(se.nid||be),qe=ge[Te];le.nid=be,le.nss=Oe,le.path=void 0,qe&&(le=qe.parse(le,se))}else le.error=le.error||"URN can not be parsed.";return le},serialize:function(J,se){var ue=se.scheme||J.scheme||"urn",le=J.nid,$e=ue+":"+(se.nid||le),be=ge[$e];be&&(J=be.serialize(J,se));var Oe=J,Te=J.nss;return Oe.path=(le||se.nid)+":"+Te,Oe}},Ht=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,At={scheme:"urn:uuid",parse:function(J,se){var ue=J;return ue.uuid=ue.nss,ue.nss=void 0,!se.tolerant&&(!ue.uuid||!ue.uuid.match(Ht))&&(ue.error=ue.error||"UUID is not valid."),ue},serialize:function(J,se){var ue=J;return ue.nss=(J.uuid||"").toLowerCase(),ue}};ge[tt.scheme]=tt,ge[kt.scheme]=kt,ge[gt.scheme]=gt,ge[Ct.scheme]=Ct,ge[It.scheme]=It,ge[Tt.scheme]=Tt,ge[At.scheme]=At,$.SCHEMES=ge,$.pctEncChar=ve,$.pctDecChars=Se,$.parse=Ue,$.removeDotSegments=He,$.serialize=Fe,$.resolveComponents=ct,$.resolve=mt,$.normalize=et,$.equal=_t,$.escapeComponent=$t,$.unescapeComponent=Ge,Object.defineProperty($,"__esModule",{value:!0})})})(uri_all,uri_all.exports);var uri_allExports=uri_all.exports;Object.defineProperty(uri$1,"__esModule",{value:!0});const uri=uri_allExports;uri.code='require("ajv/dist/runtime/uri").default';uri$1.default=uri;(function(A){Object.defineProperty(A,"__esModule",{value:!0}),A.CodeGen=A.Name=A.nil=A.stringify=A.str=A._=A.KeywordCxt=void 0;var _=validate;Object.defineProperty(A,"KeywordCxt",{enumerable:!0,get:function(){return _.KeywordCxt}});var $=codegen;Object.defineProperty(A,"_",{enumerable:!0,get:function(){return $._}}),Object.defineProperty(A,"str",{enumerable:!0,get:function(){return $.str}}),Object.defineProperty(A,"stringify",{enumerable:!0,get:function(){return $.stringify}}),Object.defineProperty(A,"nil",{enumerable:!0,get:function(){return $.nil}}),Object.defineProperty(A,"Name",{enumerable:!0,get:function(){return $.Name}}),Object.defineProperty(A,"CodeGen",{enumerable:!0,get:function(){return $.CodeGen}});const D=validation_error,N=ref_error,q=rules,M=compile,L=codegen,x=resolve$1,F=dataType,U=util,V=require$$9,Q=uri$1,Y=(pe,ie)=>new RegExp(pe,ie);Y.code="new RegExp";const X=["removeAdditional","useDefaults","coerceTypes"],ee=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),te={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},z={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},G=200;function H(pe){var ie,he,ce,K,ne,de,ge,ve,Se,Ce,Ne,ze,st,dt,ht,Ue,ft,it,ot,at,pt,He,Fe,ct,mt;const et=pe.strict,_t=(ie=pe.code)===null||ie===void 0?void 0:ie.optimize,$t=_t===!0||_t===void 0?1:_t||0,Ge=(ce=(he=pe.code)===null||he===void 0?void 0:he.regExp)!==null&&ce!==void 0?ce:Y,tt=(K=pe.uriResolver)!==null&&K!==void 0?K:Q.default;return{strictSchema:(de=(ne=pe.strictSchema)!==null&&ne!==void 0?ne:et)!==null&&de!==void 0?de:!0,strictNumbers:(ve=(ge=pe.strictNumbers)!==null&&ge!==void 0?ge:et)!==null&&ve!==void 0?ve:!0,strictTypes:(Ce=(Se=pe.strictTypes)!==null&&Se!==void 0?Se:et)!==null&&Ce!==void 0?Ce:"log",strictTuples:(ze=(Ne=pe.strictTuples)!==null&&Ne!==void 0?Ne:et)!==null&&ze!==void 0?ze:"log",strictRequired:(dt=(st=pe.strictRequired)!==null&&st!==void 0?st:et)!==null&&dt!==void 0?dt:!1,code:pe.code?{...pe.code,optimize:$t,regExp:Ge}:{optimize:$t,regExp:Ge},loopRequired:(ht=pe.loopRequired)!==null&&ht!==void 0?ht:G,loopEnum:(Ue=pe.loopEnum)!==null&&Ue!==void 0?Ue:G,meta:(ft=pe.meta)!==null&&ft!==void 0?ft:!0,messages:(it=pe.messages)!==null&&it!==void 0?it:!0,inlineRefs:(ot=pe.inlineRefs)!==null&&ot!==void 0?ot:!0,schemaId:(at=pe.schemaId)!==null&&at!==void 0?at:"$id",addUsedSchema:(pt=pe.addUsedSchema)!==null&&pt!==void 0?pt:!0,validateSchema:(He=pe.validateSchema)!==null&&He!==void 0?He:!0,validateFormats:(Fe=pe.validateFormats)!==null&&Fe!==void 0?Fe:!0,unicodeRegExp:(ct=pe.unicodeRegExp)!==null&&ct!==void 0?ct:!0,int32range:(mt=pe.int32range)!==null&&mt!==void 0?mt:!0,uriResolver:tt}}class W{constructor(ie={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,ie=this.opts={...ie,...H(ie)};const{es5:he,lines:ce}=this.opts.code;this.scope=new L.ValueScope({scope:{},prefixes:ee,es5:he,lines:ce}),this.logger=ye(ie.logger);const K=ie.validateFormats;ie.validateFormats=!1,this.RULES=(0,q.getRules)(),ae.call(this,te,ie,"NOT SUPPORTED"),ae.call(this,z,ie,"DEPRECATED","warn"),this._metaOpts=me.call(this),ie.formats&&oe.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),ie.keywords&&fe.call(this,ie.keywords),typeof ie.meta=="object"&&this.addMetaSchema(ie.meta),Z.call(this),ie.validateFormats=K}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:ie,meta:he,schemaId:ce}=this.opts;let K=V;ce==="id"&&(K={...V},K.id=K.$id,delete K.$id),he&&ie&&this.addMetaSchema(K,K[ce],!1)}defaultMeta(){const{meta:ie,schemaId:he}=this.opts;return this.opts.defaultMeta=typeof ie=="object"?ie[he]||ie:void 0}validate(ie,he){let ce;if(typeof ie=="string"){if(ce=this.getSchema(ie),!ce)throw new Error(`no schema with key or ref "${ie}"`)}else ce=this.compile(ie);const K=ce(he);return"$async"in ce||(this.errors=ce.errors),K}compile(ie,he){const ce=this._addSchema(ie,he);return ce.validate||this._compileSchemaEnv(ce)}compileAsync(ie,he){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");const{loadSchema:ce}=this.opts;return K.call(this,ie,he);async function K(Ce,Ne){await ne.call(this,Ce.$schema);const ze=this._addSchema(Ce,Ne);return ze.validate||de.call(this,ze)}async function ne(Ce){Ce&&!this.getSchema(Ce)&&await K.call(this,{$ref:Ce},!0)}async function de(Ce){try{return this._compileSchemaEnv(Ce)}catch(Ne){if(!(Ne instanceof N.default))throw Ne;return ge.call(this,Ne),await ve.call(this,Ne.missingSchema),de.call(this,Ce)}}function ge({missingSchema:Ce,missingRef:Ne}){if(this.refs[Ce])throw new Error(`AnySchema ${Ce} is loaded but ${Ne} cannot be resolved`)}async function ve(Ce){const Ne=await Se.call(this,Ce);this.refs[Ce]||await ne.call(this,Ne.$schema),this.refs[Ce]||this.addSchema(Ne,Ce,he)}async function Se(Ce){const Ne=this._loading[Ce];if(Ne)return Ne;try{return await(this._loading[Ce]=ce(Ce))}finally{delete this._loading[Ce]}}}addSchema(ie,he,ce,K=this.opts.validateSchema){if(Array.isArray(ie)){for(const de of ie)this.addSchema(de,void 0,ce,K);return this}let ne;if(typeof ie=="object"){const{schemaId:de}=this.opts;if(ne=ie[de],ne!==void 0&&typeof ne!="string")throw new Error(`schema ${de} must be string`)}return he=(0,x.normalizeId)(he||ne),this._checkUnique(he),this.schemas[he]=this._addSchema(ie,ce,he,K,!0),this}addMetaSchema(ie,he,ce=this.opts.validateSchema){return this.addSchema(ie,he,!0,ce),this}validateSchema(ie,he){if(typeof ie=="boolean")return!0;let ce;if(ce=ie.$schema,ce!==void 0&&typeof ce!="string")throw new Error("$schema must be a string");if(ce=ce||this.opts.defaultMeta||this.defaultMeta(),!ce)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const K=this.validate(ce,ie);if(!K&&he){const ne="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(ne);else throw new Error(ne)}return K}getSchema(ie){let he;for(;typeof(he=B.call(this,ie))=="string";)ie=he;if(he===void 0){const{schemaId:ce}=this.opts,K=new M.SchemaEnv({schema:{},schemaId:ce});if(he=M.resolveSchema.call(this,K,ie),!he)return;this.refs[ie]=he}return he.validate||this._compileSchemaEnv(he)}removeSchema(ie){if(ie instanceof RegExp)return this._removeAllSchemas(this.schemas,ie),this._removeAllSchemas(this.refs,ie),this;switch(typeof ie){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const he=B.call(this,ie);return typeof he=="object"&&this._cache.delete(he.schema),delete this.schemas[ie],delete this.refs[ie],this}case"object":{const he=ie;this._cache.delete(he);let ce=ie[this.opts.schemaId];return ce&&(ce=(0,x.normalizeId)(ce),delete this.schemas[ce],delete this.refs[ce]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(ie){for(const he of ie)this.addKeyword(he);return this}addKeyword(ie,he){let ce;if(typeof ie=="string")ce=ie,typeof he=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),he.keyword=ce);else if(typeof ie=="object"&&he===void 0){if(he=ie,ce=he.keyword,Array.isArray(ce)&&!ce.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(ke.call(this,ce,he),!he)return(0,U.eachItem)(ce,ne=>De.call(this,ne)),this;Ve.call(this,he);const K={...he,type:(0,F.getJSONTypes)(he.type),schemaType:(0,F.getJSONTypes)(he.schemaType)};return(0,U.eachItem)(ce,K.type.length===0?ne=>De.call(this,ne,K):ne=>K.type.forEach(de=>De.call(this,ne,K,de))),this}getKeyword(ie){const he=this.RULES.all[ie];return typeof he=="object"?he.definition:!!he}removeKeyword(ie){const{RULES:he}=this;delete he.keywords[ie],delete he.all[ie];for(const ce of he.rules){const K=ce.rules.findIndex(ne=>ne.keyword===ie);K>=0&&ce.rules.splice(K,1)}return this}addFormat(ie,he){return typeof he=="string"&&(he=new RegExp(he)),this.formats[ie]=he,this}errorsText(ie=this.errors,{separator:he=", ",dataVar:ce="data"}={}){return!ie||ie.length===0?"No errors":ie.map(K=>`${ce}${K.instancePath} ${K.message}`).reduce((K,ne)=>K+he+ne)}$dataMetaSchema(ie,he){const ce=this.RULES.all;ie=JSON.parse(JSON.stringify(ie));for(const K of he){const ne=K.split("/").slice(1);let de=ie;for(const ge of ne)de=de[ge];for(const ge in ce){const ve=ce[ge];if(typeof ve!="object")continue;const{$data:Se}=ve.definition,Ce=de[ge];Se&&Ce&&(de[ge]=we(Ce))}}return ie}_removeAllSchemas(ie,he){for(const ce in ie){const K=ie[ce];(!he||he.test(ce))&&(typeof K=="string"?delete ie[ce]:K&&!K.meta&&(this._cache.delete(K.schema),delete ie[ce]))}}_addSchema(ie,he,ce,K=this.opts.validateSchema,ne=this.opts.addUsedSchema){let de;const{schemaId:ge}=this.opts;if(typeof ie=="object")de=ie[ge];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof ie!="boolean")throw new Error("schema must be object or boolean")}let ve=this._cache.get(ie);if(ve!==void 0)return ve;ce=(0,x.normalizeId)(de||ce);const Se=x.getSchemaRefs.call(this,ie,ce);return ve=new M.SchemaEnv({schema:ie,schemaId:ge,meta:he,baseId:ce,localRefs:Se}),this._cache.set(ve.schema,ve),ne&&!ce.startsWith("#")&&(ce&&this._checkUnique(ce),this.refs[ce]=ve),K&&this.validateSchema(ie,!0),ve}_checkUnique(ie){if(this.schemas[ie]||this.refs[ie])throw new Error(`schema with key or id "${ie}" already exists`)}_compileSchemaEnv(ie){if(ie.meta?this._compileMetaSchema(ie):M.compileSchema.call(this,ie),!ie.validate)throw new Error("ajv implementation error");return ie.validate}_compileMetaSchema(ie){const he=this.opts;this.opts=this._metaOpts;try{M.compileSchema.call(this,ie)}finally{this.opts=he}}}A.default=W,W.ValidationError=D.default,W.MissingRefError=N.default;function ae(pe,ie,he,ce="error"){for(const K in pe){const ne=K;ne in ie&&this.logger[ce](`${he}: option ${K}. ${pe[ne]}`)}}function B(pe){return pe=(0,x.normalizeId)(pe),this.schemas[pe]||this.refs[pe]}function Z(){const pe=this.opts.schemas;if(pe)if(Array.isArray(pe))this.addSchema(pe);else for(const ie in pe)this.addSchema(pe[ie],ie)}function oe(){for(const pe in this.opts.formats){const ie=this.opts.formats[pe];ie&&this.addFormat(pe,ie)}}function fe(pe){if(Array.isArray(pe)){this.addVocabulary(pe);return}this.logger.warn("keywords option as map is deprecated, pass array");for(const ie in pe){const he=pe[ie];he.keyword||(he.keyword=ie),this.addKeyword(he)}}function me(){const pe={...this.opts};for(const ie of X)delete pe[ie];return pe}const _e={log(){},warn(){},error(){}};function ye(pe){if(pe===!1)return _e;if(pe===void 0)return console;if(pe.log&&pe.warn&&pe.error)return pe;throw new Error("logger must implement log, warn and error methods")}const Re=/^[a-z_$][a-z0-9_$:-]*$/i;function ke(pe,ie){const{RULES:he}=this;if((0,U.eachItem)(pe,ce=>{if(he.keywords[ce])throw new Error(`Keyword ${ce} is already defined`);if(!Re.test(ce))throw new Error(`Keyword ${ce} has invalid name`)}),!!ie&&ie.$data&&!("code"in ie||"validate"in ie))throw new Error('$data keyword must have "code" or "validate" function')}function De(pe,ie,he){var ce;const K=ie==null?void 0:ie.post;if(he&&K)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:ne}=this;let de=K?ne.post:ne.rules.find(({type:ve})=>ve===he);if(de||(de={type:he,rules:[]},ne.rules.push(de)),ne.keywords[pe]=!0,!ie)return;const ge={keyword:pe,definition:{...ie,type:(0,F.getJSONTypes)(ie.type),schemaType:(0,F.getJSONTypes)(ie.schemaType)}};ie.before?Le.call(this,de,ge,ie.before):de.rules.push(ge),ne.all[pe]=ge,(ce=ie.implements)===null||ce===void 0||ce.forEach(ve=>this.addKeyword(ve))}function Le(pe,ie,he){const ce=pe.rules.findIndex(K=>K.keyword===he);ce>=0?pe.rules.splice(ce,0,ie):(pe.rules.push(ie),this.logger.warn(`rule ${he} is not defined`))}function Ve(pe){let{metaSchema:ie}=pe;ie!==void 0&&(pe.$data&&this.opts.$data&&(ie=we(ie)),pe.validateSchema=this.compile(ie,!0))}const Ke={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function we(pe){return{anyOf:[pe,Ke]}}})(core$2);var draft7={},core$1={},id={};Object.defineProperty(id,"__esModule",{value:!0});const def$s={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};id.default=def$s;var ref={};Object.defineProperty(ref,"__esModule",{value:!0});ref.callRef=ref.getValidate=void 0;const ref_error_1=ref_error,code_1$8=code,codegen_1$l=codegen,names_1$1=names$1,compile_1$1=compile,util_1$j=util,def$r={keyword:"$ref",schemaType:"string",code(A){const{gen:_,schema:$,it:D}=A,{baseId:N,schemaEnv:q,validateName:M,opts:L,self:x}=D,{root:F}=q;if(($==="#"||$==="#/")&&N===F.baseId)return V();const U=compile_1$1.resolveRef.call(x,F,N,$);if(U===void 0)throw new ref_error_1.default(D.opts.uriResolver,N,$);if(U instanceof compile_1$1.SchemaEnv)return Q(U);return Y(U);function V(){if(q===F)return callRef(A,M,q,q.$async);const X=_.scopeValue("root",{ref:F});return callRef(A,(0,codegen_1$l._)`${X}.validate`,F,F.$async)}function Q(X){const ee=getValidate(A,X);callRef(A,ee,X,X.$async)}function Y(X){const ee=_.scopeValue("schema",L.code.source===!0?{ref:X,code:(0,codegen_1$l.stringify)(X)}:{ref:X}),te=_.name("valid"),z=A.subschema({schema:X,dataTypes:[],schemaPath:codegen_1$l.nil,topSchemaRef:ee,errSchemaPath:$},te);A.mergeEvaluated(z),A.ok(te)}}};function getValidate(A,_){const{gen:$}=A;return _.validate?$.scopeValue("validate",{ref:_.validate}):(0,codegen_1$l._)`${$.scopeValue("wrapper",{ref:_})}.validate`}ref.getValidate=getValidate;function callRef(A,_,$,D){const{gen:N,it:q}=A,{allErrors:M,schemaEnv:L,opts:x}=q,F=x.passContext?names_1$1.default.this:codegen_1$l.nil;D?U():V();function U(){if(!L.$async)throw new Error("async schema referenced by sync schema");const X=N.let("valid");N.try(()=>{N.code((0,codegen_1$l._)`await ${(0,code_1$8.callValidateCode)(A,_,F)}`),Y(_),M||N.assign(X,!0)},ee=>{N.if((0,codegen_1$l._)`!(${ee} instanceof ${q.ValidationError})`,()=>N.throw(ee)),Q(ee),M||N.assign(X,!1)}),A.ok(X)}function V(){A.result((0,code_1$8.callValidateCode)(A,_,F),()=>Y(_),()=>Q(_))}function Q(X){const ee=(0,codegen_1$l._)`${X}.errors`;N.assign(names_1$1.default.vErrors,(0,codegen_1$l._)`${names_1$1.default.vErrors} === null ? ${ee} : ${names_1$1.default.vErrors}.concat(${ee})`),N.assign(names_1$1.default.errors,(0,codegen_1$l._)`${names_1$1.default.vErrors}.length`)}function Y(X){var ee;if(!q.opts.unevaluated)return;const te=(ee=$==null?void 0:$.validate)===null||ee===void 0?void 0:ee.evaluated;if(q.props!==!0)if(te&&!te.dynamicProps)te.props!==void 0&&(q.props=util_1$j.mergeEvaluated.props(N,te.props,q.props));else{const z=N.var("props",(0,codegen_1$l._)`${X}.evaluated.props`);q.props=util_1$j.mergeEvaluated.props(N,z,q.props,codegen_1$l.Name)}if(q.items!==!0)if(te&&!te.dynamicItems)te.items!==void 0&&(q.items=util_1$j.mergeEvaluated.items(N,te.items,q.items));else{const z=N.var("items",(0,codegen_1$l._)`${X}.evaluated.items`);q.items=util_1$j.mergeEvaluated.items(N,z,q.items,codegen_1$l.Name)}}}ref.callRef=callRef;ref.default=def$r;Object.defineProperty(core$1,"__esModule",{value:!0});const id_1=id,ref_1=ref,core=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",id_1.default,ref_1.default];core$1.default=core;var validation$1={},limitNumber={};Object.defineProperty(limitNumber,"__esModule",{value:!0});const codegen_1$k=codegen,ops=codegen_1$k.operators,KWDs={maximum:{okStr:"<=",ok:ops.LTE,fail:ops.GT},minimum:{okStr:">=",ok:ops.GTE,fail:ops.LT},exclusiveMaximum:{okStr:"<",ok:ops.LT,fail:ops.GTE},exclusiveMinimum:{okStr:">",ok:ops.GT,fail:ops.LTE}},error$i={message:({keyword:A,schemaCode:_})=>(0,codegen_1$k.str)`must be ${KWDs[A].okStr} ${_}`,params:({keyword:A,schemaCode:_})=>(0,codegen_1$k._)`{comparison: ${KWDs[A].okStr}, limit: ${_}}`},def$q={keyword:Object.keys(KWDs),type:"number",schemaType:"number",$data:!0,error:error$i,code(A){const{keyword:_,data:$,schemaCode:D}=A;A.fail$data((0,codegen_1$k._)`${$} ${KWDs[_].fail} ${D} || isNaN(${$})`)}};limitNumber.default=def$q;var multipleOf={};Object.defineProperty(multipleOf,"__esModule",{value:!0});const codegen_1$j=codegen,error$h={message:({schemaCode:A})=>(0,codegen_1$j.str)`must be multiple of ${A}`,params:({schemaCode:A})=>(0,codegen_1$j._)`{multipleOf: ${A}}`},def$p={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:error$h,code(A){const{gen:_,data:$,schemaCode:D,it:N}=A,q=N.opts.multipleOfPrecision,M=_.let("res"),L=q?(0,codegen_1$j._)`Math.abs(Math.round(${M}) - ${M}) > 1e-${q}`:(0,codegen_1$j._)`${M} !== parseInt(${M})`;A.fail$data((0,codegen_1$j._)`(${D} === 0 || (${M} = ${$}/${D}, ${L}))`)}};multipleOf.default=def$p;var limitLength={},ucs2length$1={};Object.defineProperty(ucs2length$1,"__esModule",{value:!0});function ucs2length(A){const _=A.length;let $=0,D=0,N;for(;D<_;)$++,N=A.charCodeAt(D++),N>=55296&&N<=56319&&D<_&&(N=A.charCodeAt(D),(N&64512)===56320&&D++);return $}ucs2length$1.default=ucs2length;ucs2length.code='require("ajv/dist/runtime/ucs2length").default';Object.defineProperty(limitLength,"__esModule",{value:!0});const codegen_1$i=codegen,util_1$i=util,ucs2length_1=ucs2length$1,error$g={message({keyword:A,schemaCode:_}){const $=A==="maxLength"?"more":"fewer";return(0,codegen_1$i.str)`must NOT have ${$} than ${_} characters`},params:({schemaCode:A})=>(0,codegen_1$i._)`{limit: ${A}}`},def$o={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:error$g,code(A){const{keyword:_,data:$,schemaCode:D,it:N}=A,q=_==="maxLength"?codegen_1$i.operators.GT:codegen_1$i.operators.LT,M=N.opts.unicode===!1?(0,codegen_1$i._)`${$}.length`:(0,codegen_1$i._)`${(0,util_1$i.useFunc)(A.gen,ucs2length_1.default)}(${$})`;A.fail$data((0,codegen_1$i._)`${M} ${q} ${D}`)}};limitLength.default=def$o;var pattern={};Object.defineProperty(pattern,"__esModule",{value:!0});const code_1$7=code,codegen_1$h=codegen,error$f={message:({schemaCode:A})=>(0,codegen_1$h.str)`must match pattern "${A}"`,params:({schemaCode:A})=>(0,codegen_1$h._)`{pattern: ${A}}`},def$n={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:error$f,code(A){const{data:_,$data:$,schema:D,schemaCode:N,it:q}=A,M=q.opts.unicodeRegExp?"u":"",L=$?(0,codegen_1$h._)`(new RegExp(${N}, ${M}))`:(0,code_1$7.usePattern)(A,D);A.fail$data((0,codegen_1$h._)`!${L}.test(${_})`)}};pattern.default=def$n;var limitProperties={};Object.defineProperty(limitProperties,"__esModule",{value:!0});const codegen_1$g=codegen,error$e={message({keyword:A,schemaCode:_}){const $=A==="maxProperties"?"more":"fewer";return(0,codegen_1$g.str)`must NOT have ${$} than ${_} properties`},params:({schemaCode:A})=>(0,codegen_1$g._)`{limit: ${A}}`},def$m={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:error$e,code(A){const{keyword:_,data:$,schemaCode:D}=A,N=_==="maxProperties"?codegen_1$g.operators.GT:codegen_1$g.operators.LT;A.fail$data((0,codegen_1$g._)`Object.keys(${$}).length ${N} ${D}`)}};limitProperties.default=def$m;var required={};Object.defineProperty(required,"__esModule",{value:!0});const code_1$6=code,codegen_1$f=codegen,util_1$h=util,error$d={message:({params:{missingProperty:A}})=>(0,codegen_1$f.str)`must have required property '${A}'`,params:({params:{missingProperty:A}})=>(0,codegen_1$f._)`{missingProperty: ${A}}`},def$l={keyword:"required",type:"object",schemaType:"array",$data:!0,error:error$d,code(A){const{gen:_,schema:$,schemaCode:D,data:N,$data:q,it:M}=A,{opts:L}=M;if(!q&&$.length===0)return;const x=$.length>=L.loopRequired;if(M.allErrors?F():U(),L.strictRequired){const Y=A.parentSchema.properties,{definedProperties:X}=A.it;for(const ee of $)if((Y==null?void 0:Y[ee])===void 0&&!X.has(ee)){const te=M.schemaEnv.baseId+M.errSchemaPath,z=`required property "${ee}" is not defined at "${te}" (strictRequired)`;(0,util_1$h.checkStrictMode)(M,z,M.opts.strictRequired)}}function F(){if(x||q)A.block$data(codegen_1$f.nil,V);else for(const Y of $)(0,code_1$6.checkReportMissingProp)(A,Y)}function U(){const Y=_.let("missing");if(x||q){const X=_.let("valid",!0);A.block$data(X,()=>Q(Y,X)),A.ok(X)}else _.if((0,code_1$6.checkMissingProp)(A,$,Y)),(0,code_1$6.reportMissingProp)(A,Y),_.else()}function V(){_.forOf("prop",D,Y=>{A.setParams({missingProperty:Y}),_.if((0,code_1$6.noPropertyInData)(_,N,Y,L.ownProperties),()=>A.error())})}function Q(Y,X){A.setParams({missingProperty:Y}),_.forOf(Y,D,()=>{_.assign(X,(0,code_1$6.propertyInData)(_,N,Y,L.ownProperties)),_.if((0,codegen_1$f.not)(X),()=>{A.error(),_.break()})},codegen_1$f.nil)}}};required.default=def$l;var limitItems={};Object.defineProperty(limitItems,"__esModule",{value:!0});const codegen_1$e=codegen,error$c={message({keyword:A,schemaCode:_}){const $=A==="maxItems"?"more":"fewer";return(0,codegen_1$e.str)`must NOT have ${$} than ${_} items`},params:({schemaCode:A})=>(0,codegen_1$e._)`{limit: ${A}}`},def$k={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:error$c,code(A){const{keyword:_,data:$,schemaCode:D}=A,N=_==="maxItems"?codegen_1$e.operators.GT:codegen_1$e.operators.LT;A.fail$data((0,codegen_1$e._)`${$}.length ${N} ${D}`)}};limitItems.default=def$k;var uniqueItems={},equal$1={};Object.defineProperty(equal$1,"__esModule",{value:!0});const equal=fastDeepEqual;equal.code='require("ajv/dist/runtime/equal").default';equal$1.default=equal;Object.defineProperty(uniqueItems,"__esModule",{value:!0});const dataType_1=dataType,codegen_1$d=codegen,util_1$g=util,equal_1$2=equal$1,error$b={message:({params:{i:A,j:_}})=>(0,codegen_1$d.str)`must NOT have duplicate items (items ## ${_} and ${A} are identical)`,params:({params:{i:A,j:_}})=>(0,codegen_1$d._)`{i: ${A}, j: ${_}}`},def$j={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:error$b,code(A){const{gen:_,data:$,$data:D,schema:N,parentSchema:q,schemaCode:M,it:L}=A;if(!D&&!N)return;const x=_.let("valid"),F=q.items?(0,dataType_1.getSchemaTypes)(q.items):[];A.block$data(x,U,(0,codegen_1$d._)`${M} === false`),A.ok(x);function U(){const X=_.let("i",(0,codegen_1$d._)`${$}.length`),ee=_.let("j");A.setParams({i:X,j:ee}),_.assign(x,!0),_.if((0,codegen_1$d._)`${X} > 1`,()=>(V()?Q:Y)(X,ee))}function V(){return F.length>0&&!F.some(X=>X==="object"||X==="array")}function Q(X,ee){const te=_.name("item"),z=(0,dataType_1.checkDataTypes)(F,te,L.opts.strictNumbers,dataType_1.DataType.Wrong),G=_.const("indices",(0,codegen_1$d._)`{}`);_.for((0,codegen_1$d._)`;${X}--;`,()=>{_.let(te,(0,codegen_1$d._)`${$}[${X}]`),_.if(z,(0,codegen_1$d._)`continue`),F.length>1&&_.if((0,codegen_1$d._)`typeof ${te} == "string"`,(0,codegen_1$d._)`${te} += "_"`),_.if((0,codegen_1$d._)`typeof ${G}[${te}] == "number"`,()=>{_.assign(ee,(0,codegen_1$d._)`${G}[${te}]`),A.error(),_.assign(x,!1).break()}).code((0,codegen_1$d._)`${G}[${te}] = ${X}`)})}function Y(X,ee){const te=(0,util_1$g.useFunc)(_,equal_1$2.default),z=_.name("outer");_.label(z).for((0,codegen_1$d._)`;${X}--;`,()=>_.for((0,codegen_1$d._)`${ee} = ${X}; ${ee}--;`,()=>_.if((0,codegen_1$d._)`${te}(${$}[${X}], ${$}[${ee}])`,()=>{A.error(),_.assign(x,!1).break(z)})))}}};uniqueItems.default=def$j;var _const={};Object.defineProperty(_const,"__esModule",{value:!0});const codegen_1$c=codegen,util_1$f=util,equal_1$1=equal$1,error$a={message:"must be equal to constant",params:({schemaCode:A})=>(0,codegen_1$c._)`{allowedValue: ${A}}`},def$i={keyword:"const",$data:!0,error:error$a,code(A){const{gen:_,data:$,$data:D,schemaCode:N,schema:q}=A;D||q&&typeof q=="object"?A.fail$data((0,codegen_1$c._)`!${(0,util_1$f.useFunc)(_,equal_1$1.default)}(${$}, ${N})`):A.fail((0,codegen_1$c._)`${q} !== ${$}`)}};_const.default=def$i;var _enum={};Object.defineProperty(_enum,"__esModule",{value:!0});const codegen_1$b=codegen,util_1$e=util,equal_1=equal$1,error$9={message:"must be equal to one of the allowed values",params:({schemaCode:A})=>(0,codegen_1$b._)`{allowedValues: ${A}}`},def$h={keyword:"enum",schemaType:"array",$data:!0,error:error$9,code(A){const{gen:_,data:$,$data:D,schema:N,schemaCode:q,it:M}=A;if(!D&&N.length===0)throw new Error("enum must have non-empty array");const L=N.length>=M.opts.loopEnum;let x;const F=()=>x??(x=(0,util_1$e.useFunc)(_,equal_1.default));let U;if(L||D)U=_.let("valid"),A.block$data(U,V);else{if(!Array.isArray(N))throw new Error("ajv implementation error");const Y=_.const("vSchema",q);U=(0,codegen_1$b.or)(...N.map((X,ee)=>Q(Y,ee)))}A.pass(U);function V(){_.assign(U,!1),_.forOf("v",q,Y=>_.if((0,codegen_1$b._)`${F()}(${$}, ${Y})`,()=>_.assign(U,!0).break()))}function Q(Y,X){const ee=N[X];return typeof ee=="object"&&ee!==null?(0,codegen_1$b._)`${F()}(${$}, ${Y}[${X}])`:(0,codegen_1$b._)`${$} === ${ee}`}}};_enum.default=def$h;Object.defineProperty(validation$1,"__esModule",{value:!0});const limitNumber_1=limitNumber,multipleOf_1=multipleOf,limitLength_1=limitLength,pattern_1=pattern,limitProperties_1=limitProperties,required_1=required,limitItems_1=limitItems,uniqueItems_1=uniqueItems,const_1=_const,enum_1=_enum,validation=[limitNumber_1.default,multipleOf_1.default,limitLength_1.default,pattern_1.default,limitProperties_1.default,required_1.default,limitItems_1.default,uniqueItems_1.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},const_1.default,enum_1.default];validation$1.default=validation;var applicator={},additionalItems={};Object.defineProperty(additionalItems,"__esModule",{value:!0});additionalItems.validateAdditionalItems=void 0;const codegen_1$a=codegen,util_1$d=util,error$8={message:({params:{len:A}})=>(0,codegen_1$a.str)`must NOT have more than ${A} items`,params:({params:{len:A}})=>(0,codegen_1$a._)`{limit: ${A}}`},def$g={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:error$8,code(A){const{parentSchema:_,it:$}=A,{items:D}=_;if(!Array.isArray(D)){(0,util_1$d.checkStrictMode)($,'"additionalItems" is ignored when "items" is not an array of schemas');return}validateAdditionalItems(A,D)}};function validateAdditionalItems(A,_){const{gen:$,schema:D,data:N,keyword:q,it:M}=A;M.items=!0;const L=$.const("len",(0,codegen_1$a._)`${N}.length`);if(D===!1)A.setParams({len:_.length}),A.pass((0,codegen_1$a._)`${L} <= ${_.length}`);else if(typeof D=="object"&&!(0,util_1$d.alwaysValidSchema)(M,D)){const F=$.var("valid",(0,codegen_1$a._)`${L} <= ${_.length}`);$.if((0,codegen_1$a.not)(F),()=>x(F)),A.ok(F)}function x(F){$.forRange("i",_.length,L,U=>{A.subschema({keyword:q,dataProp:U,dataPropType:util_1$d.Type.Num},F),M.allErrors||$.if((0,codegen_1$a.not)(F),()=>$.break())})}}additionalItems.validateAdditionalItems=validateAdditionalItems;additionalItems.default=def$g;var prefixItems={},items={};Object.defineProperty(items,"__esModule",{value:!0});items.validateTuple=void 0;const codegen_1$9=codegen,util_1$c=util,code_1$5=code,def$f={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(A){const{schema:_,it:$}=A;if(Array.isArray(_))return validateTuple(A,"additionalItems",_);$.items=!0,!(0,util_1$c.alwaysValidSchema)($,_)&&A.ok((0,code_1$5.validateArray)(A))}};function validateTuple(A,_,$=A.schema){const{gen:D,parentSchema:N,data:q,keyword:M,it:L}=A;U(N),L.opts.unevaluated&&$.length&&L.items!==!0&&(L.items=util_1$c.mergeEvaluated.items(D,$.length,L.items));const x=D.name("valid"),F=D.const("len",(0,codegen_1$9._)`${q}.length`);$.forEach((V,Q)=>{(0,util_1$c.alwaysValidSchema)(L,V)||(D.if((0,codegen_1$9._)`${F} > ${Q}`,()=>A.subschema({keyword:M,schemaProp:Q,dataProp:Q},x)),A.ok(x))});function U(V){const{opts:Q,errSchemaPath:Y}=L,X=$.length,ee=X===V.minItems&&(X===V.maxItems||V[_]===!1);if(Q.strictTuples&&!ee){const te=`"${M}" is ${X}-tuple, but minItems or maxItems/${_} are not specified or different at path "${Y}"`;(0,util_1$c.checkStrictMode)(L,te,Q.strictTuples)}}}items.validateTuple=validateTuple;items.default=def$f;Object.defineProperty(prefixItems,"__esModule",{value:!0});const items_1$1=items,def$e={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:A=>(0,items_1$1.validateTuple)(A,"items")};prefixItems.default=def$e;var items2020={};Object.defineProperty(items2020,"__esModule",{value:!0});const codegen_1$8=codegen,util_1$b=util,code_1$4=code,additionalItems_1$1=additionalItems,error$7={message:({params:{len:A}})=>(0,codegen_1$8.str)`must NOT have more than ${A} items`,params:({params:{len:A}})=>(0,codegen_1$8._)`{limit: ${A}}`},def$d={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:error$7,code(A){const{schema:_,parentSchema:$,it:D}=A,{prefixItems:N}=$;D.items=!0,!(0,util_1$b.alwaysValidSchema)(D,_)&&(N?(0,additionalItems_1$1.validateAdditionalItems)(A,N):A.ok((0,code_1$4.validateArray)(A)))}};items2020.default=def$d;var contains={};Object.defineProperty(contains,"__esModule",{value:!0});const codegen_1$7=codegen,util_1$a=util,error$6={message:({params:{min:A,max:_}})=>_===void 0?(0,codegen_1$7.str)`must contain at least ${A} valid item(s)`:(0,codegen_1$7.str)`must contain at least ${A} and no more than ${_} valid item(s)`,params:({params:{min:A,max:_}})=>_===void 0?(0,codegen_1$7._)`{minContains: ${A}}`:(0,codegen_1$7._)`{minContains: ${A}, maxContains: ${_}}`},def$c={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:error$6,code(A){const{gen:_,schema:$,parentSchema:D,data:N,it:q}=A;let M,L;const{minContains:x,maxContains:F}=D;q.opts.next?(M=x===void 0?1:x,L=F):M=1;const U=_.const("len",(0,codegen_1$7._)`${N}.length`);if(A.setParams({min:M,max:L}),L===void 0&&M===0){(0,util_1$a.checkStrictMode)(q,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(L!==void 0&&M>L){(0,util_1$a.checkStrictMode)(q,'"minContains" > "maxContains" is always invalid'),A.fail();return}if((0,util_1$a.alwaysValidSchema)(q,$)){let ee=(0,codegen_1$7._)`${U} >= ${M}`;L!==void 0&&(ee=(0,codegen_1$7._)`${ee} && ${U} <= ${L}`),A.pass(ee);return}q.items=!0;const V=_.name("valid");L===void 0&&M===1?Y(V,()=>_.if(V,()=>_.break())):M===0?(_.let(V,!0),L!==void 0&&_.if((0,codegen_1$7._)`${N}.length > 0`,Q)):(_.let(V,!1),Q()),A.result(V,()=>A.reset());function Q(){const ee=_.name("_valid"),te=_.let("count",0);Y(ee,()=>_.if(ee,()=>X(te)))}function Y(ee,te){_.forRange("i",0,U,z=>{A.subschema({keyword:"contains",dataProp:z,dataPropType:util_1$a.Type.Num,compositeRule:!0},ee),te()})}function X(ee){_.code((0,codegen_1$7._)`${ee}++`),L===void 0?_.if((0,codegen_1$7._)`${ee} >= ${M}`,()=>_.assign(V,!0).break()):(_.if((0,codegen_1$7._)`${ee} > ${L}`,()=>_.assign(V,!1).break()),M===1?_.assign(V,!0):_.if((0,codegen_1$7._)`${ee} >= ${M}`,()=>_.assign(V,!0)))}}};contains.default=def$c;var dependencies$1={};(function(A){Object.defineProperty(A,"__esModule",{value:!0}),A.validateSchemaDeps=A.validatePropertyDeps=A.error=void 0;const _=codegen,$=util,D=code;A.error={message:({params:{property:x,depsCount:F,deps:U}})=>{const V=F===1?"property":"properties";return(0,_.str)`must have ${V} ${U} when property ${x} is present`},params:({params:{property:x,depsCount:F,deps:U,missingProperty:V}})=>(0,_._)`{property: ${x},
    missingProperty: ${V},
    depsCount: ${F},
    deps: ${U}}`};const N={keyword:"dependencies",type:"object",schemaType:"object",error:A.error,code(x){const[F,U]=q(x);M(x,F),L(x,U)}};function q({schema:x}){const F={},U={};for(const V in x){if(V==="__proto__")continue;const Q=Array.isArray(x[V])?F:U;Q[V]=x[V]}return[F,U]}function M(x,F=x.schema){const{gen:U,data:V,it:Q}=x;if(Object.keys(F).length===0)return;const Y=U.let("missing");for(const X in F){const ee=F[X];if(ee.length===0)continue;const te=(0,D.propertyInData)(U,V,X,Q.opts.ownProperties);x.setParams({property:X,depsCount:ee.length,deps:ee.join(", ")}),Q.allErrors?U.if(te,()=>{for(const z of ee)(0,D.checkReportMissingProp)(x,z)}):(U.if((0,_._)`${te} && (${(0,D.checkMissingProp)(x,ee,Y)})`),(0,D.reportMissingProp)(x,Y),U.else())}}A.validatePropertyDeps=M;function L(x,F=x.schema){const{gen:U,data:V,keyword:Q,it:Y}=x,X=U.name("valid");for(const ee in F)(0,$.alwaysValidSchema)(Y,F[ee])||(U.if((0,D.propertyInData)(U,V,ee,Y.opts.ownProperties),()=>{const te=x.subschema({keyword:Q,schemaProp:ee},X);x.mergeValidEvaluated(te,X)},()=>U.var(X,!0)),x.ok(X))}A.validateSchemaDeps=L,A.default=N})(dependencies$1);var propertyNames={};Object.defineProperty(propertyNames,"__esModule",{value:!0});const codegen_1$6=codegen,util_1$9=util,error$5={message:"property name must be valid",params:({params:A})=>(0,codegen_1$6._)`{propertyName: ${A.propertyName}}`},def$b={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:error$5,code(A){const{gen:_,schema:$,data:D,it:N}=A;if((0,util_1$9.alwaysValidSchema)(N,$))return;const q=_.name("valid");_.forIn("key",D,M=>{A.setParams({propertyName:M}),A.subschema({keyword:"propertyNames",data:M,dataTypes:["string"],propertyName:M,compositeRule:!0},q),_.if((0,codegen_1$6.not)(q),()=>{A.error(!0),N.allErrors||_.break()})}),A.ok(q)}};propertyNames.default=def$b;var additionalProperties={};Object.defineProperty(additionalProperties,"__esModule",{value:!0});const code_1$3=code,codegen_1$5=codegen,names_1=names$1,util_1$8=util,error$4={message:"must NOT have additional properties",params:({params:A})=>(0,codegen_1$5._)`{additionalProperty: ${A.additionalProperty}}`},def$a={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:error$4,code(A){const{gen:_,schema:$,parentSchema:D,data:N,errsCount:q,it:M}=A;if(!q)throw new Error("ajv implementation error");const{allErrors:L,opts:x}=M;if(M.props=!0,x.removeAdditional!=="all"&&(0,util_1$8.alwaysValidSchema)(M,$))return;const F=(0,code_1$3.allSchemaProperties)(D.properties),U=(0,code_1$3.allSchemaProperties)(D.patternProperties);V(),A.ok((0,codegen_1$5._)`${q} === ${names_1.default.errors}`);function V(){_.forIn("key",N,te=>{!F.length&&!U.length?X(te):_.if(Q(te),()=>X(te))})}function Q(te){let z;if(F.length>8){const G=(0,util_1$8.schemaRefOrVal)(M,D.properties,"properties");z=(0,code_1$3.isOwnProperty)(_,G,te)}else F.length?z=(0,codegen_1$5.or)(...F.map(G=>(0,codegen_1$5._)`${te} === ${G}`)):z=codegen_1$5.nil;return U.length&&(z=(0,codegen_1$5.or)(z,...U.map(G=>(0,codegen_1$5._)`${(0,code_1$3.usePattern)(A,G)}.test(${te})`))),(0,codegen_1$5.not)(z)}function Y(te){_.code((0,codegen_1$5._)`delete ${N}[${te}]`)}function X(te){if(x.removeAdditional==="all"||x.removeAdditional&&$===!1){Y(te);return}if($===!1){A.setParams({additionalProperty:te}),A.error(),L||_.break();return}if(typeof $=="object"&&!(0,util_1$8.alwaysValidSchema)(M,$)){const z=_.name("valid");x.removeAdditional==="failing"?(ee(te,z,!1),_.if((0,codegen_1$5.not)(z),()=>{A.reset(),Y(te)})):(ee(te,z),L||_.if((0,codegen_1$5.not)(z),()=>_.break()))}}function ee(te,z,G){const H={keyword:"additionalProperties",dataProp:te,dataPropType:util_1$8.Type.Str};G===!1&&Object.assign(H,{compositeRule:!0,createErrors:!1,allErrors:!1}),A.subschema(H,z)}}};additionalProperties.default=def$a;var properties$1={};Object.defineProperty(properties$1,"__esModule",{value:!0});const validate_1=validate,code_1$2=code,util_1$7=util,additionalProperties_1$1=additionalProperties,def$9={keyword:"properties",type:"object",schemaType:"object",code(A){const{gen:_,schema:$,parentSchema:D,data:N,it:q}=A;q.opts.removeAdditional==="all"&&D.additionalProperties===void 0&&additionalProperties_1$1.default.code(new validate_1.KeywordCxt(q,additionalProperties_1$1.default,"additionalProperties"));const M=(0,code_1$2.allSchemaProperties)($);for(const V of M)q.definedProperties.add(V);q.opts.unevaluated&&M.length&&q.props!==!0&&(q.props=util_1$7.mergeEvaluated.props(_,(0,util_1$7.toHash)(M),q.props));const L=M.filter(V=>!(0,util_1$7.alwaysValidSchema)(q,$[V]));if(L.length===0)return;const x=_.name("valid");for(const V of L)F(V)?U(V):(_.if((0,code_1$2.propertyInData)(_,N,V,q.opts.ownProperties)),U(V),q.allErrors||_.else().var(x,!0),_.endIf()),A.it.definedProperties.add(V),A.ok(x);function F(V){return q.opts.useDefaults&&!q.compositeRule&&$[V].default!==void 0}function U(V){A.subschema({keyword:"properties",schemaProp:V,dataProp:V},x)}}};properties$1.default=def$9;var patternProperties={};Object.defineProperty(patternProperties,"__esModule",{value:!0});const code_1$1=code,codegen_1$4=codegen,util_1$6=util,util_2=util,def$8={keyword:"patternProperties",type:"object",schemaType:"object",code(A){const{gen:_,schema:$,data:D,parentSchema:N,it:q}=A,{opts:M}=q,L=(0,code_1$1.allSchemaProperties)($),x=L.filter(ee=>(0,util_1$6.alwaysValidSchema)(q,$[ee]));if(L.length===0||x.length===L.length&&(!q.opts.unevaluated||q.props===!0))return;const F=M.strictSchema&&!M.allowMatchingProperties&&N.properties,U=_.name("valid");q.props!==!0&&!(q.props instanceof codegen_1$4.Name)&&(q.props=(0,util_2.evaluatedPropsToName)(_,q.props));const{props:V}=q;Q();function Q(){for(const ee of L)F&&Y(ee),q.allErrors?X(ee):(_.var(U,!0),X(ee),_.if(U))}function Y(ee){for(const te in F)new RegExp(ee).test(te)&&(0,util_1$6.checkStrictMode)(q,`property ${te} matches pattern ${ee} (use allowMatchingProperties)`)}function X(ee){_.forIn("key",D,te=>{_.if((0,codegen_1$4._)`${(0,code_1$1.usePattern)(A,ee)}.test(${te})`,()=>{const z=x.includes(ee);z||A.subschema({keyword:"patternProperties",schemaProp:ee,dataProp:te,dataPropType:util_2.Type.Str},U),q.opts.unevaluated&&V!==!0?_.assign((0,codegen_1$4._)`${V}[${te}]`,!0):!z&&!q.allErrors&&_.if((0,codegen_1$4.not)(U),()=>_.break())})})}}};patternProperties.default=def$8;var not={};Object.defineProperty(not,"__esModule",{value:!0});const util_1$5=util,def$7={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(A){const{gen:_,schema:$,it:D}=A;if((0,util_1$5.alwaysValidSchema)(D,$)){A.fail();return}const N=_.name("valid");A.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},N),A.failResult(N,()=>A.reset(),()=>A.error())},error:{message:"must NOT be valid"}};not.default=def$7;var anyOf={};Object.defineProperty(anyOf,"__esModule",{value:!0});const code_1=code,def$6={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:code_1.validateUnion,error:{message:"must match a schema in anyOf"}};anyOf.default=def$6;var oneOf={};Object.defineProperty(oneOf,"__esModule",{value:!0});const codegen_1$3=codegen,util_1$4=util,error$3={message:"must match exactly one schema in oneOf",params:({params:A})=>(0,codegen_1$3._)`{passingSchemas: ${A.passing}}`},def$5={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:error$3,code(A){const{gen:_,schema:$,parentSchema:D,it:N}=A;if(!Array.isArray($))throw new Error("ajv implementation error");if(N.opts.discriminator&&D.discriminator)return;const q=$,M=_.let("valid",!1),L=_.let("passing",null),x=_.name("_valid");A.setParams({passing:L}),_.block(F),A.result(M,()=>A.reset(),()=>A.error(!0));function F(){q.forEach((U,V)=>{let Q;(0,util_1$4.alwaysValidSchema)(N,U)?_.var(x,!0):Q=A.subschema({keyword:"oneOf",schemaProp:V,compositeRule:!0},x),V>0&&_.if((0,codegen_1$3._)`${x} && ${M}`).assign(M,!1).assign(L,(0,codegen_1$3._)`[${L}, ${V}]`).else(),_.if(x,()=>{_.assign(M,!0),_.assign(L,V),Q&&A.mergeEvaluated(Q,codegen_1$3.Name)})})}}};oneOf.default=def$5;var allOf={};Object.defineProperty(allOf,"__esModule",{value:!0});const util_1$3=util,def$4={keyword:"allOf",schemaType:"array",code(A){const{gen:_,schema:$,it:D}=A;if(!Array.isArray($))throw new Error("ajv implementation error");const N=_.name("valid");$.forEach((q,M)=>{if((0,util_1$3.alwaysValidSchema)(D,q))return;const L=A.subschema({keyword:"allOf",schemaProp:M},N);A.ok(N),A.mergeEvaluated(L)})}};allOf.default=def$4;var _if={};Object.defineProperty(_if,"__esModule",{value:!0});const codegen_1$2=codegen,util_1$2=util,error$2={message:({params:A})=>(0,codegen_1$2.str)`must match "${A.ifClause}" schema`,params:({params:A})=>(0,codegen_1$2._)`{failingKeyword: ${A.ifClause}}`},def$3={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:error$2,code(A){const{gen:_,parentSchema:$,it:D}=A;$.then===void 0&&$.else===void 0&&(0,util_1$2.checkStrictMode)(D,'"if" without "then" and "else" is ignored');const N=hasSchema(D,"then"),q=hasSchema(D,"else");if(!N&&!q)return;const M=_.let("valid",!0),L=_.name("_valid");if(x(),A.reset(),N&&q){const U=_.let("ifClause");A.setParams({ifClause:U}),_.if(L,F("then",U),F("else",U))}else N?_.if(L,F("then")):_.if((0,codegen_1$2.not)(L),F("else"));A.pass(M,()=>A.error(!0));function x(){const U=A.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},L);A.mergeEvaluated(U)}function F(U,V){return()=>{const Q=A.subschema({keyword:U},L);_.assign(M,L),A.mergeValidEvaluated(Q,M),V?_.assign(V,(0,codegen_1$2._)`${U}`):A.setParams({ifClause:U})}}}};function hasSchema(A,_){const $=A.schema[_];return $!==void 0&&!(0,util_1$2.alwaysValidSchema)(A,$)}_if.default=def$3;var thenElse={};Object.defineProperty(thenElse,"__esModule",{value:!0});const util_1$1=util,def$2={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:A,parentSchema:_,it:$}){_.if===void 0&&(0,util_1$1.checkStrictMode)($,`"${A}" without "if" is ignored`)}};thenElse.default=def$2;Object.defineProperty(applicator,"__esModule",{value:!0});const additionalItems_1=additionalItems,prefixItems_1=prefixItems,items_1=items,items2020_1=items2020,contains_1=contains,dependencies_1=dependencies$1,propertyNames_1=propertyNames,additionalProperties_1=additionalProperties,properties_1=properties$1,patternProperties_1=patternProperties,not_1=not,anyOf_1=anyOf,oneOf_1=oneOf,allOf_1=allOf,if_1=_if,thenElse_1=thenElse;function getApplicator(A=!1){const _=[not_1.default,anyOf_1.default,oneOf_1.default,allOf_1.default,if_1.default,thenElse_1.default,propertyNames_1.default,additionalProperties_1.default,dependencies_1.default,properties_1.default,patternProperties_1.default];return A?_.push(prefixItems_1.default,items2020_1.default):_.push(additionalItems_1.default,items_1.default),_.push(contains_1.default),_}applicator.default=getApplicator;var format$2={},format$1={};Object.defineProperty(format$1,"__esModule",{value:!0});const codegen_1$1=codegen,error$1={message:({schemaCode:A})=>(0,codegen_1$1.str)`must match format "${A}"`,params:({schemaCode:A})=>(0,codegen_1$1._)`{format: ${A}}`},def$1={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:error$1,code(A,_){const{gen:$,data:D,$data:N,schema:q,schemaCode:M,it:L}=A,{opts:x,errSchemaPath:F,schemaEnv:U,self:V}=L;if(!x.validateFormats)return;N?Q():Y();function Q(){const X=$.scopeValue("formats",{ref:V.formats,code:x.code.formats}),ee=$.const("fDef",(0,codegen_1$1._)`${X}[${M}]`),te=$.let("fType"),z=$.let("format");$.if((0,codegen_1$1._)`typeof ${ee} == "object" && !(${ee} instanceof RegExp)`,()=>$.assign(te,(0,codegen_1$1._)`${ee}.type || "string"`).assign(z,(0,codegen_1$1._)`${ee}.validate`),()=>$.assign(te,(0,codegen_1$1._)`"string"`).assign(z,ee)),A.fail$data((0,codegen_1$1.or)(G(),H()));function G(){return x.strictSchema===!1?codegen_1$1.nil:(0,codegen_1$1._)`${M} && !${z}`}function H(){const W=U.$async?(0,codegen_1$1._)`(${ee}.async ? await ${z}(${D}) : ${z}(${D}))`:(0,codegen_1$1._)`${z}(${D})`,ae=(0,codegen_1$1._)`(typeof ${z} == "function" ? ${W} : ${z}.test(${D}))`;return(0,codegen_1$1._)`${z} && ${z} !== true && ${te} === ${_} && !${ae}`}}function Y(){const X=V.formats[q];if(!X){G();return}if(X===!0)return;const[ee,te,z]=H(X);ee===_&&A.pass(W());function G(){if(x.strictSchema===!1){V.logger.warn(ae());return}throw new Error(ae());function ae(){return`unknown format "${q}" ignored in schema at path "${F}"`}}function H(ae){const B=ae instanceof RegExp?(0,codegen_1$1.regexpCode)(ae):x.code.formats?(0,codegen_1$1._)`${x.code.formats}${(0,codegen_1$1.getProperty)(q)}`:void 0,Z=$.scopeValue("formats",{key:q,ref:ae,code:B});return typeof ae=="object"&&!(ae instanceof RegExp)?[ae.type||"string",ae.validate,(0,codegen_1$1._)`${Z}.validate`]:["string",ae,Z]}function W(){if(typeof X=="object"&&!(X instanceof RegExp)&&X.async){if(!U.$async)throw new Error("async format in sync schema");return(0,codegen_1$1._)`await ${z}(${D})`}return typeof te=="function"?(0,codegen_1$1._)`${z}(${D})`:(0,codegen_1$1._)`${z}.test(${D})`}}}};format$1.default=def$1;Object.defineProperty(format$2,"__esModule",{value:!0});const format_1$1=format$1,format=[format_1$1.default];format$2.default=format;var metadata={};Object.defineProperty(metadata,"__esModule",{value:!0});metadata.contentVocabulary=metadata.metadataVocabulary=void 0;metadata.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];metadata.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"];Object.defineProperty(draft7,"__esModule",{value:!0});const core_1=core$1,validation_1=validation$1,applicator_1=applicator,format_1=format$2,metadata_1=metadata,draft7Vocabularies=[core_1.default,validation_1.default,(0,applicator_1.default)(),format_1.default,metadata_1.metadataVocabulary,metadata_1.contentVocabulary];draft7.default=draft7Vocabularies;var discriminator={},types={};(function(A){Object.defineProperty(A,"__esModule",{value:!0}),A.DiscrError=void 0,function(_){_.Tag="tag",_.Mapping="mapping"}(A.DiscrError||(A.DiscrError={}))})(types);Object.defineProperty(discriminator,"__esModule",{value:!0});const codegen_1=codegen,types_1=types,compile_1=compile,util_1=util,error={message:({params:{discrError:A,tagName:_}})=>A===types_1.DiscrError.Tag?`tag "${_}" must be string`:`value of tag "${_}" must be in oneOf`,params:({params:{discrError:A,tag:_,tagName:$}})=>(0,codegen_1._)`{error: ${A}, tag: ${$}, tagValue: ${_}}`},def={keyword:"discriminator",type:"object",schemaType:"object",error,code(A){const{gen:_,data:$,schema:D,parentSchema:N,it:q}=A,{oneOf:M}=N;if(!q.opts.discriminator)throw new Error("discriminator: requires discriminator option");const L=D.propertyName;if(typeof L!="string")throw new Error("discriminator: requires propertyName");if(D.mapping)throw new Error("discriminator: mapping is not supported");if(!M)throw new Error("discriminator: requires oneOf keyword");const x=_.let("valid",!1),F=_.const("tag",(0,codegen_1._)`${$}${(0,codegen_1.getProperty)(L)}`);_.if((0,codegen_1._)`typeof ${F} == "string"`,()=>U(),()=>A.error(!1,{discrError:types_1.DiscrError.Tag,tag:F,tagName:L})),A.ok(x);function U(){const Y=Q();_.if(!1);for(const X in Y)_.elseIf((0,codegen_1._)`${F} === ${X}`),_.assign(x,V(Y[X]));_.else(),A.error(!1,{discrError:types_1.DiscrError.Mapping,tag:F,tagName:L}),_.endIf()}function V(Y){const X=_.name("valid"),ee=A.subschema({keyword:"oneOf",schemaProp:Y},X);return A.mergeEvaluated(ee,codegen_1.Name),X}function Q(){var Y;const X={},ee=z(N);let te=!0;for(let W=0;W<M.length;W++){let ae=M[W];ae!=null&&ae.$ref&&!(0,util_1.schemaHasRulesButRef)(ae,q.self.RULES)&&(ae=compile_1.resolveRef.call(q.self,q.schemaEnv.root,q.baseId,ae==null?void 0:ae.$ref),ae instanceof compile_1.SchemaEnv&&(ae=ae.schema));const B=(Y=ae==null?void 0:ae.properties)===null||Y===void 0?void 0:Y[L];if(typeof B!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${L}"`);te=te&&(ee||z(ae)),G(B,W)}if(!te)throw new Error(`discriminator: "${L}" must be required`);return X;function z({required:W}){return Array.isArray(W)&&W.includes(L)}function G(W,ae){if(W.const)H(W.const,ae);else if(W.enum)for(const B of W.enum)H(B,ae);else throw new Error(`discriminator: "properties/${L}" must have "const" or "enum"`)}function H(W,ae){if(typeof W!="string"||W in X)throw new Error(`discriminator: "${L}" values must be unique strings`);X[W]=ae}}}};discriminator.default=def;const $schema="http://json-schema.org/draft-07/schema#",$id="http://json-schema.org/draft-07/schema#",title="Core schema meta-schema",definitions={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type=["object","boolean"],properties={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},require$$3={$schema,$id,title,definitions,type,properties,default:!0};(function(A,_){Object.defineProperty(_,"__esModule",{value:!0}),_.MissingRefError=_.ValidationError=_.CodeGen=_.Name=_.nil=_.stringify=_.str=_._=_.KeywordCxt=void 0;const $=core$2,D=draft7,N=discriminator,q=require$$3,M=["/properties"],L="http://json-schema.org/draft-07/schema";class x extends $.default{_addVocabularies(){super._addVocabularies(),D.default.forEach(X=>this.addVocabulary(X)),this.opts.discriminator&&this.addKeyword(N.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const X=this.opts.$data?this.$dataMetaSchema(q,M):q;this.addMetaSchema(X,L,!1),this.refs["http://json-schema.org/schema"]=L}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(L)?L:void 0)}}A.exports=_=x,Object.defineProperty(_,"__esModule",{value:!0}),_.default=x;var F=validate;Object.defineProperty(_,"KeywordCxt",{enumerable:!0,get:function(){return F.KeywordCxt}});var U=codegen;Object.defineProperty(_,"_",{enumerable:!0,get:function(){return U._}}),Object.defineProperty(_,"str",{enumerable:!0,get:function(){return U.str}}),Object.defineProperty(_,"stringify",{enumerable:!0,get:function(){return U.stringify}}),Object.defineProperty(_,"nil",{enumerable:!0,get:function(){return U.nil}}),Object.defineProperty(_,"Name",{enumerable:!0,get:function(){return U.Name}}),Object.defineProperty(_,"CodeGen",{enumerable:!0,get:function(){return U.CodeGen}});var V=validation_error;Object.defineProperty(_,"ValidationError",{enumerable:!0,get:function(){return V.default}});var Q=ref_error;Object.defineProperty(_,"MissingRefError",{enumerable:!0,get:function(){return Q.default}})})(ajv,ajv.exports);var ajvExports=ajv.exports;const Ajv=getDefaultExportFromCjs(ajvExports);var t=function(A,_){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function($,D){$.__proto__=D}||function($,D){for(var N in D)Object.prototype.hasOwnProperty.call(D,N)&&($[N]=D[N])},t(A,_)};function e(A,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");function $(){this.constructor=A}t(A,_),A.prototype=_===null?Object.create(_):($.prototype=_.prototype,new $)}var n=function(){return n=Object.assign||function(A){for(var _,$=1,D=arguments.length;$<D;$++)for(var N in _=arguments[$])Object.prototype.hasOwnProperty.call(_,N)&&(A[N]=_[N]);return A},n.apply(this,arguments)};function i(A,_,$,D){return new($||($=Promise))(function(N,q){function M(F){try{x(D.next(F))}catch(U){q(U)}}function L(F){try{x(D.throw(F))}catch(U){q(U)}}function x(F){var U;F.done?N(F.value):(U=F.value,U instanceof $?U:new $(function(V){V(U)})).then(M,L)}x((D=D.apply(A,_||[])).next())})}function o(A,_){var $,D,N,q,M={label:0,sent:function(){if(1&N[0])throw N[1];return N[1]},trys:[],ops:[]};return q={next:L(0),throw:L(1),return:L(2)},typeof Symbol=="function"&&(q[Symbol.iterator]=function(){return this}),q;function L(x){return function(F){return function(U){if($)throw new TypeError("Generator is already executing.");for(;M;)try{if($=1,D&&(N=2&U[0]?D.return:U[0]?D.throw||((N=D.return)&&N.call(D),0):D.next)&&!(N=N.call(D,U[1])).done)return N;switch(D=0,N&&(U=[2&U[0],N.value]),U[0]){case 0:case 1:N=U;break;case 4:return M.label++,{value:U[1],done:!1};case 5:M.label++,D=U[1],U=[0];continue;case 7:U=M.ops.pop(),M.trys.pop();continue;default:if(N=M.trys,!((N=N.length>0&&N[N.length-1])||U[0]!==6&&U[0]!==2)){M=0;continue}if(U[0]===3&&(!N||U[1]>N[0]&&U[1]<N[3])){M.label=U[1];break}if(U[0]===6&&M.label<N[1]){M.label=N[1],N=U;break}if(N&&M.label<N[2]){M.label=N[2],M.ops.push(U);break}N[2]&&M.ops.pop(),M.trys.pop();continue}U=_.call(A,M)}catch(V){U=[6,V],D=0}finally{$=N=0}if(5&U[0])throw U[1];return{value:U[0]?U[1]:void 0,done:!0}}([x,F])}}}var r,s=function(A){function _($){var D,N=this;return(N=A.call(this,"ClientResponseError")||this).url="",N.status=0,N.data={},N.isAbort=!1,N.originalError=null,Object.setPrototypeOf(N,_.prototype),$ instanceof _||(N.originalError=$),$!==null&&typeof $=="object"&&(N.url=typeof $.url=="string"?$.url:"",N.status=typeof $.status=="number"?$.status:0,N.data=$.data!==null&&typeof $.data=="object"?$.data:{}),typeof DOMException<"u"&&$ instanceof DOMException&&(N.isAbort=!0),N.name="ClientResponseError "+N.status,N.message=(D=N.data)===null||D===void 0?void 0:D.message,N.message||(N.message=N.isAbort?"The request was autocancelled. More info you could find in https://github.com/pocketbase/js-sdk#auto-cancellation.":"Something went wrong while processing your request."),N}return e(_,A),_.prototype.toJSON=function(){return n({},this)},_}(Error),a=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function u(A,_,$){var D=Object.assign({},$||{}),N=D.encode||c;if(!a.test(A))throw new TypeError("argument name is invalid");var q=N(_);if(q&&!a.test(q))throw new TypeError("argument val is invalid");var M=A+"="+q;if(D.maxAge!=null){var L=D.maxAge-0;if(isNaN(L)||!isFinite(L))throw new TypeError("option maxAge is invalid");M+="; Max-Age="+Math.floor(L)}if(D.domain){if(!a.test(D.domain))throw new TypeError("option domain is invalid");M+="; Domain="+D.domain}if(D.path){if(!a.test(D.path))throw new TypeError("option path is invalid");M+="; Path="+D.path}if(D.expires){if(!function(x){return Object.prototype.toString.call(x)==="[object Date]"||x instanceof Date}(D.expires)||isNaN(D.expires.valueOf()))throw new TypeError("option expires is invalid");M+="; Expires="+D.expires.toUTCString()}if(D.httpOnly&&(M+="; HttpOnly"),D.secure&&(M+="; Secure"),D.priority)switch(typeof D.priority=="string"?D.priority.toLowerCase():D.priority){case"low":M+="; Priority=Low";break;case"medium":M+="; Priority=Medium";break;case"high":M+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(D.sameSite)switch(typeof D.sameSite=="string"?D.sameSite.toLowerCase():D.sameSite){case!0:M+="; SameSite=Strict";break;case"lax":M+="; SameSite=Lax";break;case"strict":M+="; SameSite=Strict";break;case"none":M+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return M}function l(A){return A.indexOf("%")!==-1?decodeURIComponent(A):A}function c(A){return encodeURIComponent(A)}function d(A){if(A)try{var _=decodeURIComponent(r(A.split(".")[1]).split("").map(function($){return"%"+("00"+$.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(_)||{}}catch{}return{}}r=typeof atob=="function"?atob:function(A){var _=String(A).replace(/=+$/,"");if(_.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var $,D,N=0,q=0,M="";D=_.charAt(q++);~D&&($=N%4?64*$+D:D,N++%4)?M+=String.fromCharCode(255&$>>(-2*N&6)):0)D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(D);return M};var h=function(){function A(_){_===void 0&&(_={}),this.load(_||{})}return A.prototype.load=function(_){for(var $=0,D=Object.entries(_);$<D.length;$++){var N=D[$],q=N[0],M=N[1];this[q]=M}this.id=_.id!==void 0?_.id:"",this.created=_.created!==void 0?_.created:"",this.updated=_.updated!==void 0?_.updated:""},Object.defineProperty(A.prototype,"isNew",{get:function(){return!this.id},enumerable:!1,configurable:!0}),A.prototype.clone=function(){return new this.constructor(JSON.parse(JSON.stringify(this)))},A.prototype.export=function(){return Object.assign({},this)},A}(),p=function(A){function _(){return A!==null&&A.apply(this,arguments)||this}return e(_,A),_.prototype.load=function($){A.prototype.load.call(this,$),this.collectionId=typeof $.collectionId=="string"?$.collectionId:"",this.collectionName=typeof $.collectionName=="string"?$.collectionName:"",this.expand=typeof $.expand=="object"&&$.expand!==null?$.expand:{}},_}(h),f=function(A){function _(){return A!==null&&A.apply(this,arguments)||this}return e(_,A),_.prototype.load=function($){A.prototype.load.call(this,$),this.avatar=typeof $.avatar=="number"?$.avatar:0,this.email=typeof $.email=="string"?$.email:""},_}(h),v=function(){function A(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}return Object.defineProperty(A.prototype,"token",{get:function(){return this.baseToken},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"model",{get:function(){return this.baseModel},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"isValid",{get:function(){return!function(_,$){$===void 0&&($=0);var D=d(_);return!(Object.keys(D).length>0&&(!D.exp||D.exp-$>Date.now()/1e3))}(this.token)},enumerable:!1,configurable:!0}),A.prototype.save=function(_,$){this.baseToken=_||"",this.baseModel=$!==null&&typeof $=="object"?$.collectionId!==void 0?new p($):new f($):null,this.triggerChange()},A.prototype.clear=function(){this.baseToken="",this.baseModel=null,this.triggerChange()},A.prototype.loadFromCookie=function(_,$){$===void 0&&($="pb_auth");var D=function(q,M){var L={};if(typeof q!="string")return L;for(var x=Object.assign({},M||{}).decode||l,F=0;F<q.length;){var U=q.indexOf("=",F);if(U===-1)break;var V=q.indexOf(";",F);if(V===-1)V=q.length;else if(V<U){F=q.lastIndexOf(";",U-1)+1;continue}var Q=q.slice(F,U).trim();if(L[Q]===void 0){var Y=q.slice(U+1,V).trim();Y.charCodeAt(0)===34&&(Y=Y.slice(1,-1));try{L[Q]=x(Y)}catch{L[Q]=Y}}F=V+1}return L}(_||"")[$]||"",N={};try{(typeof(N=JSON.parse(D))===null||typeof N!="object"||Array.isArray(N))&&(N={})}catch{}this.save(N.token||"",N.model||null)},A.prototype.exportToCookie=function(_,$){var D,N,q;$===void 0&&($="pb_auth");var M={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},L=d(this.token);L!=null&&L.exp?M.expires=new Date(1e3*L.exp):M.expires=new Date("1970-01-01"),_=Object.assign({},M,_);var x={token:this.token,model:((D=this.model)===null||D===void 0?void 0:D.export())||null},F=u($,JSON.stringify(x),_),U=typeof Blob<"u"?new Blob([F]).size:F.length;return x.model&&U>4096&&(x.model={id:(N=x==null?void 0:x.model)===null||N===void 0?void 0:N.id,email:(q=x==null?void 0:x.model)===null||q===void 0?void 0:q.email},this.model instanceof p&&(x.model.username=this.model.username,x.model.verified=this.model.verified,x.model.collectionId=this.model.collectionId),F=u($,JSON.stringify(x),_)),F},A.prototype.onChange=function(_,$){var D=this;return $===void 0&&($=!1),this._onChangeCallbacks.push(_),$&&_(this.token,this.model),function(){for(var N=D._onChangeCallbacks.length-1;N>=0;N--)if(D._onChangeCallbacks[N]==_)return delete D._onChangeCallbacks[N],void D._onChangeCallbacks.splice(N,1)}},A.prototype.triggerChange=function(){for(var _=0,$=this._onChangeCallbacks;_<$.length;_++){var D=$[_];D&&D(this.token,this.model)}},A}(),b=function(A){function _($){$===void 0&&($="pocketbase_auth");var D=A.call(this)||this;return D.storageFallback={},D.storageKey=$,D}return e(_,A),Object.defineProperty(_.prototype,"token",{get:function(){return(this._storageGet(this.storageKey)||{}).token||""},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"model",{get:function(){var $,D=this._storageGet(this.storageKey)||{};return D===null||typeof D!="object"||D.model===null||typeof D.model!="object"?null:(($=D.model)===null||$===void 0?void 0:$.collectionId)===void 0?new f(D.model):new p(D.model)},enumerable:!1,configurable:!0}),_.prototype.save=function($,D){this._storageSet(this.storageKey,{token:$,model:D}),A.prototype.save.call(this,$,D)},_.prototype.clear=function(){this._storageRemove(this.storageKey),A.prototype.clear.call(this)},_.prototype._storageGet=function($){if(typeof window<"u"&&(window!=null&&window.localStorage)){var D=window.localStorage.getItem($)||"";try{return JSON.parse(D)}catch{return D}}return this.storageFallback[$]},_.prototype._storageSet=function($,D){if(typeof window<"u"&&(window!=null&&window.localStorage)){var N=D;typeof D!="string"&&(N=JSON.stringify(D)),window.localStorage.setItem($,N)}else this.storageFallback[$]=D},_.prototype._storageRemove=function($){var D;typeof window<"u"&&(window!=null&&window.localStorage)&&((D=window.localStorage)===null||D===void 0||D.removeItem($)),delete this.storageFallback[$]},_}(v),y=function(A){this.client=A},m=function(A){function _(){return A!==null&&A.apply(this,arguments)||this}return e(_,A),_.prototype.getAll=function($){return $===void 0&&($={}),this.client.send("/api/settings",{method:"GET",params:$}).then(function(D){return D||{}})},_.prototype.update=function($,D){return $===void 0&&($={}),D===void 0&&(D={}),this.client.send("/api/settings",{method:"PATCH",params:D,body:$}).then(function(N){return N||{}})},_.prototype.testS3=function($){return $===void 0&&($={}),this.client.send("/api/settings/test/s3",{method:"POST",params:$}).then(function(){return!0})},_.prototype.testEmail=function($,D,N){N===void 0&&(N={});var q={email:$,template:D};return this.client.send("/api/settings/test/email",{method:"POST",params:N,body:q}).then(function(){return!0})},_}(y),g=function(A,_,$,D,N){this.page=A>0?A:1,this.perPage=_>=0?_:0,this.totalItems=$>=0?$:0,this.totalPages=D>=0?D:0,this.items=N||[]},w=function(A){function _(){return A!==null&&A.apply(this,arguments)||this}return e(_,A),_.prototype.getFullList=function($,D){return $===void 0&&($=200),D===void 0&&(D={}),this._getFullList(this.baseCrudPath,$,D)},_.prototype.getList=function($,D,N){return $===void 0&&($=1),D===void 0&&(D=30),N===void 0&&(N={}),this._getList(this.baseCrudPath,$,D,N)},_.prototype.getFirstListItem=function($,D){return D===void 0&&(D={}),this._getFirstListItem(this.baseCrudPath,$,D)},_.prototype.getOne=function($,D){return D===void 0&&(D={}),this._getOne(this.baseCrudPath,$,D)},_.prototype.create=function($,D){return $===void 0&&($={}),D===void 0&&(D={}),this._create(this.baseCrudPath,$,D)},_.prototype.update=function($,D,N){return D===void 0&&(D={}),N===void 0&&(N={}),this._update(this.baseCrudPath,$,D,N)},_.prototype.delete=function($,D){return D===void 0&&(D={}),this._delete(this.baseCrudPath,$,D)},_}(function(A){function _(){return A!==null&&A.apply(this,arguments)||this}return e(_,A),_.prototype._getFullList=function($,D,N){var q=this;D===void 0&&(D=100),N===void 0&&(N={});var M=[],L=function(x){return i(q,void 0,void 0,function(){return o(this,function(F){return[2,this._getList($,x,D,N).then(function(U){var V=U,Q=V.items,Y=V.totalItems;return M=M.concat(Q),Q.length&&Y>M.length?L(x+1):M})]})})};return L(1)},_.prototype._getList=function($,D,N,q){var M=this;return D===void 0&&(D=1),N===void 0&&(N=30),q===void 0&&(q={}),q=Object.assign({page:D,perPage:N},q),this.client.send($,{method:"GET",params:q}).then(function(L){var x=[];if(L!=null&&L.items){L.items=L.items||[];for(var F=0,U=L.items;F<U.length;F++){var V=U[F];x.push(M.decode(V))}}return new g((L==null?void 0:L.page)||1,(L==null?void 0:L.perPage)||0,(L==null?void 0:L.totalItems)||0,(L==null?void 0:L.totalPages)||0,x)})},_.prototype._getOne=function($,D,N){var q=this;return N===void 0&&(N={}),this.client.send($+"/"+encodeURIComponent(D),{method:"GET",params:N}).then(function(M){return q.decode(M)})},_.prototype._getFirstListItem=function($,D,N){return N===void 0&&(N={}),N=Object.assign({filter:D,$cancelKey:"one_by_filter_"+$+"_"+D},N),this._getList($,1,1,N).then(function(q){var M;if(!(!((M=q==null?void 0:q.items)===null||M===void 0)&&M.length))throw new s({status:404,data:{code:404,message:"The requested resource wasn't found.",data:{}}});return q.items[0]})},_.prototype._create=function($,D,N){var q=this;return D===void 0&&(D={}),N===void 0&&(N={}),this.client.send($,{method:"POST",params:N,body:D}).then(function(M){return q.decode(M)})},_.prototype._update=function($,D,N,q){var M=this;return N===void 0&&(N={}),q===void 0&&(q={}),this.client.send($+"/"+encodeURIComponent(D),{method:"PATCH",params:q,body:N}).then(function(L){return M.decode(L)})},_.prototype._delete=function($,D,N){return N===void 0&&(N={}),this.client.send($+"/"+encodeURIComponent(D),{method:"DELETE",params:N}).then(function(){return!0})},_}(y)),S=function(A){function _(){return A!==null&&A.apply(this,arguments)||this}return e(_,A),_.prototype.decode=function($){return new f($)},Object.defineProperty(_.prototype,"baseCrudPath",{get:function(){return"/api/admins"},enumerable:!1,configurable:!0}),_.prototype.update=function($,D,N){var q=this;return D===void 0&&(D={}),N===void 0&&(N={}),A.prototype.update.call(this,$,D,N).then(function(M){var L,x;return q.client.authStore.model&&((L=q.client.authStore.model)===null||L===void 0?void 0:L.collectionId)===void 0&&((x=q.client.authStore.model)===null||x===void 0?void 0:x.id)===(M==null?void 0:M.id)&&q.client.authStore.save(q.client.authStore.token,M),M})},_.prototype.delete=function($,D){var N=this;return D===void 0&&(D={}),A.prototype.delete.call(this,$,D).then(function(q){var M,L;return q&&N.client.authStore.model&&((M=N.client.authStore.model)===null||M===void 0?void 0:M.collectionId)===void 0&&((L=N.client.authStore.model)===null||L===void 0?void 0:L.id)===$&&N.client.authStore.clear(),q})},_.prototype.authResponse=function($){var D=this.decode(($==null?void 0:$.admin)||{});return $!=null&&$.token&&($!=null&&$.admin)&&this.client.authStore.save($.token,D),Object.assign({},$,{token:($==null?void 0:$.token)||"",admin:D})},_.prototype.authWithPassword=function($,D,N,q){return N===void 0&&(N={}),q===void 0&&(q={}),N=Object.assign({identity:$,password:D},N),this.client.send(this.baseCrudPath+"/auth-with-password",{method:"POST",params:q,body:N,headers:{Authorization:""}}).then(this.authResponse.bind(this))},_.prototype.authRefresh=function($,D){return $===void 0&&($={}),D===void 0&&(D={}),this.client.send(this.baseCrudPath+"/auth-refresh",{method:"POST",params:D,body:$}).then(this.authResponse.bind(this))},_.prototype.requestPasswordReset=function($,D,N){return D===void 0&&(D={}),N===void 0&&(N={}),D=Object.assign({email:$},D),this.client.send(this.baseCrudPath+"/request-password-reset",{method:"POST",params:N,body:D}).then(function(){return!0})},_.prototype.confirmPasswordReset=function($,D,N,q,M){return q===void 0&&(q={}),M===void 0&&(M={}),q=Object.assign({token:$,password:D,passwordConfirm:N},q),this.client.send(this.baseCrudPath+"/confirm-password-reset",{method:"POST",params:M,body:q}).then(function(){return!0})},_}(w),O=function(A){function _(){return A!==null&&A.apply(this,arguments)||this}return e(_,A),_.prototype.load=function($){A.prototype.load.call(this,$),this.recordId=typeof $.recordId=="string"?$.recordId:"",this.collectionId=typeof $.collectionId=="string"?$.collectionId:"",this.provider=typeof $.provider=="string"?$.provider:"",this.providerId=typeof $.providerId=="string"?$.providerId:""},_}(h),C=function(A){function _($,D){var N=A.call(this,$)||this;return N.collectionIdOrName=D,N}return e(_,A),_.prototype.decode=function($){return new p($)},Object.defineProperty(_.prototype,"baseCrudPath",{get:function(){return this.baseCollectionPath+"/records"},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"baseCollectionPath",{get:function(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)},enumerable:!1,configurable:!0}),_.prototype.subscribeOne=function($,D){return i(this,void 0,void 0,function(){return o(this,function(N){return console.warn("PocketBase: subscribeOne(recordId, callback) is deprecated. Please replace it with subsribe(recordId, callback)."),[2,this.client.realtime.subscribe(this.collectionIdOrName+"/"+$,D)]})})},_.prototype.subscribe=function($,D){return i(this,void 0,void 0,function(){var N;return o(this,function(q){if(typeof $=="function")return console.warn("PocketBase: subscribe(callback) is deprecated. Please replace it with subsribe('*', callback)."),[2,this.client.realtime.subscribe(this.collectionIdOrName,$)];if(!D)throw new Error("Missing subscription callback.");if($==="")throw new Error("Missing topic.");return N=this.collectionIdOrName,$!=="*"&&(N+="/"+$),[2,this.client.realtime.subscribe(N,D)]})})},_.prototype.unsubscribe=function($){return i(this,void 0,void 0,function(){return o(this,function(D){return $==="*"?[2,this.client.realtime.unsubscribe(this.collectionIdOrName)]:$?[2,this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+$)]:[2,this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)]})})},_.prototype.update=function($,D,N){var q=this;return D===void 0&&(D={}),N===void 0&&(N={}),A.prototype.update.call(this,$,D,N).then(function(M){var L,x;return((L=q.client.authStore.model)===null||L===void 0?void 0:L.collectionId)!==void 0&&((x=q.client.authStore.model)===null||x===void 0?void 0:x.id)===(M==null?void 0:M.id)&&q.client.authStore.save(q.client.authStore.token,M),M})},_.prototype.delete=function($,D){var N=this;return D===void 0&&(D={}),A.prototype.delete.call(this,$,D).then(function(q){var M,L;return q&&((M=N.client.authStore.model)===null||M===void 0?void 0:M.collectionId)!==void 0&&((L=N.client.authStore.model)===null||L===void 0?void 0:L.id)===$&&N.client.authStore.clear(),q})},_.prototype.authResponse=function($){var D=this.decode(($==null?void 0:$.record)||{});return this.client.authStore.save($==null?void 0:$.token,D),Object.assign({},$,{token:($==null?void 0:$.token)||"",record:D})},_.prototype.listAuthMethods=function($){return $===void 0&&($={}),this.client.send(this.baseCollectionPath+"/auth-methods",{method:"GET",params:$}).then(function(D){return Object.assign({},D,{usernamePassword:!!(D!=null&&D.usernamePassword),emailPassword:!!(D!=null&&D.emailPassword),authProviders:Array.isArray(D==null?void 0:D.authProviders)?D==null?void 0:D.authProviders:[]})})},_.prototype.authWithPassword=function($,D,N,q){var M=this;return N===void 0&&(N={}),q===void 0&&(q={}),N=Object.assign({identity:$,password:D},N),this.client.send(this.baseCollectionPath+"/auth-with-password",{method:"POST",params:q,body:N,headers:{Authorization:""}}).then(function(L){return M.authResponse(L)})},_.prototype.authWithOAuth2=function($,D,N,q,M,L,x){var F=this;return M===void 0&&(M={}),L===void 0&&(L={}),x===void 0&&(x={}),L=Object.assign({provider:$,code:D,codeVerifier:N,redirectUrl:q,createData:M},L),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",{method:"POST",params:x,body:L}).then(function(U){return F.authResponse(U)})},_.prototype.authRefresh=function($,D){var N=this;return $===void 0&&($={}),D===void 0&&(D={}),this.client.send(this.baseCollectionPath+"/auth-refresh",{method:"POST",params:D,body:$}).then(function(q){return N.authResponse(q)})},_.prototype.requestPasswordReset=function($,D,N){return D===void 0&&(D={}),N===void 0&&(N={}),D=Object.assign({email:$},D),this.client.send(this.baseCollectionPath+"/request-password-reset",{method:"POST",params:N,body:D}).then(function(){return!0})},_.prototype.confirmPasswordReset=function($,D,N,q,M){return q===void 0&&(q={}),M===void 0&&(M={}),q=Object.assign({token:$,password:D,passwordConfirm:N},q),this.client.send(this.baseCollectionPath+"/confirm-password-reset",{method:"POST",params:M,body:q}).then(function(){return!0})},_.prototype.requestVerification=function($,D,N){return D===void 0&&(D={}),N===void 0&&(N={}),D=Object.assign({email:$},D),this.client.send(this.baseCollectionPath+"/request-verification",{method:"POST",params:N,body:D}).then(function(){return!0})},_.prototype.confirmVerification=function($,D,N){return D===void 0&&(D={}),N===void 0&&(N={}),D=Object.assign({token:$},D),this.client.send(this.baseCollectionPath+"/confirm-verification",{method:"POST",params:N,body:D}).then(function(){return!0})},_.prototype.requestEmailChange=function($,D,N){return D===void 0&&(D={}),N===void 0&&(N={}),D=Object.assign({newEmail:$},D),this.client.send(this.baseCollectionPath+"/request-email-change",{method:"POST",params:N,body:D}).then(function(){return!0})},_.prototype.confirmEmailChange=function($,D,N,q){return N===void 0&&(N={}),q===void 0&&(q={}),N=Object.assign({token:$,password:D},N),this.client.send(this.baseCollectionPath+"/confirm-email-change",{method:"POST",params:q,body:N}).then(function(){return!0})},_.prototype.listExternalAuths=function($,D){return D===void 0&&(D={}),this.client.send(this.baseCrudPath+"/"+encodeURIComponent($)+"/external-auths",{method:"GET",params:D}).then(function(N){var q=[];if(Array.isArray(N))for(var M=0,L=N;M<L.length;M++){var x=L[M];q.push(new O(x))}return q})},_.prototype.unlinkExternalAuth=function($,D,N){return N===void 0&&(N={}),this.client.send(this.baseCrudPath+"/"+encodeURIComponent($)+"/external-auths/"+encodeURIComponent(D),{method:"DELETE",params:N}).then(function(){return!0})},_}(w),P=function(){function A(_){_===void 0&&(_={}),this.load(_||{})}return A.prototype.load=function(_){this.id=_.id!==void 0?_.id:"",this.name=_.name!==void 0?_.name:"",this.type=_.type!==void 0?_.type:"text",this.system=!!_.system,this.required=!!_.required,this.unique=!!_.unique,this.options=typeof _.options=="object"&&_.options!==null?_.options:{}},A}(),I=function(A){function _(){return A!==null&&A.apply(this,arguments)||this}return e(_,A),_.prototype.load=function($){A.prototype.load.call(this,$),this.system=!!$.system,this.name=typeof $.name=="string"?$.name:"",this.type=typeof $.type=="string"?$.type:"base",this.options=$.options!==void 0?$.options:{},this.listRule=typeof $.listRule=="string"?$.listRule:null,this.viewRule=typeof $.viewRule=="string"?$.viewRule:null,this.createRule=typeof $.createRule=="string"?$.createRule:null,this.updateRule=typeof $.updateRule=="string"?$.updateRule:null,this.deleteRule=typeof $.deleteRule=="string"?$.deleteRule:null,$.schema=Array.isArray($.schema)?$.schema:[],this.schema=[];for(var D=0,N=$.schema;D<N.length;D++){var q=N[D];this.schema.push(new P(q))}},Object.defineProperty(_.prototype,"isBase",{get:function(){return this.type==="base"},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"isAuth",{get:function(){return this.type==="auth"},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"isSingle",{get:function(){return this.type==="single"},enumerable:!1,configurable:!0}),_}(h),k=function(A){function _(){return A!==null&&A.apply(this,arguments)||this}return e(_,A),_.prototype.decode=function($){return new I($)},Object.defineProperty(_.prototype,"baseCrudPath",{get:function(){return"/api/collections"},enumerable:!1,configurable:!0}),_.prototype.import=function($,D,N){return D===void 0&&(D=!1),N===void 0&&(N={}),i(this,void 0,void 0,function(){return o(this,function(q){return[2,this.client.send(this.baseCrudPath+"/import",{method:"PUT",params:N,body:{collections:$,deleteMissing:D}}).then(function(){return!0})]})})},_}(w),j=function(A){function _(){return A!==null&&A.apply(this,arguments)||this}return e(_,A),_.prototype.load=function($){A.prototype.load.call(this,$),$.remoteIp=$.remoteIp||$.ip,this.url=typeof $.url=="string"?$.url:"",this.method=typeof $.method=="string"?$.method:"GET",this.status=typeof $.status=="number"?$.status:200,this.auth=typeof $.auth=="string"?$.auth:"guest",this.remoteIp=typeof $.remoteIp=="string"?$.remoteIp:"",this.userIp=typeof $.userIp=="string"?$.userIp:"",this.referer=typeof $.referer=="string"?$.referer:"",this.userAgent=typeof $.userAgent=="string"?$.userAgent:"",this.meta=typeof $.meta=="object"&&$.meta!==null?$.meta:{}},_}(h),T=function(A){function _(){return A!==null&&A.apply(this,arguments)||this}return e(_,A),_.prototype.getRequestsList=function($,D,N){return $===void 0&&($=1),D===void 0&&(D=30),N===void 0&&(N={}),N=Object.assign({page:$,perPage:D},N),this.client.send("/api/logs/requests",{method:"GET",params:N}).then(function(q){var M=[];if(q!=null&&q.items){q.items=(q==null?void 0:q.items)||[];for(var L=0,x=q.items;L<x.length;L++){var F=x[L];M.push(new j(F))}}return new g((q==null?void 0:q.page)||1,(q==null?void 0:q.perPage)||0,(q==null?void 0:q.totalItems)||0,(q==null?void 0:q.totalPages)||0,M)})},_.prototype.getRequest=function($,D){return D===void 0&&(D={}),this.client.send("/api/logs/requests/"+encodeURIComponent($),{method:"GET",params:D}).then(function(N){return new j(N)})},_.prototype.getRequestsStats=function($){return $===void 0&&($={}),this.client.send("/api/logs/requests/stats",{method:"GET",params:$}).then(function(D){return D})},_}(y),E=function(A){function _(){var $=A!==null&&A.apply(this,arguments)||this;return $.clientId="",$.eventSource=null,$.subscriptions={},$}return e(_,A),_.prototype.subscribe=function($,D){return i(this,void 0,void 0,function(){var N,q=this;return o(this,function(M){switch(M.label){case 0:if(!$)throw new Error("topic must be set.");return N=function(L){var x,F=L;try{x=JSON.parse(F==null?void 0:F.data)}catch{}D(x||{})},this.subscriptions[$]||(this.subscriptions[$]=[]),this.subscriptions[$].push(N),this.eventSource?[3,1]:(this.connect(),[3,4]);case 1:return this.subscriptions[$].length!==1?[3,3]:[4,this.submitSubscriptions()];case 2:return M.sent(),[3,4];case 3:this.eventSource.addEventListener($,N),M.label=4;case 4:return[2,function(){return i(q,void 0,void 0,function(){return o(this,function(L){return[2,this.unsubscribeByTopicAndListener($,N)]})})}]}})})},_.prototype.unsubscribe=function($){var D;return i(this,void 0,void 0,function(){var N,q,M;return o(this,function(L){switch(L.label){case 0:if(!this.hasSubscriptionListeners($))return[2];if($){for(N=0,q=this.subscriptions[$];N<q.length;N++)M=q[N],(D=this.eventSource)===null||D===void 0||D.removeEventListener($,M);delete this.subscriptions[$]}else this.subscriptions={};return this.hasSubscriptionListeners()?[3,1]:(this.disconnect(),[3,3]);case 1:return this.hasSubscriptionListeners($)?[3,3]:[4,this.submitSubscriptions()];case 2:L.sent(),L.label=3;case 3:return[2]}})})},_.prototype.unsubscribeByPrefix=function($){var D;return i(this,void 0,void 0,function(){var N,q,M,L,x;return o(this,function(F){switch(F.label){case 0:for(q in N=!1,this.subscriptions)if(q.startsWith($)){for(N=!0,M=0,L=this.subscriptions[q];M<L.length;M++)x=L[M],(D=this.eventSource)===null||D===void 0||D.removeEventListener(q,x);delete this.subscriptions[q]}return N?this.hasSubscriptionListeners()?[4,this.submitSubscriptions()]:[3,2]:[2];case 1:return F.sent(),[3,3];case 2:this.disconnect(),F.label=3;case 3:return[2]}})})},_.prototype.unsubscribeByTopicAndListener=function($,D){var N;return i(this,void 0,void 0,function(){var q,M;return o(this,function(L){switch(L.label){case 0:if(!Array.isArray(this.subscriptions[$])||!this.subscriptions[$].length)return[2];for(q=!1,M=this.subscriptions[$].length-1;M>=0;M--)this.subscriptions[$][M]===D&&(q=!0,delete this.subscriptions[$][M],this.subscriptions[$].splice(M,1),(N=this.eventSource)===null||N===void 0||N.removeEventListener($,D));return q?(this.subscriptions[$].length||delete this.subscriptions[$],this.hasSubscriptionListeners()?[3,1]:(this.disconnect(),[3,3])):[2];case 1:return this.hasSubscriptionListeners($)?[3,3]:[4,this.submitSubscriptions()];case 2:L.sent(),L.label=3;case 3:return[2]}})})},_.prototype.hasSubscriptionListeners=function($){var D,N;if(this.subscriptions=this.subscriptions||{},$)return!!(!((D=this.subscriptions[$])===null||D===void 0)&&D.length);for(var q in this.subscriptions)if(!((N=this.subscriptions[q])===null||N===void 0)&&N.length)return!0;return!1},_.prototype.submitSubscriptions=function(){return i(this,void 0,void 0,function(){return o(this,function($){return this.clientId?(this.addAllSubscriptionListeners(),[2,this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.getNonEmptySubscriptionTopics()},params:{$cancelKey:"realtime_subscriptions_"+this.clientId}}).then(function(){return!0}).catch(function(D){if(D!=null&&D.isAbort)return!0;throw D})]):[2,!1]})})},_.prototype.getNonEmptySubscriptionTopics=function(){var $=[];for(var D in this.subscriptions)this.subscriptions[D].length&&$.push(D);return $},_.prototype.addAllSubscriptionListeners=function(){if(this.eventSource)for(var $ in this.removeAllSubscriptionListeners(),this.subscriptions)for(var D=0,N=this.subscriptions[$];D<N.length;D++){var q=N[D];this.eventSource.addEventListener($,q)}},_.prototype.removeAllSubscriptionListeners=function(){if(this.eventSource)for(var $ in this.subscriptions)for(var D=0,N=this.subscriptions[$];D<N.length;D++){var q=N[D];this.eventSource.removeEventListener($,q)}},_.prototype.connectHandler=function($){var D=$;this.clientId=D==null?void 0:D.lastEventId,this.submitSubscriptions()},_.prototype.connect=function(){var $=this;this.disconnect(),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.addEventListener("PB_CONNECT",function(D){return $.connectHandler(D)})},_.prototype.disconnect=function(){var $,D,N=this;this.removeAllSubscriptionListeners(),($=this.eventSource)===null||$===void 0||$.removeEventListener("PB_CONNECT",function(q){return N.connectHandler(q)}),(D=this.eventSource)===null||D===void 0||D.close(),this.eventSource=null,this.clientId=""},_}(y),R=function(){function A(_,$,D){_===void 0&&(_="/"),D===void 0&&(D="en-US"),this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=_,this.lang=D,this.authStore=$||new b,this.admins=new S(this),this.collections=new k(this),this.logs=new T(this),this.settings=new m(this),this.realtime=new E(this)}return A.prototype.collection=function(_){return this.recordServices[_]||(this.recordServices[_]=new C(this,_)),this.recordServices[_]},A.prototype.autoCancellation=function(_){return this.enableAutoCancellation=!!_,this},A.prototype.cancelRequest=function(_){return this.cancelControllers[_]&&(this.cancelControllers[_].abort(),delete this.cancelControllers[_]),this},A.prototype.cancelAllRequests=function(){for(var _ in this.cancelControllers)this.cancelControllers[_].abort();return this.cancelControllers={},this},A.prototype.send=function(_,$){var D,N,q,M,L,x,F,U;return i(this,void 0,void 0,function(){var V,Q,Y,X,ee,te=this;return o(this,function(z){return(V=Object.assign({method:"GET"},$)).body&&V.body.constructor.name!=="FormData"&&(typeof V.body!="string"&&(V.body=JSON.stringify(V.body)),((D=V==null?void 0:V.headers)===null||D===void 0?void 0:D["Content-Type"])===void 0&&(V.headers=Object.assign({},V.headers,{"Content-Type":"application/json"}))),((N=V==null?void 0:V.headers)===null||N===void 0?void 0:N["Accept-Language"])===void 0&&(V.headers=Object.assign({},V.headers,{"Accept-Language":this.lang})),!((q=this.authStore)===null||q===void 0)&&q.token&&((M=V==null?void 0:V.headers)===null||M===void 0?void 0:M.Authorization)===void 0&&(V.headers=Object.assign({},V.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&((L=V.params)===null||L===void 0?void 0:L.$autoCancel)!==!1&&(Q=((x=V.params)===null||x===void 0?void 0:x.$cancelKey)||(V.method||"GET")+_,this.cancelRequest(Q),Y=new AbortController,this.cancelControllers[Q]=Y,V.signal=Y.signal),(F=V.params)===null||F===void 0||delete F.$autoCancel,(U=V.params)===null||U===void 0||delete U.$cancelKey,X=this.buildUrl(_),V.params!==void 0&&((ee=this.serializeQueryParams(V.params))&&(X+=(X.includes("?")?"&":"?")+ee),delete V.params),this.beforeSend&&(V=Object.assign({},this.beforeSend(X,V))),[2,fetch(X,V).then(function(G){return i(te,void 0,void 0,function(){var H;return o(this,function(W){switch(W.label){case 0:H={},W.label=1;case 1:return W.trys.push([1,3,,4]),[4,G.json()];case 2:return H=W.sent(),[3,4];case 3:return W.sent(),[3,4];case 4:if(this.afterSend&&(H=this.afterSend(G,H)),G.status>=400)throw new s({url:G.url,status:G.status,data:H});return[2,H]}})})}).catch(function(G){throw new s(G)})]})})},A.prototype.getFileUrl=function(_,$,D){D===void 0&&(D={});var N=[];N.push("api"),N.push("files"),N.push(encodeURIComponent(_.collectionId||_.collectionName)),N.push(encodeURIComponent(_.id)),N.push(encodeURIComponent($));var q=this.buildUrl(N.join("/"));if(Object.keys(D).length){var M=new URLSearchParams(D);q+=(q.includes("?")?"&":"?")+M}return q},A.prototype.buildUrl=function(_){var $=this.baseUrl+(this.baseUrl.endsWith("/")?"":"/");return _&&($+=_.startsWith("/")?_.substring(1):_),$},A.prototype.serializeQueryParams=function(_){var $=[];for(var D in _)if(_[D]!==null){var N=_[D],q=encodeURIComponent(D);if(Array.isArray(N))for(var M=0,L=N;M<L.length;M++){var x=L[M];$.push(q+"="+encodeURIComponent(x))}else N instanceof Date?$.push(q+"="+encodeURIComponent(N.toISOString())):typeof N!==null&&typeof N=="object"?$.push(q+"="+encodeURIComponent(JSON.stringify(N))):$.push(q+"="+encodeURIComponent(N))}return $.join("&")},A}();const SAFECATCH_TTL_MS=5e3,safeCatch=(A,_,$,D=SAFECATCH_TTL_MS)=>async(...N)=>{const q=`${A}:${nanoid$1()}`,M=chalk$1.red(`safeCatch:${q}`),{raw:L,error:x,warn:F,dbg:U}=_.create(M);L("args",N);const V=setTimeout(()=>{F(`timeout ${D}ms waiting for ${M}`)},D);try{const Q=await $(...N);return L("finished"),Q}catch(Q){const Y=JSON.stringify(N);throw Q instanceof s?Q.status===400?U(`PocketBase API error: It looks like you don't have permission to make this request. Raw error: ${Q}. Payload: ${Y}`):Q.status===0?U(`Client request aborted (possible duplicate request or real error). Raw error: ${Q}. Payload: ${Y}`):Q.status===404?U(`Record not found. Raw error: ${Q}. Payload: ${Y}`):U(`Unknown PocketBase API error. Raw error: ${Q}. Payload: ${Y}`):U(`Caught an unknown error. Raw error: ${Q}. Payload: ${Y}`),Q}finally{clearTimeout(V)}},CreateInstancePayloadSchema={type:"object",properties:{subdomain:{type:"string"}},required:["subdomain"],additionalProperties:!1},RenameInstancePayloadSchema={type:"object",properties:{instanceId:{type:"string"},subdomain:{type:"string"}},required:["instanceId","subdomain"],additionalProperties:!1},SECRET_KEY_REGEX=/^[A-Z][A-Z0-9_]*$/,SaveSecretsPayloadSchema={type:"object",properties:{instanceId:{type:"string"},secrets:{type:"object",patternProperties:{[SECRET_KEY_REGEX.source]:{anyOf:[{type:"string"}]}},required:[]}},required:["instanceId","secrets"],additionalProperties:!1},SaveVersionPayloadSchema={type:"object",properties:{instanceId:{type:"string"},version:{type:"string"}},required:["instanceId","version"],additionalProperties:!1},SetInstanceMaintenancePayloadSchema={type:"object",properties:{instanceId:{type:"string"},maintenance:{type:"boolean"}},required:["instanceId","maintenance"],additionalProperties:!1},RPC_COLLECTION="rpc";var RpcCommands=(A=>(A.CreateInstance="create-instance",A.SaveSecrets="save-secrets",A.SaveVersion="save-version",A.SetInstanceMaintenance="set-instance-maintenance",A.RenameInstance="rename-instance",A))(RpcCommands||{}),RpcStatus=(A=>(A.New="new",A.Queued="queued",A.Running="running",A.Starting="starting",A.FinishedSuccess="finished-success",A.FinishedError="finished-error",A))(RpcStatus||{});new Ajv;const createRpcHelper=A=>{const _=logger().create("RpcHelper"),{client:$,watchHelper:{watchById:D}}=A;return{mkRpc:(q,M)=>{const L=new Ajv().compile(M);return safeCatch(q,logger(),async(x,F)=>{const U=_.create(q),{dbg:V,error:Q}=U;V("Executing RPC");const Y=$.authStore.model;if(!Y)throw new Error("Expected authenticated user here.");if(!L(x))throw new Error(`Invalid RPC payload: ${L.errors}`);const{id:X}=Y,ee={id:newId(),cmd:q,userId:X,payload:x};return U.breadcrumb(ee.id),V({rpcIn:ee}),new Promise((te,z)=>{(async()=>{V(`Watching ${ee.id}`),await D(RPC_COLLECTION,ee.id,(H,W)=>{V("Got an RPC change",H),F==null||F(H),H.record.status===RpcStatus.FinishedSuccess&&(V("RPC finished successfully",H),W(),te(H.record.result)),H.record.status===RpcStatus.FinishedError&&(V("RPC finished unsuccessfully",H),W(),z(new s(H.record.result)))},{initialFetch:!1,pollIntervalMs:100}),V(`Creating ${ee.id}`);const G=await $.collection(RPC_COLLECTION).create(ee);V(`Created ${G.id}`)})().catch(G=>{Q(G),z(G)})})})}}},createWatchHelper=A=>{const{client:_}=A,$=async(N,q,M,L)=>{const{dbg:x}=logger().create(`watchById:${N}:${q}`),F={initialFetch:!0,pollIntervalMs:0,...L},{initialFetch:U,pollIntervalMs:V}=F,Q=createTimerManager();x(`watching ${N}:${q}`);let Y=!1,X=!1;V&&(x(`Configuring polling for ${V}ms`),Q.repeat(async()=>{x(`Checking ${q} by polling`);try{const z=await _.collection(N).getOne(q);Y=!0,x(`Got an update polling ${N}:${q}`),M({action:"poll",record:z},ee)}catch(z){x("Failed to poll at interval",z)}return!0},V));const ee=async()=>{x(`Unsubbing ${N}:${q}`),Q.shutdown(),X=!0,await te()},te=await _.collection(N).subscribe(q,z=>{x(`Got an update watching ${N}:${q}`,z),M(z,ee)});if(U)try{const z=await _.collection(N).getOne(q);!Y&&!X&&(x(`Sending initial update for ${N}:${q}`,z),M({action:"initial",record:z},ee))}catch{throw new Error(`Expected ${N}.${q} to exist.`)}return ee},D=safeCatch("watchAllById",logger(),async(N,q,M,L,x=!0)=>{let F={};const U=_.collection(N).subscribe("*",V=>{V.record[q]===M&&(F[V.record.id]=!0,L(V))});return x&&(await _.collection(N).getFullList(100,{filter:`${q.toString()} = '${M}'`})).forEach(Q=>{F[Q.id]||L({action:"initial",record:Q})}),U});return{watchById:$,watchAllById:D}};function keys(A){let _=keysOfNonArray(A);return Array.isArray(A)&&(_=_.filter($=>$!=="length")),_}function keysOfNonArray(A){return A?Object.getOwnPropertyNames(A):[]}function forOwnOfNonArray(A,_){return forEachOfArray(keysOfNonArray(A),$=>_(A[$],$)),A}function forEach(A,_){return Array.isArray(A)?forEachOfArray(A,_):forOwnOfNonArray(A,_),A}function forEachOfArray(A,_){for(let $=0,D=A.length;$<D&&_(A[$],$)!==!1;++$);}function values(A){return keys(A).map(_=>A[_])}let nextId=1;function uniqueId(A=""){return A+nextId++}function map(A,_){const $=[];return forEach(A,(D,N)=>{$.push(_(D,N))}),$}function find(A,_,$=0){if(Array.isArray(A))return A.slice($).find((D,N)=>_(D,N));for(const D of keysOfNonArray(A).slice($)){const N=A[D];if(_(N,D))return N}}function doReduce(A,_,$,D,N){return A(_,(q,M)=>{N?(D=q,N=!1):D=$(D,q,M)}),D}function reduce(A,_,$){return doReduce(forEach,A,_,$,arguments.length<3)}const env$1=globalThis.__sveltekit_b37z03.env,publicRoutes=["/","/docs(/*)","/signup","/login","/login/password-reset","/login/password-reset/confirm","/login/confirm-account","/faq"];var lib={},boolean$1={};Object.defineProperty(boolean$1,"__esModule",{value:!0});boolean$1.boolean=void 0;const boolean=function(A){switch(Object.prototype.toString.call(A)){case"[object String]":return["true","t","yes","y","on","1"].includes(A.trim().toLowerCase());case"[object Number]":return A.valueOf()===1;case"[object Boolean]":return A.valueOf();default:return!1}};boolean$1.boolean=boolean;var isBooleanable$1={};Object.defineProperty(isBooleanable$1,"__esModule",{value:!0});isBooleanable$1.isBooleanable=void 0;const isBooleanable=function(A){switch(Object.prototype.toString.call(A)){case"[object String]":return["true","t","yes","y","on","1","false","f","no","n","off","0"].includes(A.trim().toLowerCase());case"[object Number]":return[0,1].includes(A.valueOf());case"[object Boolean]":return!0;default:return!1}};isBooleanable$1.isBooleanable=isBooleanable;(function(A){Object.defineProperty(A,"__esModule",{value:!0}),A.isBooleanable=A.boolean=void 0;const _=boolean$1;Object.defineProperty(A,"boolean",{enumerable:!0,get:function(){return _.boolean}});const $=isBooleanable$1;Object.defineProperty(A,"isBooleanable",{enumerable:!0,get:function(){return $.isBooleanable}})})(lib);var urlPattern={exports:{}};(function(A,_){var $=[].slice;(function(D,N){return _!==null?A.exports=N():D.UrlPattern=N()})(commonjsGlobal,function(){var D,N,q,M,L,x,F,U,V,Q,Y,X,ee,te,z;return V=function(G){return G.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},F=function(G,H){var W,ae,B;for(B=[],W=-1,ae=G.length;++W<ae;)B=B.concat(H(G[W]));return B},te=function(G,H){var W,ae,B;for(B="",W=-1,ae=G.length;++W<ae;)B+=H(G[W]);return B},ee=function(G){return new RegExp(G.toString()+"|").exec("").length-1},Y=function(G,H){var W,ae,B,Z,oe;for(Z={},W=-1,B=G.length;++W<B;)ae=G[W],oe=H[W],oe!=null&&(Z[ae]!=null?(Array.isArray(Z[ae])||(Z[ae]=[Z[ae]]),Z[ae].push(oe)):Z[ae]=oe);return Z},D={},D.Result=function(G,H){this.value=G,this.rest=H},D.Tagged=function(G,H){this.tag=G,this.value=H},D.tag=function(G,H){return function(W){var ae,B;if(ae=H(W),ae!=null)return B=new D.Tagged(G,ae.value),new D.Result(B,ae.rest)}},D.regex=function(G){return function(H){var W,ae;if(W=G.exec(H),W!=null)return ae=W[0],new D.Result(ae,H.slice(ae.length))}},D.sequence=function(){var G;return G=1<=arguments.length?$.call(arguments,0):[],function(H){var W,ae,B,Z,oe,fe;for(W=-1,ae=G.length,fe=[],Z=H;++W<ae;){if(B=G[W],oe=B(Z),oe==null)return;fe.push(oe.value),Z=oe.rest}return new D.Result(fe,Z)}},D.pick=function(){var G,H;return G=arguments[0],H=2<=arguments.length?$.call(arguments,1):[],function(W){var ae,B;if(B=D.sequence.apply(D,H)(W),B!=null)return ae=B.value,B.value=ae[G],B}},D.string=function(G){var H;return H=G.length,function(W){if(W.slice(0,H)===G)return new D.Result(G,W.slice(H))}},D.lazy=function(G){var H;return H=null,function(W){return H==null&&(H=G()),H(W)}},D.baseMany=function(G,H,W,ae,B){var Z,oe,fe,me;for(fe=B,me=W?"":[];!(H!=null&&(Z=H(fe),Z!=null)||(oe=G(fe),oe==null));)W?me+=oe.value:me.push(oe.value),fe=oe.rest;if(!(ae&&me.length===0))return new D.Result(me,fe)},D.many1=function(G){return function(H){return D.baseMany(G,null,!1,!0,H)}},D.concatMany1Till=function(G,H){return function(W){return D.baseMany(G,H,!0,!0,W)}},D.firstChoice=function(){var G;return G=1<=arguments.length?$.call(arguments,0):[],function(H){var W,ae,B,Z;for(W=-1,ae=G.length;++W<ae;)if(B=G[W],Z=B(H),Z!=null)return Z}},X=function(G){var H;return H={},H.wildcard=D.tag("wildcard",D.string(G.wildcardChar)),H.optional=D.tag("optional",D.pick(1,D.string(G.optionalSegmentStartChar),D.lazy(function(){return H.pattern}),D.string(G.optionalSegmentEndChar))),H.name=D.regex(new RegExp("^["+G.segmentNameCharset+"]+")),H.named=D.tag("named",D.pick(1,D.string(G.segmentNameStartChar),D.lazy(function(){return H.name}))),H.escapedChar=D.pick(1,D.string(G.escapeChar),D.regex(/^./)),H.static=D.tag("static",D.concatMany1Till(D.firstChoice(D.lazy(function(){return H.escapedChar}),D.regex(/^./)),D.firstChoice(D.string(G.segmentNameStartChar),D.string(G.optionalSegmentStartChar),D.string(G.optionalSegmentEndChar),H.wildcard))),H.token=D.lazy(function(){return D.firstChoice(H.wildcard,H.optional,H.named,H.static)}),H.pattern=D.many1(D.lazy(function(){return H.token})),H},U={escapeChar:"\\",segmentNameStartChar:":",segmentValueCharset:"a-zA-Z0-9-_~ %",segmentNameCharset:"a-zA-Z0-9",optionalSegmentStartChar:"(",optionalSegmentEndChar:")",wildcardChar:"*"},x=function(G,H){if(Array.isArray(G))return te(G,function(W){return x(W,H)});switch(G.tag){case"wildcard":return"(.*?)";case"named":return"(["+H+"]+)";case"static":return V(G.value);case"optional":return"(?:"+x(G.value,H)+")?"}},L=function(G,H){return H==null&&(H=U.segmentValueCharset),"^"+x(G,H)+"$"},M=function(G){if(Array.isArray(G))return F(G,M);switch(G.tag){case"wildcard":return["_"];case"named":return[G.value];case"static":return[];case"optional":return M(G.value)}},Q=function(G,H,W,ae){var B,Z,oe,fe;if(ae==null&&(ae=!1),fe=G[H],fe==null){if(ae)throw new Error("no values provided for key `"+H+"`");return}if(B=W[H]||0,Z=Array.isArray(fe)?fe.length-1:0,B>Z){if(ae)throw new Error("too few values provided for key `"+H+"`");return}return oe=Array.isArray(fe)?fe[B]:fe,ae&&(W[H]=B+1),oe},q=function(G,H,W){var ae,B;if(Array.isArray(G)){for(ae=-1,B=G.length;++ae<B;)if(q(G[ae],H,W))return!0;return!1}switch(G.tag){case"wildcard":return Q(H,"_",W,!1)!=null;case"named":return Q(H,G.value,W,!1)!=null;case"static":return!1;case"optional":return q(G.value,H,W)}},z=function(G,H,W){if(Array.isArray(G))return te(G,function(ae){return z(ae,H,W)});switch(G.tag){case"wildcard":return Q(H,"_",W,!0);case"named":return Q(H,G.value,W,!0);case"static":return G.value;case"optional":return q(G.value,H,W)?z(G.value,H,W):""}},N=function(G,H){var W,ae,B,Z,oe;if(G instanceof N){this.isRegex=G.isRegex,this.regex=G.regex,this.ast=G.ast,this.names=G.names;return}if(this.isRegex=G instanceof RegExp,!(typeof G=="string"||this.isRegex))throw new TypeError("argument must be a regex or a string");if(this.isRegex){if(this.regex=G,H!=null){if(!Array.isArray(H))throw new Error("if first argument is a regex the second argument may be an array of group names but you provided something else");if(W=ee(this.regex),H.length!==W)throw new Error("regex contains "+W+" groups but array of group names contains "+H.length);this.names=H}return}if(G==="")throw new Error("argument must not be the empty string");if(oe=G.replace(/\s+/g,""),oe!==G)throw new Error("argument must not contain whitespace");if(ae={escapeChar:(H!=null?H.escapeChar:void 0)||U.escapeChar,segmentNameStartChar:(H!=null?H.segmentNameStartChar:void 0)||U.segmentNameStartChar,segmentNameCharset:(H!=null?H.segmentNameCharset:void 0)||U.segmentNameCharset,segmentValueCharset:(H!=null?H.segmentValueCharset:void 0)||U.segmentValueCharset,optionalSegmentStartChar:(H!=null?H.optionalSegmentStartChar:void 0)||U.optionalSegmentStartChar,optionalSegmentEndChar:(H!=null?H.optionalSegmentEndChar:void 0)||U.optionalSegmentEndChar,wildcardChar:(H!=null?H.wildcardChar:void 0)||U.wildcardChar},Z=X(ae),B=Z.pattern(G),B==null)throw new Error("couldn't parse pattern");if(B.rest!=="")throw new Error("could only partially parse pattern");this.ast=B.value,this.regex=new RegExp(L(this.ast,ae.segmentValueCharset)),this.names=M(this.ast)},N.prototype.match=function(G){var H,W;return W=this.regex.exec(G),W==null?null:(H=W.slice(1),this.names?Y(this.names,H):H)},N.prototype.stringify=function(G){if(G==null&&(G={}),this.isRegex)throw new Error("can't stringify patterns generated from a regex");if(G!==Object(G))throw new Error("argument must be an object or undefined");return z(this.ast,G,{})},N.escapeForRegex=V,N.concatMap=F,N.stringConcatMap=te,N.regexGroupCount=ee,N.keysAndValuesToObject=Y,N.P=D,N.newParser=X,N.defaultOptions=U,N.astNodeToRegexString=L,N.astNodeToNames=M,N.getParam=Q,N.astNodeContainsSegmentsForProvidedParams=q,N.stringify=z,N})})(urlPattern,urlPattern.exports);var urlPatternExports=urlPattern.exports;const UrlPattern=getDefaultExportFromCjs(urlPatternExports),name="pockethost",version="0.8.2",author="Ben Allfree <ben@benallfree.com>",license="MIT",scripts={lint:'prettier -c "./**/*.ts"',"lint:fix":'prettier -w "./**/*.ts"',build:"concurrently 'yarn:build:*'","build:www":"cd packages/pockethost.io && yarn build","build:daemon":"cd packages/daemon && yarn build",dev:"NODE_ENV=development concurrently 'yarn:dev:*'","dev:proxy":"cd packages/proxy && yarn dev","dev:www":"cd packages/pockethost.io && yarn dev","dev:daemon":"cd packages/daemon && yarn dev",start:"concurrently 'yarn:start:*'","start:proxy":"cd packages/proxy && yarn start","start:www":"cd packages/pockethost.io && yarn start","start:daemon":"cd packages/daemon && yarn start",pm2:"concurrently 'yarn:pm2:*'","pm2:proxy":"cd packages/proxy && yarn pm2","pm2:www":"cd packages/pockethost.io && yarn pm2","pm2:daemon":"cd packages/daemon && yarn pm2",postinstall:"patch-package",prepare:"husky install"},workspaces={packages:["packages/*"]},prettier={semi:!1,useTabs:!1,singleQuote:!0,trailingComma:"all",plugins:["./node_modules/prettier-plugin-organize-imports/index.js","./node_modules/prettier-plugin-svelte/plugin.js"]},devDependencies={"chokidar-cli":"^3.0.0",concurrently:"^8.2.1","patch-package":"^8.0.0",prettier:"^3.0.3","prettier-plugin-organize-imports":"^3.2.3","prettier-plugin-svelte":"^3.0.3",tslib:"^2.6.2",tsx:"^3.12.8",typescript:"^5.0",husky:"^8.0.0"},dependencies={"postinstall-postinstall":"^2.1.0","replace-in-file":"^7.0.1"},base={name,version,author,license,private:!0,scripts,workspaces,prettier,devDependencies,dependencies},env=(A,_="")=>{const $=env$1[A];return $||_},envb=(A,_)=>lib.boolean(env(A,_.toString())),PUBLIC_APP_DB=env("PUBLIC_APP_DB","pockethost-central"),PUBLIC_APP_DOMAIN=env("PUBLIC_APP_DOMAIN","pockethost.io"),PUBLIC_APP_PROTOCOL=env("PUBLIC_APP_PROTOCOL","https"),PUBLIC_DEBUG=envb("PUBLIC_DEBUG",!1),PUBLIC_POCKETHOST_VERSION=base.version,PUBLIC_ROUTES=publicRoutes.map(A=>new UrlPattern(A));try{logger()}catch{logger({debug:PUBLIC_DEBUG,trace:!1,errorTrace:!1})}const createGenericSyncEvent=()=>{let A=0;const _={};return[N=>{const q=A++;return _[q]=N,()=>{delete _[q]}},N=>{forEach(_,q=>q(N))}]};async function getBytes(A,_){const $=A.getReader();let D;for(;!(D=await $.read()).done;)_(D.value)}function getLines(A){let _,$,D,N=!1;return function(M){_===void 0?(_=M,$=0,D=-1):_=concat(_,M);const L=_.length;let x=0;for(;$<L;){N&&(_[$]===10&&(x=++$),N=!1);let F=-1;for(;$<L&&F===-1;++$)switch(_[$]){case 58:D===-1&&(D=$-x);break;case 13:N=!0;case 10:F=$;break}if(F===-1)break;A(_.subarray(x,F),D),x=$,D=-1}x===L?_=void 0:x!==0&&(_=_.subarray(x),$-=x)}}function getMessages(A,_,$){let D=newMessage();const N=new TextDecoder;return function(M,L){if(M.length===0)$==null||$(D),D=newMessage();else if(L>0){const x=N.decode(M.subarray(0,L)),F=L+(M[L+1]===32?2:1),U=N.decode(M.subarray(F));switch(x){case"data":D.data=D.data?D.data+`
`+U:U;break;case"event":D.event=U;break;case"id":A(D.id=U);break;case"retry":const V=parseInt(U,10);isNaN(V)||_(D.retry=V);break}}}}function concat(A,_){const $=new Uint8Array(A.length+_.length);return $.set(A),$.set(_,A.length),$}function newMessage(){return{data:"",event:"",id:"",retry:void 0}}const EventStreamContentType="text/event-stream",DefaultRetryInterval=1e3,LastEventId="last-event-id";function fetchEventSource(A,{signal:_,headers:$,onopen:D,onmessage:N,onclose:q,onerror:M,openWhenHidden:L,fetch:x,...F}){return new Promise((U,V)=>{var ae;const Q={...$};Q.accept||(Q.accept=EventStreamContentType);let Y;function X(){var B;Y.abort(),(B=globalThis.document)!=null&&B.hidden||W()}globalThis.document&&!L&&((ae=globalThis.document)==null||ae.addEventListener("visibilitychange",X));let ee=DefaultRetryInterval,te;function z(){var B;(B=globalThis.document)==null||B.removeEventListener("visibilitychange",X),globalThis.clearTimeout(te),Y.abort()}_==null||_.addEventListener("abort",()=>{z(),U()});const G=x??globalThis.fetch,H=D??defaultOnOpen;async function W(){Y&&Y.abort(),Y=new AbortController;try{const B=await G(A,{...F,headers:Q,signal:Y.signal});await H(B),await getBytes(B.body,getLines(getMessages(Z=>{Z?Q[LastEventId]=Z:delete Q[LastEventId]},Z=>{ee=Z},N))),q==null||q(),z(),U()}catch(B){if(!Y.signal.aborted)try{const Z=(M==null?void 0:M(B))??ee;globalThis.clearTimeout(te),te=globalThis.setTimeout(W,Z)}catch(Z){z(),V(Z)}}}W()})}function defaultOnOpen(A){const _=A.headers.get("content-type");if(!(_!=null&&_.startsWith(EventStreamContentType)))throw new Error(`Expected content-type to be ${EventStreamContentType}, Actual: ${_}`)}const createPocketbaseClient=A=>{const{url:_}=A,$=logger(),{dbg:D,error:N}=$,q=new R(_),{authStore:M}=q,L=()=>M.model,x=()=>M.isValid,F=()=>M.clear(),U=safeCatch("createUser",$,(we,pe)=>q.collection("users").create({email:we,password:pe,passwordConfirm:pe}).then(()=>q.collection("users").requestVerification(we))),V=safeCatch("confirmVerification",$,we=>q.collection("users").confirmVerification(we).then(pe=>pe)),Q=safeCatch("requestPasswordReset",$,we=>q.collection("users").requestPasswordReset(we).then(()=>!0)),Y=safeCatch("requestPasswordResetConfirm",$,(we,pe)=>q.collection("users").confirmPasswordReset(we,pe,pe).then(ie=>ie)),X=safeCatch("authViaEmail",$,(we,pe)=>q.collection("users").authWithPassword(we,pe)),ee=safeCatch("refreshAuthToken",$,()=>q.collection("users").authRefresh()),te=createWatchHelper({client:q}),{watchById:z,watchAllById:G}=te,H=createRpcHelper({client:q,watchHelper:te}),{mkRpc:W}=H,ae=W(RpcCommands.CreateInstance,CreateInstancePayloadSchema),B=W(RpcCommands.SaveSecrets,SaveSecretsPayloadSchema),Z=W(RpcCommands.SaveVersion,SaveVersionPayloadSchema),oe=W(RpcCommands.RenameInstance,RenameInstancePayloadSchema),fe=W(RpcCommands.SetInstanceMaintenance,SetInstanceMaintenancePayloadSchema),me=safeCatch("getInstanceById",$,we=>q.collection("instances").getOne(we)),_e=async(we,pe)=>z("instances",we,pe),ye=safeCatch("getAllInstancesById",$,async()=>(await q.collection("instances").getFullList()).reduce((we,pe)=>(we[pe.id]=pe,we),{})),Re=we=>we instanceof s?we.data.message&&keys(we.data.data).length===0?[we.data.message]:map(we.data.data,(pe,ie)=>pe?pe.message:void 0).filter(pe=>!!pe):[we.message],ke=safeCatch("resendVerificationEmail",$,async()=>{const we=q.authStore.model;assertExists(we,"Login required"),await q.collection("users").requestVerification(we.email)}),De=()=>{const{token:we,model:pe,isValid:ie}=q.authStore;if(pe instanceof f)throw new Error("Admin models not supported");if(pe&&!pe.email)throw new Error("Expected model to be a user here");return{token:we,model:pe,isValid:ie}},[Le,Ve]=createGenericSyncEvent();{q.authStore.onChange(()=>{Ve(De())}),ee().catch(pe=>{D(`Clearing auth store: ${pe}`),q.authStore.clear()}).finally(()=>{Ve(De())});const we=Le(pe=>{const{model:ie}=pe;if(!ie||ie instanceof f)return;if(ie.verified){we();return}const he=safeCatch("_checkVerified",$,ee);setTimeout(he,1e3)})}return{client:q,saveSecrets:B,watchInstanceLog:(we,pe,ie=100)=>{const{dbg:he,trace:ce}=$.create("watchInstanceLog"),K=q.authStore.exportToCookie(),ne=new AbortController,de=ne.signal,ge=()=>{he(`Subscribing to ${_}`),fetchEventSource(`${_}/logs`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({instanceId:we,n:ie,auth:K}),onmessage:ve=>{ce("Got stream event",ve);const{}=ve,Se=JSON.parse(ve.data);ce("Log is",Se),pe(Se)},onopen:async ve=>{he("Stream is open",ve)},onerror:ve=>{he("Stream error",ve)},onclose:()=>{setTimeout(ge,100),he("Stream closed")},signal:de})};return ge(),()=>{ne.abort()}},getAuthStoreProps:De,parseError:Re,getInstanceById:me,createInstance:ae,authViaEmail:X,createUser:U,requestPasswordReset:Q,requestPasswordResetConfirm:Y,confirmVerification:V,logOut:F,onAuthChange:Le,isLoggedIn:x,user:L,watchInstanceById:_e,getAllInstancesById:ye,resendVerificationEmail:ke,renameInstance:oe,setInstanceMaintenance:fe,saveVersion:Z}},client=(()=>{let A;return()=>{if(A)return A;const{info:_}=logger();_("Initializing pocketbase client");const $=`https://${PUBLIC_APP_DB}.${PUBLIC_APP_DOMAIN}`;return A=createPocketbaseClient({url:$}),A}})();export{PUBLIC_POCKETHOST_VERSION as P,SECRET_KEY_REGEX as S,assertTruthy as a,PUBLIC_APP_DOMAIN as b,PUBLIC_APP_PROTOCOL as c,client as d,PUBLIC_ROUTES as e,find as f,assertExists as g,getDefaultExportFromCjs as h,forEach as i,values$1 as j,reduce$1 as k,logger as l,commonjsGlobal as m,nanoid$1 as n,reduce as r,uniqueId as u,values as v};
