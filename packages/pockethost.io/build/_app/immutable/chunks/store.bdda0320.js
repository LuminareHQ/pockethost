import{n as p,l as d,j as h,k as g}from"./index.1926c527.js";import{w}from"./index.99927711.js";const m=10,k=o=>{const c=o||p(),{error:i,warn:f,dbg:_}=d().create(`cleanupManager:${c}`);let u=0;const r={},l=(a,e=m)=>{const n=u++,s=async()=>{await a(),delete r[n]};return r[n]={cleanup:s,priority:e},s};let t;return{add:l,shutdown:()=>{if(t)return t;const a=h(r).sort((e,n)=>e.priority-n.priority).map(e=>e.cleanup);return t=g(a,(e,n)=>e.then(()=>n()),Promise.resolve()).catch(e=>{throw i("Cleanup functions are failing. This should never happen, check all cleanup functions to make sure they are trapping their exceptions."),e}),t}}},x=w();export{k as c,x as i};
